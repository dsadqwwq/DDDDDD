<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Duel PVP – Enter the Arena</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  :root{
    --gold:#FFD64D;
    --gold-hi:#FFF3A3;
    --bg:#0b0f12;
    --success:#4CAF50;
    --danger:#F44336;

    /* Glow position */
    --glow-x: 80%;
    --glow-y: 32%;
    --glow-w: 211px;
    --glow-h: 366px;
  }
  *{box-sizing:border-box}
  html{
    height:100%;
    margin:0;
    /* Enable smooth scrolling */
    scroll-behavior:smooth;
    /* Optimize text rendering on mobile */
    -webkit-text-size-adjust:100%;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }
  body{
    height:100%;
    margin:0;
    background:var(--bg);
    color:#e6ecf1;
    font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
    /* Enable momentum scrolling on iOS */
    -webkit-overflow-scrolling:touch;
    /* Prevent text selection on tap/hold on mobile */
    -webkit-tap-highlight-color:transparent;
  }
  /* Better touch targets for interactive elements */
  button, a, input, select, textarea{
    -webkit-tap-highlight-color:transparent;
  }
  
  /* Background with continuous animation */
  .bg{position:fixed;inset:0;overflow:hidden;z-index:0}
  .bg img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;image-rendering:pixelated;filter:contrast(1.04) saturate(1.02)}

  /* Enhanced multi-layer lava glow animations */
  @keyframes lavaPulse{
    0%,100% { opacity:.25; filter:brightness(1.0) saturate(1.0); }
    20%     { opacity:.45; filter:brightness(1.25) saturate(1.2); }
    40%     { opacity:.35; filter:brightness(1.15) saturate(1.1); }
    60%     { opacity:.55; filter:brightness(1.35) saturate(1.3); }
    80%     { opacity:.30; filter:brightness(1.1) saturate(1.05); }
  }
  
  @keyframes lavaFlicker{
    0%,100% { opacity:0.3; }
    50%     { opacity:0.7; }
  }

  /* Primary glow layer */
  .bg::after{
    content:""; position:absolute; inset:0; pointer-events:none;
    background:
      /* Core bright glow */
      radial-gradient( circle 220px at var(--glow-x) var(--glow-y),
        rgba(255,180,80,.8), rgba(255,140,60,.4) 30%, rgba(255,100,40,.2) 50%, transparent 70%),
      /* Secondary warm glow */
      radial-gradient( ellipse 280px 400px at var(--glow-x) var(--glow-y),
        rgba(255,200,120,.5), rgba(255,160,80,.25) 40%, rgba(255,120,60,.1) 60%, transparent 80%),
      /* Outer ambient glow */
      radial-gradient( circle 350px at var(--glow-x) var(--glow-y),
        rgba(255,220,180,.2), rgba(255,180,140,.1) 50%, transparent 75%);
    mix-blend-mode: screen;
    animation: lavaPulse 6s ease-in-out infinite;
  }
  
  /* Additional flicker layer for more dynamic effect */
  .bg::before{
    content:""; position:absolute; inset:0; pointer-events:none;
    background:
      radial-gradient( circle 180px at var(--glow-x) var(--glow-y),
        rgba(255,220,180,.6), rgba(255,160,100,.2) 40%, transparent 60%);
    mix-blend-mode: color-dodge;
    animation: lavaFlicker 3s ease-in-out infinite;
  }

  /* Particle system canvas */
  .particles-canvas{
    position:fixed;
    inset:0;
    width:100%;
    height:100%;
    pointer-events:none;
    z-index:2;
  }

  /* CRT Scanlines overlay */
  .scanlines{
    position:fixed;
    inset:0;
    width:100%;
    height:100%;
    pointer-events:none;
    z-index:10;
    background:repeating-linear-gradient(
      0deg,
      rgba(0,0,0,0) 0px,
      rgba(0,0,0,0.08) 1px,
      rgba(0,0,0,0) 2px
    );
    opacity:0.4;
  }

  /* Enhanced brand design */
  .brand{
    position:fixed; 
    left:24px; 
    top:24px; 
    z-index:6;
  }
  
  .brand .title{
    font-family:'Press Start 2P', monospace;
    font-size:32px;
    letter-spacing:.08em;
    margin-bottom:12px;
    /* Multi-layer text effects */
    background: linear-gradient(180deg, var(--gold-hi) 0%, var(--gold) 50%, #D4A033 100%);
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    filter: drop-shadow(2px 2px 0px #000) 
            drop-shadow(0 0 20px rgba(255,214,77,.4))
            drop-shadow(0 0 40px rgba(255,214,77,.2));
    position: relative;
  }
  
  /* 3D effect for title */
  .brand .title::before{
    content: 'DUEL PVP';
    position: absolute;
    left: 3px;
    top: 3px;
    z-index: -1;
    background: linear-gradient(180deg, #8B6914 0%, #5C440E 100%);
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    filter: blur(0.5px);
  }

  /* Enhanced slogan with better styling */
  .brand .slogan{
    font-family: Inter, system-ui, Segoe UI, Roboto, Arial;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: #ffffff;
    opacity: 0.9;
    animation: sloganFade 8s ease-in-out infinite;
    position: relative;
    padding-left: 2px;
  }
  
  /* Divider dots between slogan parts */
  .slogan-divider{
    display: inline-block;
    width: 4px;
    height: 4px;
    background: var(--gold);
    border-radius: 50%;
    margin: 0 8px 1px;
    opacity: 0.6;
    box-shadow: 0 0 6px rgba(255,214,77,.5);
  }

  @keyframes sloganFade{
    0%, 100% { 
      opacity: 0.4; 
      filter: blur(0.5px);
    }
    50% { 
      opacity: 1; 
      filter: blur(0px) drop-shadow(0 0 8px rgba(255,255,255,.3));
    }
  }

  /* Center aligned for warrior naming screen */
  .page-container.center-aligned{
    align-items:center;
    padding-bottom:20px;
  }

  /* Page container */
  .page-container{position:fixed;inset:0;display:grid;place-items:center center;padding:20px;overflow-y:auto; z-index:4}

  /* Bottom-aligned for access code screen */
  .page-container.bottom-aligned{
    place-items:end center;
    padding-bottom:40px;
  }

  /* Modern panel styles matching dashboard */
  .panel{
    position:relative;
    width:min(520px,92vw);
    background:rgba(12,16,20,.10);
    border:2px solid rgba(255,214,77,.3);
    border-radius:12px;
    padding:32px 28px;
    backdrop-filter:blur(8px);
    box-shadow:0 8px 32px rgba(0,0,0,.4), inset 0 1px 0 rgba(255,255,255,.05);
  }

  /* Extra transparent for access code screen */
  .panel-transparent{
    background:rgba(12,16,20,.03);
  }

  .panel-header{
    text-align:center;
    margin-bottom:28px;
    padding-bottom:20px;
    border-bottom:1px solid rgba(255,214,77,.15);
  }

  .sys{
    font-family:'Press Start 2P', monospace;
    font-size:16px;
    color:var(--gold);
    text-shadow:0 0 20px rgba(255,214,77,.5);
    margin-bottom:8px;
  }
  
  .sub-text{
    font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
    font-size:13px;
    color:#a0a8b0;
    margin-top:8px;
  }
  
  /* Continuous blink animation */
  .blink{animation:blinkDot 1s infinite}
  @keyframes blinkDot{0%,50%{opacity:1}50.1%,100%{opacity:0}}

  .input-group{
    margin-bottom:16px;
  }

  .input-label{
    display:block;
    font-family:'Press Start 2P', monospace;
    font-size:10px;
    color:#a0a8b0;
    margin-bottom:8px;
    text-transform:uppercase;
  }

  .bar{display:flex;gap:12px;align-items:stretch;}
  
  .input-field{
    flex:1;
    padding:12px 14px;
    background:rgba(0,0,0,.4);
    border:1px solid rgba(255,214,77,.2);
    border-radius:8px;
    color:#e6ecf1;
    font-family:'Press Start 2P', monospace;
    font-size:11px;
    transition:all 0.2s;
  }
  
  .input-field:focus{
    outline:none;
    border-color:var(--gold);
    background:rgba(0,0,0,.6);
    box-shadow:0 0 0 2px rgba(255,214,77,.1);
  }
  
  .input-field::placeholder{
    color:rgba(160,168,176,.5);
  }

  /* Standardized button sizes */
  .btn-small{
    padding:8px 16px;
    font-size:9px;
  }
  .btn-medium{
    padding:10px 20px;
    font-size:10px;
  }
  .btn-large{
    padding:12px 24px;
    font-size:11px;
  }

  .btn-submit{
    padding:12px 24px;
    background:var(--gold);
    border:2px solid var(--gold);
    border-radius:8px;
    color:#000;
    font-family:'Press Start 2P', monospace;
    font-size:11px;
    font-weight:bold;
    cursor:pointer;
    transition:all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
    white-space:nowrap;
    position:relative;
    box-shadow:
      0 1px 2px rgba(0,0,0,.4),
      0 4px 8px rgba(0,0,0,.2),
      inset 0 1px 0 rgba(255,255,255,.3);
  }

  .btn-submit:hover{
    background:var(--gold-hi);
    transform:translateY(-2px);
    box-shadow:
      0 2px 4px rgba(0,0,0,.4),
      0 6px 16px rgba(255,214,77,.4),
      inset 0 1px 0 rgba(255,255,255,.4);
  }

  .btn-submit:active{
    transform:translateY(1px);
    box-shadow:
      0 0 2px rgba(0,0,0,.4),
      0 2px 4px rgba(0,0,0,.2),
      inset 0 2px 4px rgba(0,0,0,.2);
  }

  .helper{
    margin-top:20px;
    text-align:center;
    font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
    font-size:13px;
    color:#a0a8b0;
  }
  
  .helper a{
    color:var(--gold);
    text-decoration:none;
    cursor:pointer;
    transition:color 0.2s;
    font-family:'Press Start 2P', monospace;
    font-size:10px;
  }
  
  .helper a:hover{
    color:var(--gold-hi);
    text-shadow:0 0 8px rgba(255,214,77,.5);
  }
  
  /* Decorative elements */
  .panel::before{
    content:'';
    position:absolute;
    top:-1px;
    left:50%;
    transform:translateX(-50%);
    width:100px;
    height:1px;
    background:linear-gradient(90deg, transparent, var(--gold), transparent);
    opacity:0.8;
  }

  .footer{position:fixed;right:20px;bottom:16px;font-size:12px;opacity:.85; z-index:3; display:flex; align-items:center; gap:12px;}
  .footer a{color:var(--gold); text-decoration:none; transition:all 0.2s; display:flex; align-items:center; gap:4px;}
  .footer a:hover{opacity:1; text-shadow:0 0 8px var(--gold);}

  /* Warrior naming screen */
  .warrior-naming{
    animation: warriorEntrance 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  @keyframes warriorEntrance{
    0%{
      opacity:0;
      transform:scale(0.8) translateY(-30px);
      filter:blur(10px);
    }
    50%{
      opacity:0.5;
      transform:scale(1.05) translateY(5px);
      filter:blur(2px);
    }
    100%{
      opacity:1;
      transform:scale(1) translateY(0);
      filter:blur(0);
    }
  }

  .warrior-title{
    font-family:'Press Start 2P', monospace;
    font-size:16px;
    color:var(--gold);
    text-align:center;
    margin-bottom:24px;
    animation:titleGlow 2s ease-in-out infinite;
    text-shadow:0 0 20px rgba(255,214,77,.6);
  }

  @keyframes titleGlow{
    0%,100%{
      text-shadow:0 0 20px rgba(255,214,77,.6), 0 0 30px rgba(255,214,77,.3);
      filter:brightness(1);
    }
    50%{
      text-shadow:0 0 30px rgba(255,214,77,.8), 0 0 50px rgba(255,214,77,.5);
      filter:brightness(1.2);
    }
  }

  .warrior-input{
    width:100%;
    padding:16px;
    background:rgba(0,0,0,.5);
    border:2px solid rgba(255,214,77,.3);
    border-radius:8px;
    color:#e6ecf1;
    font-family:'Press Start 2P', monospace;
    font-size:14px;
    text-align:center;
    transition:all 0.3s;
    margin-bottom:24px;
    letter-spacing:0.1em;
  }

  .warrior-input:focus{
    outline:none;
    border-color:var(--gold);
    background:rgba(0,0,0,.7);
    box-shadow:0 0 0 3px rgba(255,214,77,.2), 0 0 30px rgba(255,214,77,.3);
    transform:scale(1.02);
  }

  .warrior-input::placeholder{
    color:#6b7280;
    font-family:Inter, system-ui, Segoe UI, Roboto, Arial;
    font-size:13px;
    letter-spacing:0.05em;
  }

  /* Dashboard specific styles */
  .dashboard-content{
    display:none;
    width:min(720px,92vw);
    background:rgba(12,16,20,.10);
    border:2px solid rgba(255,214,77,.3);
    border-radius:12px;
    padding:24px;
    backdrop-filter:blur(8px);
  }

  .dashboard-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:24px;
    padding-bottom:16px;
    border-bottom:1px solid rgba(255,214,77,.2);
  }

  .user-info{font-family:'Press Start 2P', monospace;}
  .user-name{color:var(--gold);font-size:16px;margin-bottom:4px;}
  .user-stats{color:#a0a8b0;font-size:10px;}

  .logout-btn{
    padding:8px 12px;
    background:rgba(255,214,77,.1);
    border:1px solid var(--gold);
    color:var(--gold);
    font-family:'Press Start 2P', monospace;
    font-size:10px;
    cursor:pointer;
    border-radius:4px;
    transition:all 0.2s;
  }
  .logout-btn:hover{background:rgba(255,214,77,.2);}

  .stats-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));
    gap:16px;
    margin-bottom:24px;
  }

  .stat-card{
    background:rgba(255,214,77,.05);
    border:1px solid rgba(255,214,77,.2);
    border-radius:8px;
    padding:16px;
    text-align:center;
  }

  .stat-label{
    font-family:'Press Start 2P', monospace;
    font-size:10px;
    color:#a0a8b0;
    margin-bottom:8px;
  }

  .stat-value{
    font-family:'Press Start 2P', monospace;
    font-size:18px;
    color:var(--gold);
  }

  /* Card-based dashboard layout */
  .dashboard-cards-row{
    display:grid;
    grid-template-columns:repeat(2, 1fr);
    gap:20px;
    margin-bottom:20px;
  }

  .dashboard-card{
    background:rgba(0,0,0,.3);
    border:1px solid rgba(255,214,77,.2);
    border-radius:8px;
    padding:20px;
    margin-bottom:20px;
  }

  /* Themed cards */
  .dashboard-card.invest{
    border:2px solid rgba(76,175,80,.4);
    background:rgba(16,24,16,.25);
  }

  .dashboard-card.gamble{
    border:2px solid rgba(244,67,54,.4);
    background:rgba(24,16,16,.25);
  }

  .dashboard-card.invest .card-title{
    color:#4CAF50;
    text-shadow:0 0 10px rgba(76,175,80,.5);
  }

  .dashboard-card.gamble .card-title{
    color:#F44336;
    text-shadow:0 0 10px rgba(244,67,54,.5);
  }

  .btn-invest{
    background:rgba(76,175,80,.2);
    border-color:#4CAF50;
    color:#4CAF50;
  }
  .btn-invest:hover:not(:disabled){
    background:rgba(76,175,80,.35);
    transform:translateY(-2px);
    box-shadow:0 4px 12px rgba(76,175,80,.4);
  }

  .btn-gamble{
    background:rgba(244,67,54,.2);
    border-color:#F44336;
    color:#F44336;
  }
  .btn-gamble:hover:not(:disabled){
    background:rgba(244,67,54,.35);
    transform:translateY(-2px);
    box-shadow:0 4px 12px rgba(244,67,54,.4);
  }

  .card-title{
    font-family:'Press Start 2P', monospace;
    font-size:12px;
    color:var(--gold);
    margin-bottom:16px;
    padding-bottom:12px;
    border-bottom:1px solid rgba(255,214,77,.15);
  }

  .card-content{
    font-size:13px;
    line-height:1.6;
  }

  .recent-matches{
    /* Removed redundant styles - now inside dashboard-card */
  }

  .recent-matches-content{
    filter:blur(2px);
    opacity:0.4;
    pointer-events:none;
  }

  /* Old coming-soon styles removed - now using consistent .coming-soon-wrapper approach */

  .match-list{
    display:flex;
    flex-direction:column;
    gap:8px;
  }

  .match-item{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:8px;
    background:rgba(255,214,77,.02);
    border:1px solid rgba(255,214,77,.1);
    border-radius:4px;
    font-family:'Press Start 2P', monospace;
    font-size:10px;
  }

  .match-result{
    padding:2px 6px;
    border-radius:3px;
    font-size:9px;
  }
  .win{background:rgba(76,175,80,.3);color:#4CAF50;}
  .win::before{content:'✓ ';}
  .loss{background:rgba(244,67,54,.3);color:#F44336;}
  .loss::before{content:'✕ ';}

  .dashboard-inventory{
    /* Removed redundant styles - now inside dashboard-card */
  }

  .section-title{
    font-family:'Press Start 2P', monospace;
    font-size:12px;
    color:var(--gold);
    margin-bottom:12px;
  }

  .dashboard-items-grid{
    display:grid;
    grid-template-columns:repeat(4, 1fr);
    gap:8px;
  }

  .dashboard-item-slot{
    position:relative;
    aspect-ratio:1;
    background:rgba(255,214,77,.05);
    border:2px solid rgba(255,214,77,.2);
    border-radius:8px;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    transition:all 0.2s;
  }

  .dashboard-item-slot:hover{
    background:rgba(255,214,77,.15);
    border-color:var(--gold);
    transform:translateY(-2px);
  }

  .dashboard-item-slot.empty{
    opacity:0.3;
    cursor:default;
  }

  .dashboard-item-slot.empty:hover{
    background:rgba(255,214,77,.05);
    border-color:rgba(255,214,77,.2);
    transform:none;
  }

  .dashboard-item-icon{
    font-size:24px;
    margin-bottom:4px;
  }

  .dashboard-item-name{
    font-family:'Press Start 2P', monospace;
    font-size:7px;
    color:#e6ecf1;
    text-align:center;
    line-height:1.3;
  }

  .dashboard-item-count{
    position:absolute;
    top:4px;
    right:4px;
    background:rgba(255,214,77,.9);
    color:#000;
    font-family:'Press Start 2P', monospace;
    font-size:8px;
    padding:2px 4px;
    border-radius:3px;
  }

  /* Tooltip for hover */
  .dashboard-item-tooltip{
    position:absolute;
    bottom:calc(100% + 8px);
    left:50%;
    transform:translateX(-50%);
    background:rgba(0,0,0,.95);
    border:2px solid var(--gold);
    border-radius:6px;
    padding:8px 12px;
    min-width:150px;
    z-index:1000;
    pointer-events:none;
    opacity:0;
    transition:opacity 0.2s;
  }

  .dashboard-item-slot:hover .dashboard-item-tooltip{
    opacity:1;
  }

  .tooltip-name{
    font-family:'Press Start 2P', monospace;
    font-size:9px;
    color:var(--gold);
    margin-bottom:4px;
  }

  .tooltip-desc{
    font-family:Inter, system-ui, Arial;
    font-size:11px;
    color:#e6ecf1;
    line-height:1.4;
  }

  .tooltip-type{
    font-family:'Press Start 2P', monospace;
    font-size:8px;
    color:#a0a8b0;
    margin-top:4px;
    text-transform:uppercase;
  }

  .wallet-section{
    /* Removed redundant styles - now inside dashboard-card */
  }

  .wallet-info{
    text-align:center;
  }

  .wallet-status{
    font-family:'Press Start 2P', monospace;
    font-size:11px;
    color:#a0a8b0;
    margin-bottom:8px;
    word-break:break-all;
  }

  .wallet-status.connected{
    color:#4CAF50;
  }

  .action-buttons{
    display:flex;
    gap:12px;
    margin-top:24px;
  }

  .action-btn{
    flex:1;
    padding:10px 20px;
    font-family:'Press Start 2P', monospace;
    font-size:10px;
    border-radius:8px;
    cursor:pointer;
    transition:all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
    border:2px solid;
    position:relative;
  }

  .btn-primary{
    background:var(--gold);
    border-color:var(--gold);
    color:#000;
    box-shadow:
      0 1px 2px rgba(0,0,0,.4),
      0 4px 8px rgba(0,0,0,.2),
      inset 0 1px 0 rgba(255,255,255,.3);
  }
  .btn-primary:hover{
    background:var(--gold-hi);
    transform:translateY(-2px);
    box-shadow:
      0 2px 4px rgba(0,0,0,.4),
      0 6px 16px rgba(255,214,77,.4),
      inset 0 1px 0 rgba(255,255,255,.4);
  }
  .btn-primary:active{
    transform:translateY(1px);
    box-shadow:
      0 0 2px rgba(0,0,0,.4),
      0 2px 4px rgba(0,0,0,.2),
      inset 0 2px 4px rgba(0,0,0,.2);
  }

  .btn-secondary{
    background:transparent;
    border-color:rgba(255,214,77,.5);
    color:var(--gold);
    box-shadow:
      0 1px 2px rgba(0,0,0,.3),
      inset 0 1px 0 rgba(255,214,77,.1);
  }
  .btn-secondary:hover{
    background:rgba(255,214,77,.1);
    transform:translateY(-2px);
    box-shadow:
      0 2px 4px rgba(0,0,0,.3),
      0 4px 12px rgba(255,214,77,.15),
      inset 0 1px 0 rgba(255,214,77,.2);
  }
  .btn-secondary:active{
    transform:translateY(1px);
    box-shadow:
      0 0 2px rgba(0,0,0,.3),
      inset 0 1px 3px rgba(0,0,0,.2);
  }

  /* Page transitions */
  .fade-in{
    animation: fadeIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  @keyframes fadeIn{
    from{opacity:0;transform:translateY(10px) scale(0.98);}
    to{opacity:1;transform:translateY(0) scale(1);}
  }

  .fade-in-delayed{
    opacity: 0;
    animation: fadeInDelayed 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) 1s forwards;
  }
  @keyframes fadeInDelayed{
    from{opacity:0;transform:translateY(20px) scale(0.98);}
    to{opacity:1;transform:translateY(0) scale(1);}
  }

  .fade-out{
    animation: fadeOut 0.25s cubic-bezier(0.4, 0, 0.6, 1) forwards;
  }
  @keyframes fadeOut{
    from{opacity:1;transform:translateY(0) scale(1);}
    to{opacity:0;transform:translateY(-10px) scale(0.98);}
  }

  /* Oven Investment Styles */
  .oven-container{
    display:none;
    width:min(600px,92vw);
    background:rgba(12,16,20,.92);
    border:2px solid rgba(76,175,80,.4);
    border-radius:12px;
    padding:24px;
    backdrop-filter:blur(8px);
  }

  .oven-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:24px;
    padding-bottom:16px;
    border-bottom:1px solid rgba(76,175,80,.3);
  }

  .oven-title{
    font-family:'Press Start 2P', monospace;
    font-size:18px;
    color:#4CAF50;
    text-shadow:0 0 20px rgba(76,175,80,.6);
  }

  .oven-stats-row{
    display:grid;
    grid-template-columns:repeat(3, 1fr);
    gap:12px;
    margin-bottom:20px;
  }

  .oven-stat-box{
    background:rgba(76,175,80,.08);
    border:1px solid rgba(76,175,80,.25);
    border-radius:8px;
    padding:14px;
    text-align:center;
  }

  .oven-stat-label{
    font-family:'Press Start 2P', monospace;
    font-size:8px;
    color:#a0a8b0;
    margin-bottom:8px;
    letter-spacing:0.05em;
  }

  .oven-stat-value{
    font-family:'Press Start 2P', monospace;
    font-size:16px;
    color:#e6ecf1;
  }

  .oven-stat-value.highlight{
    color:#4CAF50;
    text-shadow:0 0 10px rgba(76,175,80,.4);
  }

  .oven-timer-box{
    text-align:center;
    font-family:'Press Start 2P', monospace;
    font-size:12px;
    color:#4CAF50;
    padding:16px;
    background:rgba(76,175,80,.1);
    border:1px solid rgba(76,175,80,.3);
    border-radius:8px;
    margin-bottom:24px;
  }

  .oven-action-section{
    margin-bottom:20px;
  }

  .oven-section-title{
    font-family:'Press Start 2P', monospace;
    font-size:10px;
    color:#a0a8b0;
    margin-bottom:10px;
    letter-spacing:0.05em;
  }

  .oven-input-row{
    display:flex;
    gap:10px;
  }

  .oven-button-row{
    display:flex;
    gap:10px;
  }

  .oven-input{
    flex:1;
    padding:12px 14px;
    background:rgba(0,0,0,.4);
    border:1px solid rgba(76,175,80,.3);
    border-radius:8px;
    color:#e6ecf1;
    font-family:'Press Start 2P', monospace;
    font-size:11px;
    transition:all 0.2s;
  }

  .oven-input:focus{
    outline:none;
    border-color:#4CAF50;
    background:rgba(0,0,0,.6);
    box-shadow:0 0 0 2px rgba(76,175,80,.15);
  }

  .oven-info{
    background:rgba(76,175,80,.08);
    border:1px solid rgba(76,175,80,.2);
    border-radius:8px;
    padding:14px;
    font-family:Inter, system-ui, Arial;
    font-size:12px;
    color:#b0b8c0;
    text-align:center;
    line-height:1.6;
  }

  .oven-info strong{
    color:#4CAF50;
  }

  /* Airdrop Farm Styles */
  .farm-button-container{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:20px;
    margin:32px 0;
  }

  .farm-btn{
    width:200px;
    height:200px;
    border-radius:50%;
    background:linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
    border:4px solid rgba(76,175,80,.6);
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    transition:all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
    box-shadow:0 8px 30px rgba(76,175,80,.4), inset 0 2px 4px rgba(255,255,255,.3);
    position:relative;
    overflow:hidden;
  }

  .farm-btn:hover:not(:disabled){
    transform:scale(1.05);
    box-shadow:0 12px 40px rgba(76,175,80,.6), inset 0 2px 4px rgba(255,255,255,.4);
  }

  .farm-btn:active:not(:disabled){
    transform:scale(0.95);
  }

  .farm-btn:disabled{
    opacity:0.5;
    cursor:not-allowed;
    filter:grayscale(0.5);
  }

  .farm-btn-text{
    font-family:'Press Start 2P', monospace;
    font-size:24px;
    color:#fff;
    text-shadow:0 2px 4px rgba(0,0,0,.4);
    z-index:1;
  }

  .farm-cooldown{
    text-align:center;
    width:100%;
    max-width:300px;
  }

  .farm-cooldown-text{
    font-family:Inter, system-ui, Arial;
    font-size:14px;
    color:#b0b8c0;
    margin-bottom:8px;
  }

  .farm-cooldown-text span{
    color:#4CAF50;
    font-weight:700;
  }

  .farm-cooldown-bar{
    width:100%;
    height:8px;
    background:rgba(0,0,0,.4);
    border-radius:4px;
    overflow:hidden;
    border:1px solid rgba(76,175,80,.3);
  }

  .farm-cooldown-fill{
    height:100%;
    background:linear-gradient(90deg, #4CAF50 0%, #45a049 100%);
    transition:width 0.1s linear;
    border-radius:4px;
  }

  .farm-result{
    text-align:center;
    min-height:80px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-family:'Press Start 2P', monospace;
    font-size:32px;
    font-weight:700;
  }

  .farm-result.flash-red{
    animation:flashRed 0.5s ease-out;
    color:#f44336;
  }

  .farm-result.flash-green{
    animation:flashGreen 0.5s ease-out;
    color:#4CAF50;
  }

  .farm-result.flash-gold{
    animation:flashGold 0.8s ease-out;
    color:#FFD700;
  }

  @keyframes flashRed{
    0%{transform:scale(1); opacity:0;}
    20%{transform:scale(1.5); opacity:1;}
    100%{transform:scale(1); opacity:1;}
  }

  @keyframes flashGreen{
    0%{transform:scale(1) rotate(0deg); opacity:0;}
    20%{transform:scale(1.3) rotate(-5deg); opacity:1;}
    40%{transform:scale(1.3) rotate(5deg); opacity:1;}
    100%{transform:scale(1) rotate(0deg); opacity:1;}
  }

  @keyframes flashGold{
    0%{transform:scale(1) rotate(0deg); opacity:0; filter:brightness(1);}
    15%{transform:scale(1.5) rotate(-10deg); opacity:1; filter:brightness(1.5);}
    30%{transform:scale(1.5) rotate(10deg); opacity:1; filter:brightness(2);}
    45%{transform:scale(1.5) rotate(-5deg); opacity:1; filter:brightness(1.5);}
    60%{transform:scale(1.5) rotate(5deg); opacity:1; filter:brightness(2);}
    100%{transform:scale(1) rotate(0deg); opacity:1; filter:brightness(1);}
  }

  /* Campaign Banner Styles */
  .campaign-banner{
    background:linear-gradient(135deg, rgba(255,215,0,0.15) 0%, rgba(255,165,0,0.2) 100%);
    border:2px solid rgba(255,215,0,0.4);
    border-radius:12px;
    padding:20px 24px;
    margin-bottom:24px;
    cursor:pointer;
    transition:all 0.3s ease;
    box-shadow:0 4px 20px rgba(255,215,0,0.15);
  }

  .campaign-banner:hover{
    border-color:rgba(255,215,0,0.6);
    box-shadow:0 6px 30px rgba(255,215,0,0.25);
    transform:translateY(-2px);
  }

  .campaign-banner-header{
    display:flex;
    align-items:center;
    justify-content:center;
    gap:12px;
    margin-bottom:16px;
  }

  .campaign-banner-icon{
    font-size:24px;
  }

  .campaign-banner-text{
    font-family:'Press Start 2P', monospace;
    font-size:14px;
    color:#FFD700;
    text-shadow:0 2px 4px rgba(0,0,0,0.4);
    letter-spacing:1px;
  }

  .campaign-banner-info{
    font-size:16px;
    opacity:0.8;
  }

  .campaign-progress{
    margin-bottom:8px;
  }

  .campaign-progress-text{
    font-family:'Press Start 2P', monospace;
    font-size:10px;
    color:#FFD700;
    text-align:center;
    margin-bottom:8px;
  }

  .campaign-progress-bar{
    width:100%;
    height:8px;
    background:rgba(0,0,0,0.3);
    border-radius:4px;
    overflow:hidden;
    position:relative;
  }

  .campaign-progress-fill{
    height:100%;
    background:linear-gradient(90deg, #FFD700, #FFA500);
    border-radius:4px;
    transition:width 0.5s ease;
    box-shadow:0 0 10px rgba(255,215,0,0.5);
  }

  .campaign-time-remaining{
    font-family:Inter, system-ui, Arial;
    font-size:11px;
    color:rgba(255,215,0,0.8);
    text-align:center;
    margin-top:8px;
  }

  .gambling-disclaimer{
    background:rgba(244,67,54,0.08);
    border:1px solid rgba(244,67,54,0.2);
    border-radius:8px;
    padding:12px;
    margin-top:12px;
    font-family:Inter, system-ui, Arial;
    font-size:10px;
    color:#f44336;
    text-align:center;
    line-height:1.5;
  }

  /* Mines Game Styles */
  .mines-game-area{
    max-width:600px;
    margin:0 auto;
  }

  .mines-bet-section{
    background:rgba(0,0,0,.3);
    border:1px solid rgba(255,214,77,.2);
    border-radius:8px;
    padding:16px;
    margin-bottom:20px;
  }

  .mines-bet-row{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:12px;
  }

  .mines-input-group{
    display:flex;
    flex-direction:column;
    gap:8px;
  }

  .mines-label{
    font-family:'Press Start 2P', monospace;
    font-size:9px;
    color:#a0a8b0;
    letter-spacing:0.05em;
  }

  .mines-input{
    padding:10px 12px;
    background:rgba(0,0,0,.4);
    border:1px solid rgba(255,214,77,.2);
    border-radius:6px;
    color:#e6ecf1;
    font-family:'Press Start 2P', monospace;
    font-size:11px;
  }

  .mines-input:focus{
    outline:none;
    border-color:var(--gold);
    box-shadow:0 0 0 2px rgba(255,214,77,.1);
  }

  .mines-stats-display{
    display:grid;
    grid-template-columns:repeat(3, 1fr);
    gap:12px;
    margin-bottom:20px;
  }

  .mines-stat{
    background:rgba(0,0,0,.3);
    border:1px solid rgba(255,214,77,.2);
    border-radius:8px;
    padding:12px;
    text-align:center;
  }

  .mines-stat-label{
    font-family:'Press Start 2P', monospace;
    font-size:8px;
    color:#a0a8b0;
    margin-bottom:6px;
  }

  .mines-stat-value{
    font-family:'Press Start 2P', monospace;
    font-size:14px;
    color:var(--gold);
  }

  .mines-grid{
    display:grid;
    grid-template-columns:repeat(5, 1fr);
    gap:8px;
    margin-bottom:20px;
    max-width:400px;
    margin-left:auto;
    margin-right:auto;
  }

  .mines-tile{
    aspect-ratio:1;
    background:rgba(255,214,77,.1);
    border:2px solid rgba(255,214,77,.3);
    border-radius:8px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:24px;
    cursor:pointer;
    transition:all 0.2s;
    user-select:none;
  }

  .mines-tile:hover:not(.revealed){
    background:rgba(255,214,77,.2);
    transform:scale(1.05);
  }

  .mines-tile.revealed{
    cursor:default;
    border-color:rgba(76,175,80,.4);
    background:rgba(76,175,80,.15);
  }

  .mines-tile.mine{
    border-color:rgba(244,67,54,.6);
    background:rgba(244,67,54,.2);
    animation:mineExplode 0.5s ease-out;
  }

  @keyframes mineExplode{
    0%{transform:scale(1);}
    50%{transform:scale(1.3);}
    100%{transform:scale(1);}
  }

  .mines-tile.disabled{
    opacity:0.5;
    cursor:not-allowed;
    pointer-events:none;
  }

  .mines-info{
    background:rgba(255,214,77,.05);
    border:1px solid rgba(255,214,77,.15);
    border-radius:8px;
    padding:12px;
    text-align:center;
    font-size:12px;
    color:#a0a8b0;
    font-family:Inter, system-ui, Arial;
  }

  /* Blackjack Game Styles */
  .blackjack-game-area{
    max-width:700px;
    margin:0 auto;
  }

  .blackjack-bet-section{
    background:rgba(0,0,0,.3);
    border:1px solid rgba(255,214,77,.2);
    border-radius:8px;
    padding:16px;
    margin-bottom:20px;
  }

  .blackjack-bet-row{
    display:flex;
    gap:12px;
    align-items:flex-end;
  }

  .blackjack-input-group{
    flex:1;
    display:flex;
    flex-direction:column;
    gap:8px;
  }

  .blackjack-label{
    font-family:'Press Start 2P', monospace;
    font-size:9px;
    color:#a0a8b0;
    letter-spacing:0.05em;
  }

  .blackjack-input{
    padding:10px 12px;
    background:rgba(0,0,0,.4);
    border:1px solid rgba(255,214,77,.2);
    border-radius:6px;
    color:#e6ecf1;
    font-family:'Press Start 2P', monospace;
    font-size:11px;
  }

  .blackjack-input:focus{
    outline:none;
    border-color:var(--gold);
    box-shadow:0 0 0 2px rgba(255,214,77,.1);
  }

  .blackjack-stats-display{
    display:grid;
    grid-template-columns:repeat(3, 1fr);
    gap:12px;
    margin-bottom:20px;
  }

  .blackjack-stat{
    background:rgba(0,0,0,.3);
    border:1px solid rgba(255,214,77,.2);
    border-radius:8px;
    padding:12px;
    text-align:center;
  }

  .blackjack-stat-label{
    font-family:'Press Start 2P', monospace;
    font-size:8px;
    color:#a0a8b0;
    margin-bottom:6px;
  }

  .blackjack-stat-value{
    font-family:'Press Start 2P', monospace;
    font-size:14px;
    color:var(--gold);
  }

  .blackjack-table{
    background:rgba(16,24,16,.3);
    border:2px solid rgba(255,214,77,.2);
    border-radius:12px;
    padding:24px;
    margin-bottom:20px;
    min-height:300px;
  }

  .blackjack-hand-section{
    margin-bottom:24px;
  }

  .blackjack-hand-section.player{
    border-top:1px solid rgba(255,214,77,.1);
    padding-top:24px;
  }

  .blackjack-hand-title{
    font-family:'Press Start 2P', monospace;
    font-size:10px;
    color:#a0a8b0;
    margin-bottom:12px;
    text-align:center;
  }

  .blackjack-cards{
    display:flex;
    gap:10px;
    justify-content:center;
    flex-wrap:wrap;
    min-height:80px;
  }

  .blackjack-card{
    width:60px;
    height:84px;
    background:#fff;
    border:2px solid #333;
    border-radius:8px;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    font-family:'Press Start 2P', monospace;
    font-size:18px;
    box-shadow:0 4px 8px rgba(0,0,0,.3);
    animation:cardDeal 0.3s ease-out;
  }

  @keyframes cardDeal{
    from{
      opacity:0;
      transform:translateY(-20px) scale(0.8);
    }
    to{
      opacity:1;
      transform:translateY(0) scale(1);
    }
  }

  .blackjack-card.red{
    color:#dc143c;
  }

  .blackjack-card.black{
    color:#000;
  }

  .blackjack-card.hidden{
    background:linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
    color:#fff;
    font-size:24px;
  }

  .blackjack-card-value{
    font-size:14px;
    margin-top:4px;
  }

  .blackjack-actions{
    display:flex;
    gap:12px;
    margin-bottom:20px;
  }

  .blackjack-actions .action-btn{
    flex:1;
  }

  .blackjack-info{
    background:rgba(255,214,77,.05);
    border:1px solid rgba(255,214,77,.15);
    border-radius:8px;
    padding:12px;
    text-align:center;
    font-size:12px;
    color:#a0a8b0;
    font-family:Inter, system-ui, Arial;
  }

  /* Reaction Game Styles */
  .game-container{
    display:none;
    width:min(900px,92vw);
    background:rgba(12,16,20,.10);
    border:2px solid rgba(255,214,77,.3);
    border-radius:12px;
    padding:20px;
    backdrop-filter:blur(8px);
  }

  .game-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:16px;
    padding-bottom:12px;
    border-bottom:1px solid rgba(255,214,77,.2);
  }

  .game-title{
    font-family:'Press Start 2P', monospace;
    font-size:16px;
    color:var(--gold);
  }

  .back-btn{
    padding:8px 16px;
    background:rgba(255,214,77,.1);
    border:1px solid var(--gold);
    color:var(--gold);
    font-family:'Press Start 2P', monospace;
    font-size:9px;
    cursor:pointer;
    border-radius:4px;
    transition:all 0.2s;
  }
  .back-btn:hover{background:rgba(255,214,77,.2);}

  /* Breadcrumb Navigation */
  .breadcrumb{
    padding:12px 0;
    font-family:'Press Start 2P', monospace;
    font-size:9px;
    color:#a0a8b0;
    display:flex;
    align-items:center;
    gap:8px;
    margin-bottom:12px;
  }
  .breadcrumb-item{
    cursor:pointer;
    transition:all 0.2s;
  }
  .breadcrumb-item:hover{
    color:var(--gold-hi);
  }
  .breadcrumb-item.active{
    color:var(--gold);
    cursor:default;
  }
  .breadcrumb-separator{
    color:rgba(255,214,77,.3);
  }

  /* Game Disclaimer Bar */
  .game-disclaimer{
    background:rgba(244,67,54,.15);
    border:1px solid rgba(244,67,54,.3);
    border-radius:6px;
    padding:12px 16px;
    margin-top:16px;
    font-family:Inter,system-ui;
    font-size:11px;
    color:#F44336;
    display:flex;
    align-items:center;
    gap:8px;
  }
  .game-disclaimer.info{
    background:rgba(255,214,77,.1);
    border-color:rgba(255,214,77,.3);
    color:var(--gold);
  }
  .game-disclaimer.success{
    background:rgba(76,175,80,.15);
    border-color:rgba(76,175,80,.3);
    color:#4CAF50;
  }

  /* Empty States */
  .empty-state{
    text-align:center;
    padding:48px 24px;
    color:#a0a8b0;
  }
  .empty-state-icon{
    font-size:48px;
    margin-bottom:16px;
    opacity:0.5;
  }
  .empty-state-title{
    font-family:'Press Start 2P', monospace;
    font-size:12px;
    color:var(--gold);
    margin-bottom:12px;
  }
  .empty-state-message{
    font-family:Inter,system-ui;
    font-size:13px;
    line-height:1.6;
    max-width:400px;
    margin:0 auto;
  }

  /* Consistent Coming Soon Overlay */
  .coming-soon-wrapper{
    position:relative;
  }
  .coming-soon-wrapper.disabled{
    pointer-events:none;
  }
  .coming-soon-overlay{
    position:absolute;
    inset:0;
    background:rgba(11,15,18,.85);
    backdrop-filter:blur(4px);
    border-radius:8px;
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:5;
  }
  .coming-soon-badge{
    background:linear-gradient(135deg, var(--gold), var(--gold-hi));
    color:#000;
    padding:12px 24px;
    border-radius:8px;
    font-family:'Press Start 2P', monospace;
    font-size:11px;
    font-weight:bold;
    box-shadow:0 4px 16px rgba(255,214,77,.4);
    animation:pulse 2s ease-in-out infinite;
  }

  /* GP Animation */
  @keyframes countUp{
    0%{
      opacity:0;
      transform:translateY(10px);
    }
    100%{
      opacity:1;
      transform:translateY(0);
    }
  }
  .gp-change{
    animation:countUp 0.3s ease-out;
  }
  .gp-increase{
    color:#4CAF50;
    text-shadow:0 0 8px rgba(76,175,80,.6);
  }
  .gp-decrease{
    color:#F44336;
    text-shadow:0 0 8px rgba(244,67,54,.6);
  }

  /* Game layout - sidebar + main */
  .game-layout{
    display:grid;
    grid-template-columns:220px 1fr;
    gap:20px;
  }

  .game-sidebar{
    background:rgba(0,0,0,.3);
    border:1px solid rgba(255,214,77,.15);
    border-radius:8px;
    padding:16px;
  }

  .game-main{
    background:rgba(0,0,0,.2);
    border:1px solid rgba(255,214,77,.15);
    border-radius:8px;
    padding:20px;
  }

  .game-area{
    background:rgba(0,0,0,.5);
    border:1px solid rgba(255,214,77,.2);
    border-radius:8px;
    padding:24px;
    margin-bottom:20px;
  }

  .chart-container{
    width:100%;
    height:200px;
    background:rgba(16,20,24,.8);
    border:2px solid rgba(255,214,77,.1);
    border-radius:8px;
    position:relative;
    overflow:hidden;
    margin-bottom:16px;
    transition:all 0.2s;
  }

  .chart-container.green{
    border-color:rgba(76,175,80,.5);
    background:rgba(16,24,16,.8);
  }

  .chart-container.red{
    border-color:rgba(244,67,54,.8);
    background:rgba(24,16,16,.9);
    animation:redPulse 0.5s ease-out;
  }

  @keyframes redPulse{
    0%{box-shadow:0 0 0 0 rgba(244,67,54,.8);}
    100%{box-shadow:0 0 30px 10px rgba(244,67,54,0);}
  }

  .chart-line{
    position:absolute;
    bottom:0;
    left:0;
    right:0;
    height:60%;
    overflow:hidden;
  }

  .price-display{
    position:absolute;
    top:20px;
    right:20px;
    font-family:'Press Start 2P', monospace;
    font-size:18px;
    color:#4CAF50;
    text-shadow:0 0 10px currentColor;
    transition:all 0.2s;
  }

  .red .price-display{
    color:#F44336;
  }

  .sell-button{
    width:100%;
    padding:20px;
    font-family:'Press Start 2P', monospace;
    font-size:16px;
    background:#F44336;
    border:2px solid #D32F2F;
    color:#fff;
    border-radius:8px;
    cursor:pointer;
    transition:all 0.2s;
    text-transform:uppercase;
    letter-spacing:0.1em;
  }

  .sell-button:hover:not(:disabled){
    background:#D32F2F;
    transform:translateY(-2px);
    box-shadow:0 4px 20px rgba(244,67,54,.4);
  }

  .sell-button:active:not(:disabled){
    transform:translateY(0);
  }

  .sell-button:disabled{
    background:rgba(100,100,100,.3);
    border-color:rgba(100,100,100,.2);
    color:rgba(255,255,255,.3);
    cursor:not-allowed;
  }

  .instructions{
    background:rgba(255,214,77,.05);
    border:1px solid rgba(255,214,77,.2);
    border-radius:8px;
    padding:12px;
    margin-bottom:16px;
  }

  .instructions-title{
    font-family:'Press Start 2P', monospace;
    font-size:10px;
    color:var(--gold);
    margin-bottom:8px;
  }

  .instructions-text{
    font-family:Inter, system-ui, Arial;
    font-size:13px;
    color:#a0a8b0;
    line-height:1.6;
  }

  .attempts-counter{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:6px;
    background:rgba(0,0,0,.3);
    border:1px solid rgba(255,214,77,.2);
    border-radius:8px;
    padding:12px;
    margin-bottom:16px;
  }

  .attempts-label{
    font-family:'Press Start 2P', monospace;
    font-size:9px;
    color:#a0a8b0;
  }

  .attempts-value{
    font-family:'Press Start 2P', monospace;
    font-size:16px;
    color:var(--gold);
  }

  .results-grid{
    display:grid;
    grid-template-columns:1fr;
    gap:6px;
  }

  .result-card{
    background:rgba(255,214,77,.05);
    border:1px solid rgba(255,214,77,.2);
    border-radius:6px;
    padding:8px;
    text-align:center;
  }

  .result-card.best{
    background:rgba(76,175,80,.1);
    border-color:rgba(76,175,80,.4);
  }

  .result-attempt{
    font-family:'Press Start 2P', monospace;
    font-size:9px;
    color:#a0a8b0;
    margin-bottom:6px;
  }

  .result-time{
    font-family:'Press Start 2P', monospace;
    font-size:12px;
    color:var(--gold);
  }

  .game-status{
    text-align:center;
    font-family:'Press Start 2P', monospace;
    font-size:14px;
    padding:16px;
    margin-bottom:20px;
  }

  .status-ready{
    color:#4CAF50;
  }

  .status-go{
    color:#F44336;
  }

  .canvas-chart{
    width:100%;
    height:100%;
    image-rendering:crisp-edges;
  }

  /* Crash Rocket Game Styles */
  .crash-bet-section{
    background:rgba(255,214,77,.05);
    border:1px solid rgba(255,214,77,.2);
    border-radius:8px;
    padding:12px;
    margin-bottom:16px;
  }

  .crash-input{
    width:100%;
    background:rgba(0,0,0,.3);
    border:1px solid rgba(255,214,77,.2);
    border-radius:4px;
    padding:8px;
    color:var(--gold);
    font-family:'Press Start 2P', monospace;
    font-size:11px;
  }

  .crash-input:focus{
    outline:none;
    border-color:var(--gold);
  }

  .crash-info-section{
    background:rgba(0,0,0,.3);
    border:1px solid rgba(255,214,77,.2);
    border-radius:8px;
    padding:12px;
    margin-bottom:16px;
  }

  .crash-stat{
    padding:8px 0;
    border-bottom:1px solid rgba(255,214,77,.1);
  }

  .crash-stat:last-child{
    border-bottom:none;
  }

  .crash-history{
    background:rgba(0,0,0,.3);
    border:1px solid rgba(255,214,77,.2);
    border-radius:8px;
    padding:12px;
  }

  .crash-history-list{
    display:flex;
    flex-wrap:wrap;
    gap:4px;
    margin-top:8px;
  }

  .crash-history-item{
    font-family:'Press Start 2P', monospace;
    font-size:10px;
    padding:6px 8px;
    border-radius:4px;
    background:rgba(0,0,0,.3);
  }

  .crash-history-item.crashed-low{
    color:#F44336;
    border:1px solid rgba(244,67,54,.3);
  }

  .crash-history-item.crashed-med{
    color:#FF9800;
    border:1px solid rgba(255,152,0,.3);
  }

  .crash-history-item.crashed-high{
    color:#4CAF50;
    border:1px solid rgba(76,175,80,.3);
  }

  .crash-game-area{
    display:flex;
    flex-direction:column;
    gap:16px;
  }

  .crash-hash-display{
    background:rgba(0,0,0,.3);
    border:1px solid rgba(255,214,77,.2);
    border-radius:8px;
    padding:12px;
  }

  .crash-rocket-container{
    position:relative;
    height:350px;
    background:linear-gradient(to bottom, rgba(16,20,24,.9), rgba(16,16,32,.9));
    border:2px solid rgba(255,214,77,.2);
    border-radius:8px;
    overflow:hidden;
  }

  .crash-rocket-container.crashed{
    animation:explosion 0.5s ease-out;
    border-color:rgba(244,67,54,.8);
  }

  @keyframes explosion{
    0%{background:rgba(16,20,24,.9);}
    50%{background:rgba(244,67,54,.3);}
    100%{background:rgba(16,20,24,.9);}
  }

  .crash-multiplier-display{
    position:absolute;
    top:20px;
    left:50%;
    transform:translateX(-50%);
    text-align:center;
    z-index:10;
  }

  .crash-multiplier-value{
    font-family:'Press Start 2P', monospace;
    font-size:48px;
    color:var(--gold);
    text-shadow:0 0 20px rgba(255,214,77,.8), 0 4px 8px rgba(0,0,0,.8);
    animation:pulse 2s ease-in-out infinite;
  }

  .crash-multiplier-value.flying{
    animation:flyingPulse 0.3s ease-in-out infinite;
  }

  @keyframes flyingPulse{
    0%, 100%{transform:scale(1);}
    50%{transform:scale(1.1);}
  }

  .crash-status-text{
    font-family:'Press Start 2P', monospace;
    font-size:11px;
    color:#a0a8b0;
    margin-top:8px;
  }

  .crash-rocket{
    position:absolute;
    font-size:40px;
    bottom:20px;
    left:50%;
    transform:translateX(-50%);
    transition:all 0.05s linear;
    z-index:5;
  }

  .crash-rocket.flying{
    animation:rocketShake 0.1s infinite;
  }

  @keyframes rocketShake{
    0%, 100%{transform:translateX(-50%) rotate(-2deg);}
    50%{transform:translateX(-50%) rotate(2deg);}
  }

  .crash-trail-canvas{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    z-index:1;
  }

  .crash-cashout-btn{
    width:100%;
    padding:16px;
    background:var(--gold);
    border:2px solid var(--gold);
    color:#000;
    font-family:'Press Start 2P', monospace;
    font-size:14px;
    cursor:pointer;
    border-radius:8px;
    transition:all 0.2s;
  }

  .crash-cashout-btn:hover:not(:disabled){
    background:rgba(255,214,77,.8);
    transform:scale(1.02);
  }

  .crash-cashout-btn:disabled{
    background:rgba(255,214,77,.2);
    border-color:rgba(255,214,77,.2);
    color:rgba(255,255,255,.3);
    cursor:not-allowed;
  }

  .crash-game-status{
    text-align:center;
    font-family:'Press Start 2P', monospace;
    font-size:11px;
    color:#a0a8b0;
    padding:12px;
    background:rgba(0,0,0,.3);
    border-radius:8px;
  }

  /* Leaderboard Screen Styles */
  .leaderboard-container{
    display:none;
    width:min(780px,92vw);
    background:rgba(12,16,20,.10);
    border:2px solid rgba(255,214,77,.3);
    border-radius:12px;
    padding:24px;
    backdrop-filter:blur(8px);
  }

  .leaderboard-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:24px;
    padding-bottom:16px;
    border-bottom:1px solid rgba(255,214,77,.2);
  }

  .leaderboard-title{
    font-family:'Press Start 2P', monospace;
    font-size:18px;
    color:var(--gold);
  }

  .podium{
    display:grid;
    grid-template-columns:repeat(3, 1fr);
    gap:16px;
    margin-bottom:32px;
    align-items:flex-end;
  }

  .podium-item{
    background:rgba(255,214,77,.05);
    border:2px solid rgba(255,214,77,.2);
    border-radius:8px;
    padding:20px 16px;
    text-align:center;
    transition:all 0.3s;
    position:relative;
  }

  .podium-item.rank-1{
    order:2;
    border-color:var(--gold);
    background:rgba(255,214,77,.15);
    transform:scale(1.1);
  }

  .podium-item.rank-2{
    order:1;
    border-color:rgba(192,192,192,.5);
    background:rgba(192,192,192,.08);
  }

  .podium-item.rank-3{
    order:3;
    border-color:rgba(205,127,50,.5);
    background:rgba(205,127,50,.08);
  }

  .podium-rank{
    position:absolute;
    top:-12px;
    left:50%;
    transform:translateX(-50%);
    width:32px;
    height:32px;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    font-family:'Press Start 2P', monospace;
    font-size:11px;
    font-weight:bold;
    border:2px solid;
  }

  .rank-1 .podium-rank{
    background:var(--gold);
    border-color:var(--gold-hi);
    color:#000;
    box-shadow:0 0 20px rgba(255,214,77,.6);
  }

  .rank-2 .podium-rank{
    background:#C0C0C0;
    border-color:#E8E8E8;
    color:#000;
  }

  .rank-3 .podium-rank{
    background:#CD7F32;
    border-color:#E4A853;
    color:#000;
  }

  .podium-player{
    font-family:'Press Start 2P', monospace;
    font-size:11px;
    color:var(--gold);
    margin:8px 0 4px;
    overflow:hidden;
    text-overflow:ellipsis;
  }

  .podium-time{
    font-family:'Press Start 2P', monospace;
    font-size:16px;
    color:#4CAF50;
    margin:4px 0;
  }

  .podium-date{
    font-size:9px;
    color:#a0a8b0;
    font-family:Inter, system-ui, Arial;
  }

  .leaderboard-filters{
    display:flex;
    gap:12px;
    margin-bottom:20px;
    flex-wrap:wrap;
  }

  .filter-btn{
    padding:8px 16px;
    background:rgba(255,214,77,.1);
    border:1px solid rgba(255,214,77,.3);
    color:var(--gold);
    font-family:'Press Start 2P', monospace;
    font-size:9px;
    cursor:pointer;
    border-radius:6px;
    transition:all 0.2s;
  }

  .filter-btn.active{
    background:var(--gold);
    color:#000;
    border-color:var(--gold);
  }

  .filter-btn:hover{
    background:rgba(255,214,77,.2);
    transform:translateY(-1px);
  }

  .leaderboard-table{
    background:rgba(0,0,0,.3);
    border:1px solid rgba(255,214,77,.2);
    border-radius:8px;
    overflow:hidden;
  }

  .table-header{
    display:grid;
    grid-template-columns:60px 1fr 120px 140px;
    gap:12px;
    padding:12px 16px;
    background:rgba(255,214,77,.1);
    border-bottom:1px solid rgba(255,214,77,.2);
    font-family:'Press Start 2P', monospace;
    font-size:9px;
    color:var(--gold);
  }

  .table-row{
    display:grid;
    grid-template-columns:60px 1fr 120px 140px;
    gap:12px;
    padding:12px 16px;
    border-bottom:1px solid rgba(255,214,77,.1);
    font-family:'Press Start 2P', monospace;
    font-size:10px;
    transition:all 0.2s;
  }

  .table-row:hover{
    background:rgba(255,214,77,.05);
  }

  .table-row:last-child{
    border-bottom:none;
  }

  .table-row.user-row{
    background:rgba(76,175,80,.1);
    border:1px solid rgba(76,175,80,.3);
  }

  .rank-badge{
    color:#a0a8b0;
    text-align:center;
  }

  .player-name{
    color:#e6ecf1;
    overflow:hidden;
    text-overflow:ellipsis;
  }

  .reaction-time{
    color:#4CAF50;
    text-align:center;
  }

  .entry-date{
    color:#a0a8b0;
    font-size:9px;
    text-align:right;
  }

  .no-data{
    text-align:center;
    padding:40px 20px;
    color:#a0a8b0;
    font-family:'Press Start 2P', monospace;
    font-size:11px;
  }

  .your-best{
    background:rgba(255,214,77,.05);
    border:1px solid rgba(255,214,77,.2);
    border-radius:8px;
    padding:16px;
    margin-bottom:20px;
    text-align:center;
  }

  .your-best-label{
    font-family:'Press Start 2P', monospace;
    font-size:10px;
    color:#a0a8b0;
    margin-bottom:8px;
  }

  .your-best-time{
    font-family:'Press Start 2P', monospace;
    font-size:20px;
    color:var(--gold);
  }

  /* Loading state */
  .loading-spinner{
    display:inline-block;
    width:20px;
    height:20px;
    border:3px solid rgba(255,214,77,.2);
    border-top-color:var(--gold);
    border-radius:50%;
    animation:spin 1s linear infinite;
  }

  @keyframes spin{
    to{transform:rotate(360deg);}
  }

  /* Error message */
  .error-msg{
    color:#F44336;
    font-size:12px;
    font-family:Inter, system-ui, Arial;
    margin-top:8px;
    padding:8px 12px;
    background:rgba(244, 67, 54, 0.1);
    border-left:3px solid #F44336;
    border-radius:4px;
    display:none;
    line-height:1.4;
  }

  .error-msg.show{
    display:block;
    animation:slideDown 0.2s ease-out;
  }

  @keyframes slideDown{
    from{
      opacity:0;
      transform:translateY(-4px);
    }
    to{
      opacity:1;
      transform:translateY(0);
    }
  }

  /* Responsive improvements */
  @media(max-width:600px){
    /* Leaderboard table - improved readability */
    .table-header, .table-row{
      grid-template-columns:50px 1fr 90px;
      font-size:11px;
    }
    .entry-date{
      display:none;
    }
    .podium{
      grid-template-columns:1fr;
    }
    .podium-item.rank-1{
      order:1;
    }
    .podium-item.rank-2{
      order:2;
    }
    .podium-item.rank-3{
      order:3;
    }
    .quest-grid, .inventory-grid{
      grid-template-columns:1fr;
    }

    /* Panel and container sizing */
    .panel{
      width:96vw;
      padding:20px 16px;
      max-height:88vh;
      overflow-y:auto;
    }
    .dashboard-container, .quest-container, .leaderboard-container, .game-container, .inventory-container{
      width:96vw;
      padding:16px 12px;
      max-height:88vh;
      overflow-y:auto;
    }

    /* Typography adjustments - improved readability */
    .panel-title, .dashboard-title, .quest-title, .leaderboard-title, .game-title, .inventory-title{
      font-size:16px;
    }
    .warrior-subtitle{
      font-size:11px;
    }
    .input-label{
      font-size:12px;
    }
    .warrior-input{
      font-size:14px;
      padding:14px 16px;
    }

    /* Buttons - better touch targets (minimum 44px height) */
    .btn-submit, .back-btn, .action-btn{
      font-size:12px;
      padding:16px 20px;
      min-height:48px;
    }
    .sell-button{
      font-size:14px;
      padding:20px;
      min-height:52px;
    }

    /* Dashboard stats grid */
    .stats-grid{
      grid-template-columns:1fr;
      gap:14px;
    }
    .stat-value{
      font-size:20px;
    }
    .stat-label{
      font-size:11px;
    }

    /* Quest tabs - better touch targets */
    .quest-tabs{
      flex-wrap:wrap;
      gap:10px;
    }
    .quest-tab{
      font-size:10px;
      padding:12px 16px;
      min-height:44px;
    }

    /* Quest cards */
    .quest-card{
      padding:16px;
    }
    .quest-name{
      font-size:11px;
      line-height:1.4;
    }
    .quest-desc{
      font-size:13px;
      line-height:1.5;
    }

    /* Game layout - stack vertically on mobile */
    .game-layout{
      grid-template-columns:1fr;
      gap:16px;
    }

    /* Chart game */
    .chart-container{
      height:250px;
    }
    .price-display{
      font-size:16px;
      top:12px;
      right:12px;
    }
    .instructions-title{
      font-size:12px;
    }
    .instructions-text{
      font-size:13px;
      line-height:1.5;
    }

    /* Footer */
    .footer{
      right:10px;
      bottom:10px;
      font-size:11px;
      gap:10px;
    }
    .footer svg{
      width:16px;
      height:16px;
    }

    /* Page container */
    .page-container{
      padding:20px 12px;
    }
    .page-container.bottom-aligned{
      padding-bottom:30px;
    }

    /* Shop grid */
    .shop-grid{
      grid-template-columns:1fr;
      gap:16px;
    }

    /* Results grid */
    .results-grid{
      grid-template-columns:repeat(auto-fit, minmax(70px, 1fr));
      gap:10px;
    }
    .result-item{
      padding:10px;
      font-size:12px;
    }

    /* Coming soon overlay */
    .coming-soon-overlay{
      font-size:18px;
      padding:16px;
    }

    /* Dashboard header - stack on mobile */
    .dashboard-header{
      flex-direction:column;
      align-items:flex-start;
      gap:16px;
    }
    .dashboard-header > div:last-child{
      width:100%;
      justify-content:space-between;
      gap:8px !important;
      flex-wrap:wrap;
    }

    /* Game disclaimer - better mobile formatting */
    .game-disclaimer{
      font-size:11px;
      padding:14px;
      line-height:1.5;
    }

    /* Breadcrumb improvements */
    .breadcrumb{
      font-size:11px;
      flex-wrap:wrap;
    }

    /* Attempts counter */
    .attempts-counter{
      font-size:12px;
    }

    /* Game status */
    .game-status, .crash-game-status{
      font-size:13px;
      padding:12px;
    }
  }

  /* Quest System Styles */
  .quest-container{
    display:none;
    width:min(720px,92vw);
    background:rgba(12,16,20,.10);
    border:2px solid rgba(255,214,77,.3);
    border-radius:12px;
    padding:24px;
    backdrop-filter:blur(8px);
  }

  .quest-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:24px;
    padding-bottom:16px;
    border-bottom:1px solid rgba(255,214,77,.2);
  }

  .quest-title{
    font-family:'Press Start 2P', monospace;
    font-size:18px;
    color:var(--gold);
  }

  .quest-tabs{
    display:flex;
    gap:12px;
    margin-bottom:20px;
  }

  .quest-tab{
    padding:10px 20px;
    background:rgba(255,214,77,.1);
    border:1px solid rgba(255,214,77,.3);
    color:var(--gold);
    font-family:'Press Start 2P', monospace;
    font-size:10px;
    cursor:pointer;
    border-radius:6px;
    transition:all 0.2s;
  }

  .quest-tab.active{
    background:var(--gold);
    color:#000;
  }

  .quest-tab.locked{
    opacity:0.5;
    cursor:not-allowed;
    filter:blur(1px);
  }

  .quest-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(320px, 1fr));
    gap:16px;
    margin-bottom:20px;
    position:relative;
  }

  .quest-grid.locked{
    filter:blur(2px);
    opacity:0.4;
    pointer-events:none;
    user-select:none;
  }

  .quest-grid-wrapper{
    position:relative;
  }

  @keyframes pulse{
    0%, 100%{ opacity:1; transform:scale(1); }
    50%{ opacity:0.7; transform:scale(1.05); }
  }

  .quest-card{
    background:rgba(255,214,77,.05);
    border:1px solid rgba(255,214,77,.2);
    border-radius:8px;
    padding:16px;
    transition:all 0.2s;
  }

  .quest-card:hover{
    border-color:var(--gold);
    background:rgba(255,214,77,.1);
  }

  .quest-card.completed{
    background:rgba(76,175,80,.1);
    border-color:rgba(76,175,80,.3);
  }

  .quest-name{
    font-family:'Press Start 2P', monospace;
    font-size:11px;
    color:var(--gold);
    margin-bottom:8px;
  }

  .quest-desc{
    font-family:Inter, system-ui, Arial;
    font-size:12px;
    color:#a0a8b0;
    margin-bottom:12px;
    line-height:1.5;
  }

  .quest-progress{
    margin-bottom:10px;
  }

  .progress-bar{
    width:100%;
    height:8px;
    background:rgba(0,0,0,.4);
    border-radius:4px;
    overflow:hidden;
  }

  .progress-fill{
    height:100%;
    background:linear-gradient(90deg, var(--gold), var(--gold-hi));
    transition:width 0.3s;
  }

  .progress-text{
    font-family:'Press Start 2P', monospace;
    font-size:9px;
    color:#a0a8b0;
    margin-top:4px;
  }

  .quest-reward{
    display:flex;
    align-items:center;
    gap:8px;
    font-family:'Press Start 2P', monospace;
    font-size:10px;
    color:#4CAF50;
  }

  .quest-icon{
    font-size:16px;
  }

  /* Inventory System Styles */
  .inventory-container{
    display:none;
    width:min(600px,92vw);
    max-height:85vh;
    overflow-y:auto;
    background:rgba(12,16,20,.10);
    border:2px solid rgba(255,214,77,.3);
    border-radius:12px;
    padding:24px;
    backdrop-filter:blur(8px);
  }

  .inventory-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:24px;
    padding-bottom:16px;
    border-bottom:1px solid rgba(255,214,77,.2);
  }

  .inventory-title{
    font-family:'Press Start 2P', monospace;
    font-size:18px;
    color:var(--gold);
  }

  .gp-display{
    font-family:'Press Start 2P', monospace;
    font-size:14px;
    color:#4CAF50;
  }

  .inventory-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(100px, 1fr));
    gap:12px;
    margin-bottom:20px;
  }

  .inventory-slot{
    aspect-ratio:1;
    background:rgba(0,0,0,.4);
    border:2px solid rgba(255,214,77,.2);
    border-radius:8px;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    transition:all 0.2s;
    padding:8px;
    position:relative;
  }

  .inventory-slot:hover{
    border-color:var(--gold);
    background:rgba(255,214,77,.1);
  }

  .inventory-slot.empty{
    opacity:0.3;
  }

  .item-icon{
    font-size:32px;
    margin-bottom:4px;
  }

  .item-name{
    font-family:'Press Start 2P', monospace;
    font-size:8px;
    color:#e6ecf1;
    text-align:center;
  }

  .item-count{
    position:absolute;
    bottom:4px;
    right:4px;
    background:rgba(0,0,0,.8);
    padding:2px 4px;
    border-radius:3px;
    font-family:'Press Start 2P', monospace;
    font-size:9px;
    color:var(--gold);
  }

  .shop-section{
    position:relative;
    margin-top:30px;
    padding-top:20px;
    border-top:1px solid rgba(255,214,77,.2);
    min-height:200px;
  }

  .shop-title{
    font-family:'Press Start 2P', monospace;
    font-size:14px;
    color:var(--gold);
    margin-bottom:16px;
  }

  .shop-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(200px, 1fr));
    gap:16px;
  }

  .shop-item{
    background:rgba(255,214,77,.05);
    border:1px solid rgba(255,214,77,.2);
    border-radius:8px;
    padding:16px;
    text-align:center;
    transition:all 0.2s;
  }

  .shop-item:hover{
    border-color:var(--gold);
    background:rgba(255,214,77,.1);
  }

  .shop-item .item-icon{
    font-size:48px;
    margin-bottom:8px;
  }

  .shop-item-name{
    font-family:'Press Start 2P', monospace;
    font-size:11px;
    color:var(--gold);
    margin-bottom:8px;
  }

  .shop-item-desc{
    font-family:Inter, system-ui, Arial;
    font-size:11px;
    color:#a0a8b0;
    margin-bottom:12px;
  }

  .shop-item-price{
    font-family:'Press Start 2P', monospace;
    font-size:12px;
    color:#4CAF50;
    margin-bottom:12px;
  }

  .buy-btn{
    width:100%;
    padding:8px;
    background:var(--gold);
    border:2px solid var(--gold);
    color:#000;
    font-family:'Press Start 2P', monospace;
    font-size:10px;
    cursor:pointer;
    border-radius:6px;
    transition:all 0.2s;
  }

  .buy-btn:hover:not(:disabled){
    background:var(--gold-hi);
    transform:translateY(-2px);
  }

  .buy-btn:disabled{
    background:rgba(100,100,100,.3);
    border-color:rgba(100,100,100,.2);
    color:rgba(255,255,255,.3);
    cursor:not-allowed;
  }

  /* ===== CUSTOM MODAL SYSTEM ===== */
  .modal-overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.85);
    backdrop-filter:blur(8px);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:9999;
    animation:fadeIn 0.2s ease-out;
  }

  .modal-overlay.show{
    display:flex;
  }

  .modal-container{
    background:rgba(12,16,20,0.95);
    border:2px solid var(--gold);
    border-radius:12px;
    max-width:480px;
    width:90%;
    box-shadow:0 20px 60px rgba(0,0,0,0.8), 0 0 40px rgba(255,214,77,0.3);
    animation:modalSlideIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    overflow:hidden;
  }

  @keyframes modalSlideIn{
    0%{
      opacity:0;
      transform:scale(0.8) translateY(-40px);
    }
    100%{
      opacity:1;
      transform:scale(1) translateY(0);
    }
  }

  .modal-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:20px 24px;
    border-bottom:1px solid rgba(255,214,77,0.2);
    background:rgba(255,214,77,0.05);
  }

  .modal-title{
    font-family:'Press Start 2P', monospace;
    font-size:14px;
    color:var(--gold);
    text-shadow:0 0 10px rgba(255,214,77,0.5);
  }

  .modal-close{
    background:none;
    border:none;
    color:var(--gold);
    font-size:32px;
    line-height:1;
    cursor:pointer;
    padding:0;
    width:32px;
    height:32px;
    display:flex;
    align-items:center;
    justify-content:center;
    transition:all 0.2s;
    border-radius:4px;
  }

  .modal-close:hover{
    background:rgba(255,214,77,0.1);
    transform:scale(1.1);
  }

  .modal-body{
    padding:24px;
    font-family:Inter, system-ui, Arial;
    font-size:14px;
    line-height:1.6;
    color:#e6ecf1;
    white-space:pre-wrap;
  }

  .modal-actions{
    display:flex;
    gap:12px;
    padding:20px 24px;
    background:rgba(0,0,0,0.2);
    border-top:1px solid rgba(255,214,77,0.1);
  }

  .modal-btn{
    flex:1;
    padding:12px 24px;
    font-family:'Press Start 2P', monospace;
    font-size:10px;
    border:2px solid;
    border-radius:6px;
    cursor:pointer;
    transition:all 0.2s;
    text-transform:uppercase;
  }

  .modal-btn-primary{
    background:var(--gold);
    border-color:var(--gold-hi);
    color:#000;
    box-shadow:0 4px 12px rgba(255,214,77,0.3);
  }

  .modal-btn-primary:hover{
    background:var(--gold-hi);
    transform:translateY(-2px);
    box-shadow:0 6px 20px rgba(255,214,77,0.5);
  }

  .modal-btn-primary:active{
    transform:translateY(0);
  }

  .modal-btn-secondary{
    background:transparent;
    border-color:rgba(255,214,77,0.3);
    color:var(--gold);
  }

  .modal-btn-secondary:hover{
    background:rgba(255,214,77,0.1);
    border-color:var(--gold);
  }

  /* ===== TOAST NOTIFICATION SYSTEM ===== */
  .toast-container{
    position:fixed;
    top:20px;
    right:20px;
    z-index:10000;
    display:flex;
    flex-direction:column;
    gap:12px;
    pointer-events:none;
  }

  .toast{
    background:rgba(12,16,20,0.95);
    border:2px solid;
    border-radius:8px;
    padding:16px 20px;
    min-width:300px;
    max-width:420px;
    box-shadow:0 8px 32px rgba(0,0,0,0.6);
    display:flex;
    align-items:center;
    gap:12px;
    pointer-events:auto;
    animation:toastSlideIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    backdrop-filter:blur(8px);
  }

  .toast.removing{
    animation:toastSlideOut 0.3s ease-out forwards;
  }

  @keyframes toastSlideIn{
    0%{
      opacity:0;
      transform:translateX(400px);
    }
    100%{
      opacity:1;
      transform:translateX(0);
    }
  }

  @keyframes toastSlideOut{
    0%{
      opacity:1;
      transform:translateX(0) scale(1);
    }
    100%{
      opacity:0;
      transform:translateX(400px) scale(0.8);
    }
  }

  .toast-icon{
    font-size:24px;
    line-height:1;
    flex-shrink:0;
  }

  .toast-content{
    flex:1;
  }

  .toast-title{
    font-family:'Press Start 2P', monospace;
    font-size:10px;
    margin-bottom:4px;
    line-height:1.4;
  }

  .toast-message{
    font-family:Inter, system-ui, Arial;
    font-size:13px;
    color:#a0a8b0;
    line-height:1.4;
  }

  .toast-success{
    border-color:#4CAF50;
    background:rgba(76,175,80,0.1);
  }

  .toast-success .toast-title{
    color:#4CAF50;
  }

  .toast-error{
    border-color:#F44336;
    background:rgba(244,67,54,0.1);
  }

  .toast-error .toast-title{
    color:#F44336;
  }

  .toast-warning{
    border-color:#FF9800;
    background:rgba(255,152,0,0.1);
  }

  .toast-warning .toast-title{
    color:#FF9800;
  }

  .toast-info{
    border-color:var(--gold);
    background:rgba(255,214,77,0.1);
  }

  .toast-info .toast-title{
    color:var(--gold);
  }

  /* ===== LOADING OVERLAY ===== */
  .loading-overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.85);
    backdrop-filter:blur(8px);
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    z-index:9998;
    animation:fadeIn 0.2s ease-out;
  }

  .loading-spinner{
    position:relative;
    width:80px;
    height:80px;
  }

  .spinner-ring{
    position:absolute;
    width:100%;
    height:100%;
    border:4px solid transparent;
    border-top-color:var(--gold);
    border-radius:50%;
    animation:spinnerRotate 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;
  }

  .spinner-ring:nth-child(1){
    animation-delay:-0.45s;
    border-top-color:rgba(255,214,77,1);
  }

  .spinner-ring:nth-child(2){
    animation-delay:-0.3s;
    border-top-color:rgba(255,214,77,0.6);
  }

  .spinner-ring:nth-child(3){
    animation-delay:-0.15s;
    border-top-color:rgba(255,214,77,0.3);
  }

  @keyframes spinnerRotate{
    0%{
      transform:rotate(0deg);
    }
    100%{
      transform:rotate(360deg);
    }
  }

  .loading-text{
    margin-top:24px;
    font-family:'Press Start 2P', monospace;
    font-size:12px;
    color:var(--gold);
    text-shadow:0 0 10px rgba(255,214,77,0.5);
    animation:pulse 2s ease-in-out infinite;
  }

  /* ===== PULSE EFFECTS ===== */
  @keyframes pulse{
    0%, 100%{
      opacity:1;
      transform:scale(1);
    }
    50%{
      opacity:0.7;
      transform:scale(1.05);
    }
  }

  .pulse{
    animation:pulse 2s ease-in-out infinite;
  }

  @keyframes pulseGlow{
    0%, 100%{
      box-shadow:0 0 5px rgba(255,214,77,0.3), 0 0 10px rgba(255,214,77,0.2);
    }
    50%{
      box-shadow:0 0 20px rgba(255,214,77,0.6), 0 0 40px rgba(255,214,77,0.3);
    }
  }

  .pulse-glow{
    animation:pulseGlow 2s ease-in-out infinite;
  }

  .quest-card.claimable{
    animation:pulseGlow 2s ease-in-out infinite;
    cursor:pointer;
  }

  /* ===== ENHANCED HOVER EFFECTS ===== */
  .btn-submit, .action-btn, .back-btn, .filter-btn{
    transition:all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
    position:relative;
    overflow:hidden;
  }

  .btn-submit::before, .action-btn::before, .back-btn::before{
    content:'';
    position:absolute;
    top:50%;
    left:50%;
    width:0;
    height:0;
    border-radius:50%;
    background:rgba(255,255,255,0.2);
    transform:translate(-50%, -50%);
    transition:width 0.6s, height 0.6s;
  }

  .btn-submit:active::before, .action-btn:active::before, .back-btn:active::before{
    width:300px;
    height:300px;
  }

  .dashboard-stat{
    transition:all 0.3s ease;
  }

  .dashboard-stat:hover{
    transform:translateY(-4px) scale(1.02);
    border-color:var(--gold);
    box-shadow:0 8px 24px rgba(255,214,77,0.2);
  }

  .quest-card{
    transition:all 0.3s ease;
    transform-origin:center;
  }

  .quest-card:hover:not(.claimable){
    transform:translateY(-4px);
    box-shadow:0 8px 24px rgba(255,214,77,0.2);
  }

  .leaderboard-entry{
    transition:all 0.2s ease;
  }

  .leaderboard-entry:hover{
    background:rgba(255,214,77,0.05);
    transform:translateX(4px);
  }

  .shop-item{
    transition:all 0.3s ease;
  }

  .shop-item:hover{
    transform:translateY(-4px) scale(1.02);
    border-color:var(--gold);
    box-shadow:0 8px 24px rgba(255,214,77,0.2);
  }

  .inventory-item{
    transition:all 0.3s ease;
  }

  .inventory-item:hover{
    transform:scale(1.05) rotate(2deg);
    box-shadow:0 8px 24px rgba(255,214,77,0.3);
  }

  .podium-item{
    transition:all 0.3s ease;
  }

  .podium-item:hover{
    transform:translateY(-8px) scale(1.03);
    box-shadow:0 12px 32px rgba(255,214,77,0.3);
  }

  /* Button press effect */
  .btn-submit:active, .action-btn:active, .back-btn:active{
    transform:scale(0.95);
  }

  /* Fade in animation */
  @keyframes fadeIn{
    0%{
      opacity:0;
    }
    100%{
      opacity:1;
    }
  }

  @keyframes slideInUp{
    from{
      opacity:0;
      transform:translateY(20px);
    }
    to{
      opacity:1;
      transform:translateY(0);
    }
  }

  /* Card entrance animations */
  .dashboard-card{
    animation:slideInUp 0.4s ease-out forwards;
    opacity:0;
  }

  .dashboard-cards-row .dashboard-card:nth-child(1){animation-delay:0.1s;}
  .dashboard-cards-row .dashboard-card:nth-child(2){animation-delay:0.2s;}

  .stats-grid .stat-card{
    animation:slideInUp 0.3s ease-out forwards;
    opacity:0;
  }

  .stats-grid .stat-card:nth-child(1){animation-delay:0.05s;}
  .stats-grid .stat-card:nth-child(2){animation-delay:0.1s;}
  .stats-grid .stat-card:nth-child(3){animation-delay:0.15s;}
  .stats-grid .stat-card:nth-child(4){animation-delay:0.2s;}

  .quest-card{
    animation:slideInUp 0.4s ease-out forwards;
    opacity:0;
  }

  .quest-card:nth-child(1){animation-delay:0.1s;}
  .quest-card:nth-child(2){animation-delay:0.15s;}
  .quest-card:nth-child(3){animation-delay:0.2s;}
  .quest-card:nth-child(4){animation-delay:0.25s;}
  .quest-card:nth-child(5){animation-delay:0.3s;}
  .quest-card:nth-child(6){animation-delay:0.35s;}

  .market-bar{
    animation:slideInUp 0.4s ease-out forwards;
    opacity:0;
    animation-delay:0.25s;
  }

  /* Mobile responsive for new elements */
  @media(max-width:600px){
    /* Card layout - single column on mobile */
    .dashboard-cards-row{
      grid-template-columns:1fr;
      gap:16px;
    }

    .dashboard-card{
      padding:18px;
      margin-bottom:16px;
    }

    .card-title{
      font-size:12px;
      line-height:1.4;
    }

    .card-subtitle{
      font-size:11px;
    }

    .card-description{
      font-size:12px;
      line-height:1.5;
    }

    /* Market bar mobile optimization */
    .market-bar{
      padding:16px 20px !important;
      flex-direction:column;
      gap:12px;
      text-align:center;
    }

    .market-bar > div:first-child{
      flex-direction:column;
      gap:8px;
      width:100%;
    }

    .market-bar .action-btn{
      width:100%;
    }

    /* Toast notifications */
    .toast-container{
      top:10px;
      right:10px;
      left:10px;
    }

    .toast{
      min-width:unset;
      width:100%;
      font-size:12px;
    }

    .toast-title{
      font-size:11px;
    }

    /* Modals */
    .modal-container{
      width:94%;
      max-width:unset;
      padding:20px;
    }

    .modal-title{
      font-size:14px;
      line-height:1.4;
    }

    .modal-message{
      font-size:13px;
      line-height:1.5;
    }

    .modal-btn{
      font-size:12px;
      padding:14px 20px;
      min-height:48px;
    }

    /* Loading spinner */
    .loading-spinner{
      width:60px;
      height:60px;
    }

    .loading-text{
      font-size:12px;
    }

    /* Crash game mobile optimizations */
    .crash-rocket-container{
      height:250px;
    }

    .crash-multiplier-value{
      font-size:32px;
    }

    .crash-status-text{
      font-size:13px;
    }

    .crash-cashout-btn{
      font-size:14px;
      padding:18px;
      min-height:52px;
    }

    .crash-input{
      font-size:14px;
      padding:14px;
    }

    /* Mines game mobile */
    .mines-grid{
      gap:8px;
    }

    .mine-cell{
      font-size:18px;
      min-height:50px;
    }

    /* Blackjack mobile */
    .bj-card{
      width:50px;
      height:70px;
      font-size:18px;
    }

    .bj-hand-value{
      font-size:14px;
    }

    /* Oven game mobile */
    .oven-display{
      font-size:40px;
      padding:30px;
    }

    .oven-progress-bar{
      height:16px;
    }

    .oven-stat-value{
      font-size:16px;
    }

    .oven-stat-label{
      font-size:10px;
    }

    /* Farm game mobile */
    .farm-btn{
      width:140px;
      height:140px;
      font-size:16px;
    }

    .farm-result{
      font-size:14px;
    }

    /* Inventory items */
    .inventory-item{
      padding:14px;
    }

    .item-name{
      font-size:11px;
    }

    .item-description{
      font-size:12px;
    }

    /* Shop items */
    .shop-item{
      padding:16px;
    }

    .shop-item-title{
      font-size:12px;
    }

    .shop-item-desc{
      font-size:12px;
    }

    .shop-item-price{
      font-size:14px;
    }

    /* Stat cards in dashboard header */
    .stat-card{
      padding:10px 14px !important;
    }

    .stat-card .stat-value{
      font-size:16px !important;
    }

    .stat-card .stat-label{
      font-size:10px !important;
    }

    /* Logout button */
    .logout-btn{
      font-size:10px;
      padding:10px 12px;
      min-height:44px;
    }

    /* Input bar - stack vertically on mobile for better UX */
    .bar{
      flex-direction:column;
      gap:12px;
    }

    .btn-submit{
      width:100%;
      padding:14px 20px;
      font-size:13px;
    }

    .input-field{
      width:100%;
    }

    /* Input group spacing */
    .input-group{
      margin-bottom:20px;
    }

    .helper{
      margin-top:16px;
      font-size:12px;
    }

    /* Stat cards in header - reduce size to prevent overflow */
    .dashboard-header .stat-card{
      padding:6px 10px !important;
    }

    .dashboard-header .stat-label{
      font-size:9px !important;
    }

    .dashboard-header .stat-value{
      font-size:14px !important;
    }

    /* User info */
    .user-name{
      font-size:16px;
    }

    .user-stats{
      font-size:11px;
    }

    /* Brand title adjustments */
    .brand .title{
      font-size:20px;
    }

    .brand .slogan{
      font-size:9px;
    }
  }

  /* Extra small mobile devices (iPhone SE, etc.) */
  @media(max-width:375px){
    .brand .title{
      font-size:18px;
    }

    .panel-title, .dashboard-title, .quest-title, .leaderboard-title, .game-title, .inventory-title{
      font-size:14px;
    }

    .dashboard-header{
      gap:12px;
    }

    .stat-card{
      padding:6px 10px !important;
    }

    .dashboard-header .stat-card{
      padding:5px 8px !important;
    }

    .dashboard-header .stat-label{
      font-size:8px !important;
    }

    .dashboard-header .stat-value{
      font-size:13px !important;
    }

    .logout-btn{
      font-size:9px;
      padding:8px 10px;
    }

    .btn-submit{
      padding:14px 18px;
      font-size:12px;
    }

    .market-bar{
      padding:14px 16px !important;
    }

    .game-disclaimer{
      font-size:10px;
      padding:12px;
    }

    /* Tighter panel padding */
    .panel{
      padding:16px 12px;
    }

    .dashboard-container{
      padding:12px 10px;
    }
  }

  /* Landscape orientation on mobile */
  @media(max-width:900px) and (orientation:landscape){
    .brand .title{
      font-size:16px;
    }

    .brand .slogan{
      font-size:8px;
    }

    .panel, .dashboard-container, .quest-container, .leaderboard-container, .game-container, .inventory-container{
      max-height:85vh;
    }

    .chart-container{
      height:200px;
    }

    .crash-rocket-container{
      height:200px;
    }

    .oven-display{
      font-size:32px;
      padding:20px;
    }

    .farm-btn{
      width:120px;
      height:120px;
    }
  }
</style>
</head>
<body>
  <!-- Background always visible with continuous animation -->
  <div class="bg">
    <img src="assets/bg-wildy.png" alt="Wilderness background">
  </div>

  <!-- Particle effects canvas -->
  <canvas class="particles-canvas" id="particlesCanvas"></canvas>

  <!-- CRT Scanlines overlay -->
  <div class="scanlines"></div>

  <!-- Brand always visible with continuous animation -->
  <div class="brand">
    <div class="title">DUEL PVP</div>
    <div class="slogan">
      Real Time<span class="slogan-divider"></span>Real Skill<span class="slogan-divider"></span>Real Rewards
    </div>
  </div>

  <!-- Single page container that swaps content -->
  <main class="page-container bottom-aligned" id="pageContainer" role="main" aria-label="Main content">
    <!-- Initial page content -->
    <section class="panel panel-transparent fade-in-delayed" id="panelContent">
      <div class="panel-header">
        <div class="sys">Welcome to the arena<span class="blink">.</span></div>
        <div class="sub-text">Enter your exclusive access code to begin</div>
      </div>

      <div class="input-group">
        <label class="input-label" for="code">Access Code</label>
        <div class="bar">
          <input id="code" class="input-field" type="text" placeholder="XXXX-XXXX-XXXX" autocomplete="off" aria-label="Enter access code" aria-required="true">
          <button class="btn-submit" id="joinBtn" aria-label="Join with access code">JOIN!</button>
        </div>
      </div>

      <div class="helper">
        Already have an account? <a id="loginLink" role="button" tabindex="0" aria-label="Sign in to existing account">Sign in</a>
      </div>
    </section>

    <!-- Dashboard content (hidden initially) -->
    <div class="dashboard-content" id="dashboardContent" role="region" aria-label="User dashboard">
      <div class="dashboard-header">
        <div class="user-info">
          <div class="user-name" id="userName" aria-label="User name">Champion</div>
          <div class="user-stats" aria-label="User level and rank">Level 87 • Falafel Enjoyer</div>
        </div>
        <div style="display:flex;align-items:center;gap:20px;">
          <div class="stat-card" style="margin:0;padding:8px 16px;">
            <div class="stat-label" style="font-size:10px;">RANK</div>
            <div class="stat-value" style="font-size:16px;">#127</div>
          </div>
          <div class="stat-card" style="margin:0;padding:8px 16px;">
            <div class="stat-label" style="font-size:10px;">GP BALANCE</div>
            <div class="stat-value" style="font-size:16px;" id="dashboardGPBalance">0</div>
          </div>
          <button class="logout-btn" id="logoutBtn" aria-label="Logout from account">LOGOUT</button>
        </div>
      </div>

      <div class="stats-grid">
        <div class="stat-card" style="cursor:pointer;" id="viewLeaderboardBtn">
          <div class="stat-label">LEADERBOARD</div>
          <div class="stat-value" style="font-size:20px;">🏆</div>
        </div>
        <div class="stat-card" style="cursor:pointer;" id="viewQuestsBtn">
          <div class="stat-label">QUESTS</div>
          <div class="stat-value" style="font-size:20px;">📋</div>
        </div>
        <div class="stat-card" style="cursor:pointer;" id="viewInventoryBtn">
          <div class="stat-label">INVENTORY</div>
          <div class="stat-value" style="font-size:20px;">🎒</div>
        </div>
      </div>

      <!-- Market Bar (hidden - kept for compatibility) -->
      <div class="market-bar" id="viewShopBtn" style="display:none;"></div>

      <!-- Campaign Banner -->
      <div class="campaign-banner" id="campaignBanner">
        <div class="campaign-banner-header">
          <div class="campaign-banner-icon">🏆</div>
          <div class="campaign-banner-text">WHO WANTS TO BE A MILLIONAIRE</div>
          <div class="campaign-banner-info">ℹ️</div>
        </div>
        <div class="campaign-progress">
          <div class="campaign-progress-text">
            <span id="campaignCurrentGP">0</span> / 1,000,000 GP
          </div>
          <div class="campaign-progress-bar">
            <div class="campaign-progress-fill" id="campaignProgressFill" style="width:0%"></div>
          </div>
          <div class="campaign-time-remaining" id="campaignTimeRemaining">Campaign in progress</div>
        </div>
      </div>

      <!-- Market Section -->
      <div class="dashboard-cards-row">
        <div class="dashboard-card" style="background:linear-gradient(135deg, rgba(255,214,77,0.05) 0%, rgba(255,165,0,0.08) 100%); border-color:rgba(255,214,77,0.3);">
          <div class="card-title">🏪 MARKET</div>
          <div class="card-content">
            <button class="action-btn" disabled style="width:100%;margin-bottom:12px;opacity:0.5;cursor:not-allowed;background:rgba(255,214,77,0.1);border-color:rgba(255,214,77,0.3);color:#FFD64D;">ITEMS</button>
            <button class="action-btn" disabled style="width:100%;opacity:0.5;cursor:not-allowed;background:rgba(255,214,77,0.1);border-color:rgba(255,214,77,0.3);color:#FFD64D;">POWERUPS</button>
          </div>
        </div>
      </div>

      <!-- PVE Adventures -->
      <div class="dashboard-cards-row">
        <!-- Loot Forest -->
        <div class="dashboard-card" style="opacity:0.5;cursor:not-allowed;pointer-events:none;">
          <div class="card-title">🌲 LOOT FOREST</div>
          <div class="card-content" style="min-height:200px;opacity:0.3;">
            <div class="match-list">
              <div class="match-item">
                <span>Goblin Camp</span>
                <span class="match-result win">CLEARED</span>
              </div>
              <div class="match-item">
                <span>Ancient Trees</span>
                <span class="match-result">EXPLORED</span>
              </div>
              <div class="match-item">
                <span>Hidden Grove</span>
                <span class="match-result win">LOOTED</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Lava Dungeons -->
        <div class="dashboard-card" style="opacity:0.5;cursor:not-allowed;pointer-events:none;">
          <div class="card-title">🔥 LAVA DUNGEONS</div>
          <div class="card-content" style="min-height:200px;opacity:0.3;">
            <div class="match-list">
              <div class="match-item">
                <span>Fire Elementals</span>
                <span class="match-result loss">DEFEATED</span>
              </div>
              <div class="match-item">
                <span>Molten Core</span>
                <span class="match-result">ENTERED</span>
              </div>
              <div class="match-item">
                <span>Lava Dragon</span>
                <span class="match-result win">SLAIN</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Full-width cards -->
      <div class="dashboard-card">
        <div class="card-title">WALLET CONNECTION</div>
        <div class="card-content">
          <div class="wallet-info" id="walletInfo">
            <div class="wallet-status" id="walletStatus">No wallet connected</div>
            <button class="action-btn btn-secondary" id="connectWalletBtn" style="width:100%;margin-top:12px;">CONNECT WALLET</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Campaign Page content (hidden initially) -->
    <div class="dashboard-content" id="campaignPageContent" role="region" aria-label="Campaign page" style="display:none;">
      <div class="dashboard-header">
        <div class="user-info">
          <div class="user-name">🏆 WHO WANTS TO BE A MILLIONAIRE</div>
          <div class="user-stats">Get over 1,000,000 GP to win</div>
        </div>
        <div style="display:flex;align-items:center;gap:20px;">
          <div class="stat-card" style="margin:0;padding:8px 16px;">
            <div class="stat-label" style="font-size:10px;">RANK</div>
            <div class="stat-value" style="font-size:16px;" id="campaignRankHeader">#127</div>
          </div>
          <div class="stat-card" style="margin:0;padding:8px 16px;">
            <div class="stat-label" style="font-size:10px;">GP BALANCE</div>
            <div class="stat-value" style="font-size:16px;" id="campaignGPBalance">0</div>
          </div>
          <button class="back-btn" id="backFromCampaignBtn" aria-label="Back to dashboard">BACK</button>
        </div>
      </div>

      <!-- Campaign Progress -->
      <div class="campaign-banner" style="margin-bottom:20px;cursor:default;">
        <div class="campaign-progress">
          <div class="campaign-progress-text">
            <span id="campaignCurrentGPPage">0</span> / 1,000,000 GP
          </div>
          <div class="campaign-progress-bar">
            <div class="campaign-progress-fill" id="campaignProgressFillPage" style="width:0%"></div>
          </div>
          <div class="campaign-time-remaining" id="campaignTimeRemainingPage">Campaign in progress</div>
        </div>
      </div>

      <!-- Two-column card layout -->
      <div class="dashboard-cards-row">
        <!-- Left: DeFi -->
        <div class="dashboard-card invest">
          <div class="card-title">💎 DEFI</div>
          <div class="card-content">
            <button class="action-btn btn-invest" id="openOvenBtnCampaign" aria-label="Open Staking" style="width:100%;margin-bottom:12px;">STAKING</button>
            <button class="action-btn btn-invest" id="openFarmBtnCampaign" aria-label="Open Airdrop Farm" style="width:100%;margin-bottom:12px;">FARM</button>
            <button class="action-btn btn-invest" disabled style="width:100%;margin-bottom:12px;opacity:0.5;cursor:not-allowed;">SWAP</button>
            <button class="action-btn btn-invest" disabled style="width:100%;opacity:0.5;cursor:not-allowed;">YIELD FARMING</button>
          </div>
        </div>

        <!-- Right: Gambling -->
        <div class="dashboard-card gamble">
          <div class="card-title">🎲 GAMBLING</div>
          <div class="card-content">
            <button class="action-btn btn-gamble" id="playReactionBtnCampaign" aria-label="Play trading simulator" style="width:100%;margin-bottom:12px;">TRADING SIM</button>
            <button class="action-btn btn-gamble" id="playCrashBtnCampaign" aria-label="Play crash rocket game" style="width:100%;margin-bottom:12px;">CRASH</button>
            <button class="action-btn btn-gamble" id="playMinesBtnCampaign" aria-label="Play mines game" style="width:100%;margin-bottom:12px;">MINES</button>
            <button class="action-btn btn-gamble" id="playBlackjackBtnCampaign" aria-label="Play blackjack game" style="width:100%;">BLACKJACK</button>
            <div style="background:rgba(244,67,54,0.08);border:1px solid rgba(244,67,54,0.2);border-radius:8px;padding:12px;margin-top:12px;font-size:11px;line-height:1.6;color:rgba(244,67,54,0.9);text-align:center;">
              * Campaign uses fake tokens not exchangeable for real value.
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Leaderboard content (hidden initially) -->
    <div class="leaderboard-container" id="leaderboardContent" role="region" aria-label="Global leaderboard">
      <div class="leaderboard-header">
        <div class="leaderboard-title">GLOBAL LEADERBOARD</div>
        <button class="back-btn" id="backFromLeaderboardBtn" aria-label="Back to dashboard">BACK</button>
      </div>

      <!-- Breadcrumb -->
      <div class="breadcrumb">
        <span class="breadcrumb-item" onclick="showDashboard()">Dashboard</span>
        <span class="breadcrumb-separator">›</span>
        <span class="breadcrumb-item active">Leaderboard</span>
      </div>

      <div class="your-best" id="yourBestSection" style="display:none;">
        <div class="your-best-label">YOUR BEST TIME</div>
        <div class="your-best-time" id="yourBestTime">-- ms</div>
      </div>

      <div class="leaderboard-filters" id="leaderboardFilters" role="group" aria-label="Filter leaderboard by time period">
        <button class="filter-btn active" data-filter="all" aria-label="Show all time scores" aria-pressed="true">ALL TIME</button>
        <button class="filter-btn" data-filter="today" aria-label="Show today's scores" aria-pressed="false">TODAY</button>
        <button class="filter-btn" data-filter="week" aria-label="Show this week's scores" aria-pressed="false">THIS WEEK</button>
        <button class="filter-btn" data-filter="month" aria-label="Show this month's scores" aria-pressed="false">THIS MONTH</button>
      </div>

      <div class="podium" id="podium">
        <!-- Top 3 will be generated here -->
      </div>

      <div class="leaderboard-table">
        <div class="table-header">
          <div>RANK</div>
          <div>PLAYER</div>
          <div>TIME</div>
          <div class="entry-date">DATE</div>
        </div>
        <div id="leaderboardTableBody">
          <!-- Table rows will be generated here -->
        </div>
      </div>

      <!-- Empty state for leaderboard -->
      <div id="leaderboardEmpty" class="empty-state" style="display:none;">
        <div class="empty-state-icon">🏆</div>
        <div class="empty-state-title">No Records Yet</div>
        <div class="empty-state-message">Be the first to appear on the leaderboard! Complete games to set your record.</div>
      </div>
    </div>

    <!-- Quest content (hidden initially) -->
    <div class="quest-container" id="questContent" role="region" aria-label="Quest log">
      <div class="quest-header">
        <div class="quest-title">QUEST LOG</div>
        <button class="back-btn" id="backFromQuestsBtn" aria-label="Back to dashboard">BACK</button>
      </div>

      <!-- Breadcrumb -->
      <div class="breadcrumb">
        <span class="breadcrumb-item" onclick="showDashboard()">Dashboard</span>
        <span class="breadcrumb-separator">›</span>
        <span class="breadcrumb-item active">Quests</span>
      </div>

      <div class="quest-tabs">
        <button class="quest-tab active" data-quest-tab="daily">DAILY QUESTS</button>
        <button class="quest-tab" data-quest-tab="weekly">WEEKLY QUESTS</button>
        <button class="quest-tab" data-quest-tab="special">SPECIAL QUESTS</button>
        <button class="quest-tab" data-quest-tab="completed">COMPLETED</button>
      </div>

      <div class="quest-grid-wrapper">
        <div id="comingSoonOverlay" class="coming-soon-overlay blink" style="display:none;">COMING SOON</div>
        <div id="questGrid" class="quest-grid">
          <!-- Quest cards will be generated here -->
        </div>

        <!-- Empty state for quests -->
        <div id="questsEmpty" class="empty-state" style="display:none;">
          <div class="empty-state-icon">📋</div>
          <div class="empty-state-title">No Quests Available</div>
          <div class="empty-state-message">Check back later for new quests to complete and earn rewards!</div>
        </div>
      </div>
    </div>

    <!-- Inventory content (hidden initially) -->
    <div class="inventory-container" id="inventoryContent" role="region" aria-label="Inventory">
      <div class="inventory-header">
        <div class="inventory-title">INVENTORY</div>
        <div>
          <div class="gp-display" id="gpDisplay">GP: 0</div>
          <button class="back-btn" id="backFromInventoryBtn" aria-label="Back to dashboard" style="margin-top:8px;">BACK</button>
        </div>
      </div>

      <!-- Breadcrumb -->
      <div class="breadcrumb">
        <span class="breadcrumb-item" onclick="showDashboard()">Dashboard</span>
        <span class="breadcrumb-separator">›</span>
        <span class="breadcrumb-item active">Inventory</span>
      </div>

      <div class="inventory-grid" id="inventoryGrid">
        <!-- Inventory slots will be generated here -->
      </div>

      <!-- Empty state for inventory -->
      <div id="inventoryEmpty" class="empty-state" style="display:none;">
        <div class="empty-state-icon">🎒</div>
        <div class="empty-state-title">Empty Inventory</div>
        <div class="empty-state-message">Your inventory is empty. Visit the Market to purchase items and powerups!</div>
      </div>
    </div>

    <!-- Shop content (hidden initially) -->
    <div class="inventory-container" id="shopContent" role="region" aria-label="Market">
      <div class="inventory-header">
        <div class="inventory-title">MARKET</div>
        <div>
          <div class="gp-display" id="gpDisplayShop">GP: 0</div>
          <button class="back-btn" id="backFromShopBtn" aria-label="Back to dashboard" style="margin-top:8px;">BACK</button>
        </div>
      </div>

      <!-- Breadcrumb -->
      <div class="breadcrumb">
        <span class="breadcrumb-item" onclick="showDashboard()">Dashboard</span>
        <span class="breadcrumb-separator">›</span>
        <span class="breadcrumb-item active">Market</span>
      </div>

      <div class="coming-soon-wrapper disabled" style="position:relative;">
        <div class="shop-grid" id="shopGrid">
          <!-- Placeholder shop items for proper layout -->
          <div class="shop-item">
            <div class="item-icon">🗡️</div>
            <div class="shop-item-name">BRONZE SWORD</div>
            <div class="shop-item-desc">A sturdy starter weapon</div>
            <div class="shop-item-price">💰 1,000 GP</div>
          </div>
          <div class="shop-item">
            <div class="item-icon">🛡️</div>
            <div class="shop-item-name">IRON SHIELD</div>
            <div class="shop-item-desc">Basic defense equipment</div>
            <div class="shop-item-price">💰 1,500 GP</div>
          </div>
          <div class="shop-item">
            <div class="item-icon">⚔️</div>
            <div class="shop-item-name">STEEL BLADE</div>
            <div class="shop-item-desc">Improved attack power</div>
            <div class="shop-item-price">💰 2,500 GP</div>
          </div>
          <div class="shop-item">
            <div class="item-icon">🏹</div>
            <div class="shop-item-name">HUNTER BOW</div>
            <div class="shop-item-desc">Ranged weapon for distance</div>
            <div class="shop-item-price">💰 3,000 GP</div>
          </div>
          <div class="shop-item">
            <div class="item-icon">🪄</div>
            <div class="shop-item-name">MAGIC STAFF</div>
            <div class="shop-item-desc">Channel mystical energies</div>
            <div class="shop-item-price">💰 4,000 GP</div>
          </div>
          <div class="shop-item">
            <div class="item-icon">💎</div>
            <div class="shop-item-name">RARE GEM</div>
            <div class="shop-item-desc">Valuable collectible item</div>
            <div class="shop-item-price">💰 5,000 GP</div>
          </div>
          <div class="shop-item">
            <div class="item-icon">🎭</div>
            <div class="shop-item-name">MYSTIC MASK</div>
            <div class="shop-item-desc">Enhance your abilities</div>
            <div class="shop-item-price">💰 6,000 GP</div>
          </div>
          <div class="shop-item">
            <div class="item-icon">👑</div>
            <div class="shop-item-name">ROYAL CROWN</div>
            <div class="shop-item-desc">Ultimate prestige item</div>
            <div class="shop-item-price">💰 10,000 GP</div>
          </div>
        </div>
        <div class="coming-soon-overlay">
          <div class="coming-soon-badge">COMING SOON</div>
        </div>
      </div>
    </div>

    <!-- Staking Investment content (hidden initially) -->
    <div class="oven-container" id="ovenContent" role="region" aria-label="Staking investment">
      <div class="oven-header">
        <div class="oven-title">🔥 STAKING</div>
        <div style="display:flex;align-items:center;gap:20px;">
          <div class="stat-card" style="margin:0;padding:8px 16px;">
            <div class="stat-label" style="font-size:10px;">RANK</div>
            <div class="stat-value" style="font-size:16px;" id="ovenRankHeader">#127</div>
          </div>
          <div class="stat-card" style="margin:0;padding:8px 16px;">
            <div class="stat-label" style="font-size:10px;">GP BALANCE</div>
            <div class="stat-value" style="font-size:16px;" id="ovenGPBalance">0</div>
          </div>
          <button class="back-btn" id="backFromOvenBtn" aria-label="Back to dashboard">BACK</button>
        </div>
      </div>

      <!-- Breadcrumb -->
      <div class="breadcrumb">
        <span class="breadcrumb-item" onclick="showDashboard()">Dashboard</span>
        <span class="breadcrumb-separator">›</span>
        <span class="breadcrumb-item">DeFi</span>
        <span class="breadcrumb-separator">›</span>
        <span class="breadcrumb-item active">Staking</span>
      </div>

      <!-- Main stats display -->
      <div class="oven-stats-row">
        <div class="oven-stat-box">
          <div class="oven-stat-label">YOUR BALANCE</div>
          <div class="oven-stat-value" id="ovenUserBalance">0 GP</div>
        </div>
        <div class="oven-stat-box">
          <div class="oven-stat-label">INVESTED</div>
          <div class="oven-stat-value" id="ovenInvested">0 GP</div>
        </div>
        <div class="oven-stat-box">
          <div class="oven-stat-label">CURRENT VALUE</div>
          <div class="oven-stat-value highlight" id="ovenCurrentValue">0 GP</div>
        </div>
      </div>

      <!-- Timer -->
      <div class="oven-timer-box" id="ovenTimer">
        No active investment
      </div>

      <!-- Deposit section -->
      <div class="oven-action-section">
        <div class="oven-section-title">DEPOSIT</div>
        <div class="oven-input-row">
          <input type="number" class="oven-input" id="ovenDepositAmount" placeholder="Amount" min="1" step="1">
          <button class="action-btn btn-invest" id="ovenDepositBtn">DEPOSIT</button>
        </div>
      </div>

      <!-- Withdraw section -->
      <div class="oven-action-section">
        <div class="oven-section-title">WITHDRAW</div>
        <div class="oven-button-row">
          <button class="action-btn btn-gamble" id="ovenWithdrawBtn">WITHDRAW ALL</button>
        </div>
      </div>

      <!-- Info box -->
      <div class="oven-info">
        <strong>10% Hourly Compound Interest</strong><br>
        Your investment grows automatically every hour. Withdraw anytime.
      </div>

      <!-- Disclaimer for Oven -->
      <div class="game-disclaimer success">
        💡 <strong>Simulated Investment:</strong> This is a campaign feature with simulated returns. All GP earned counts toward your 1M GP goal for the special badge.
      </div>
    </div>

    <!-- Airdrop Farm content (hidden initially) -->
    <div class="oven-container" id="farmContent" role="region" aria-label="Airdrop farm">
      <div class="oven-header">
        <div class="oven-title">🪂 AIRDROP FARM</div>
        <div style="display:flex;align-items:center;gap:20px;">
          <div class="stat-card" style="margin:0;padding:8px 16px;">
            <div class="stat-label" style="font-size:10px;">RANK</div>
            <div class="stat-value" style="font-size:16px;" id="farmRankHeader">#127</div>
          </div>
          <div class="stat-card" style="margin:0;padding:8px 16px;">
            <div class="stat-label" style="font-size:10px;">GP BALANCE</div>
            <div class="stat-value" style="font-size:16px;" id="farmGPBalance">0</div>
          </div>
          <button class="back-btn" id="backFromFarmBtn" aria-label="Back to dashboard">BACK</button>
        </div>
      </div>

      <!-- Breadcrumb -->
      <div class="breadcrumb">
        <span class="breadcrumb-item" onclick="showDashboard()">Dashboard</span>
        <span class="breadcrumb-separator">›</span>
        <span class="breadcrumb-item">DeFi</span>
        <span class="breadcrumb-separator">›</span>
        <span class="breadcrumb-item active">Farm</span>
      </div>

      <!-- Stats display -->
      <div class="oven-stats-row">
        <div class="oven-stat-box">
          <div class="oven-stat-label">TOTAL FARMED</div>
          <div class="oven-stat-value" id="farmTotalEarned">0 GP</div>
        </div>
        <div class="oven-stat-box">
          <div class="oven-stat-label">TODAY</div>
          <div class="oven-stat-value" id="farmTodayEarned">0 GP</div>
        </div>
        <div class="oven-stat-box">
          <div class="oven-stat-label">CLICKS</div>
          <div class="oven-stat-value" id="farmTotalClicks">0</div>
        </div>
      </div>

      <!-- Main farm button area -->
      <div class="farm-button-container">
        <button class="farm-btn" id="farmClickBtn">
          <div class="farm-btn-text">FARM</div>
        </button>
        <div class="farm-cooldown" id="farmCooldown" style="display:none;">
          <div class="farm-cooldown-text">Next click in <span id="farmCooldownTimer">5</span>s</div>
          <div class="farm-cooldown-bar">
            <div class="farm-cooldown-fill" id="farmCooldownFill"></div>
          </div>
        </div>
      </div>

      <!-- Result display -->
      <div class="farm-result" id="farmResult"></div>

      <!-- Info -->
      <div class="oven-info">
        <strong>Click to Farm Airdrops!</strong><br>
        Click every 5 seconds for a chance to earn GP. Keep farming for 3 days to maximize your rewards!
      </div>

      <!-- Disclaimer for Farm -->
      <div class="game-disclaimer info">
        ⚠️ <strong>Campaign Event:</strong> 3-day farming challenge. Campaign tokens only • Not exchangeable • Counts toward 1M GP goal
      </div>
    </div>

    <!-- Reaction Game content (hidden initially) -->
    <div class="game-container" id="gameContent" role="region" aria-label="Memecoin trading simulator">
      <div class="game-header">
        <div class="game-title">📈 MEMECOIN TRADING SIMULATOR</div>
        <div style="display:flex;align-items:center;gap:20px;">
          <div class="stat-card" style="margin:0;padding:8px 16px;">
            <div class="stat-label" style="font-size:10px;">RANK</div>
            <div class="stat-value" style="font-size:16px;" id="gameRankHeader">#127</div>
          </div>
          <div class="stat-card" style="margin:0;padding:8px 16px;">
            <div class="stat-label" style="font-size:10px;">GP BALANCE</div>
            <div class="stat-value" style="font-size:16px;" id="gameGPBalance">0</div>
          </div>
          <button class="back-btn" id="backToDashBtn" aria-label="Back to dashboard">BACK</button>
        </div>
      </div>

      <!-- Breadcrumb -->
      <div class="breadcrumb">
        <span class="breadcrumb-item" onclick="showDashboard()">Dashboard</span>
        <span class="breadcrumb-separator">›</span>
        <span class="breadcrumb-item">Skills</span>
        <span class="breadcrumb-separator">›</span>
        <span class="breadcrumb-item active">Memecoin Trading Simulator</span>
      </div>

      <div class="game-layout">
        <!-- Left sidebar with instructions -->
        <div class="game-sidebar">
          <div class="instructions">
            <div class="instructions-title">HOW TO PLAY</div>
            <div class="instructions-text">
              Watch the memecoin chart pump and dump! When it turns RED and starts crashing, hit SELL as fast as you can!
              React under 1000ms to earn 300 GP. Free to play, unlimited attempts!
            </div>
          </div>

          <div class="attempts-counter">
            <span class="attempts-label">BEST TIME</span>
            <span class="attempts-value" id="attemptsLeft">-- ms</span>
          </div>

          <div class="results-grid" id="resultsGrid">
            <!-- Results will be added here dynamically -->
          </div>
        </div>

        <!-- Main game area -->
        <div class="game-main">
          <div class="game-status" id="gameStatus">Click START to begin</div>

          <div class="chart-container" id="chartContainer">
            <canvas class="canvas-chart" id="chartCanvas"></canvas>
            <div class="price-display" id="priceDisplay">$42,156</div>
          </div>

          <button class="sell-button" id="sellButton" disabled>SELL</button>

          <div class="action-buttons" style="margin-top:16px;">
            <button class="action-btn btn-primary" id="startGameBtn">START TRADE</button>
            <button class="action-btn btn-secondary" id="resetGameBtn">RESET STATS</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Crash Rocket Game content (hidden initially) -->
    <div class="game-container" id="crashContent" role="region" aria-label="Crash rocket game">
      <div class="game-header">
        <div class="game-title">ROCKET CRASH</div>
        <div style="display:flex;align-items:center;gap:20px;">
          <div class="stat-card" style="margin:0;padding:8px 16px;">
            <div class="stat-label" style="font-size:10px;">RANK</div>
            <div class="stat-value" style="font-size:16px;" id="crashRankHeader">#127</div>
          </div>
          <div class="stat-card" style="margin:0;padding:8px 16px;">
            <div class="stat-label" style="font-size:10px;">GP BALANCE</div>
            <div class="stat-value" style="font-size:16px;" id="crashGPBalance">0</div>
          </div>
          <button class="back-btn" id="backFromCrashBtn" aria-label="Back to dashboard">BACK</button>
        </div>
      </div>

      <!-- Breadcrumb -->
      <div class="breadcrumb">
        <span class="breadcrumb-item" onclick="showDashboard()">Dashboard</span>
        <span class="breadcrumb-separator">›</span>
        <span class="breadcrumb-item">Gambling</span>
        <span class="breadcrumb-separator">›</span>
        <span class="breadcrumb-item active">Rocket Crash</span>
      </div>

      <div class="game-layout">
        <!-- Left sidebar -->
        <div class="game-sidebar">
          <div class="crash-bet-section">
            <div class="instructions-title">PLACE BET</div>
            <div style="margin-bottom:12px;">
              <label style="font-size:10px;color:#a0a8b0;display:block;margin-bottom:4px;">BET AMOUNT</label>
              <input type="number" id="crashBetAmount" class="crash-input" placeholder="100" min="10" value="100">
              <div style="font-size:9px;color:#a0a8b0;margin-top:4px;">Min: 10 GP • Max: 10,000 GP</div>
            </div>
            <div style="margin-bottom:12px;">
              <label style="font-size:10px;color:#a0a8b0;display:block;margin-bottom:4px;">AUTO CASHOUT (Optional)</label>
              <input type="number" id="crashAutoCashout" class="crash-input" placeholder="2.00" min="1.01" step="0.01">
              <div style="font-size:9px;color:#a0a8b0;margin-top:4px;">Auto-cashout at multiplier</div>
            </div>
            <button class="action-btn btn-primary" id="crashPlaceBetBtn" style="width:100%;">PLACE BET</button>
          </div>

          <div class="crash-info-section">
            <div class="crash-stat">
              <div class="stat-label">YOUR GP</div>
              <div class="stat-value" id="crashGPDisplay">0</div>
            </div>
            <div class="crash-stat">
              <div class="stat-label">CURRENT BET</div>
              <div class="stat-value" id="crashCurrentBet">0</div>
            </div>
            <div class="crash-stat">
              <div class="stat-label">POTENTIAL WIN</div>
              <div class="stat-value" id="crashPotentialWin">0</div>
            </div>
          </div>

          <div class="crash-history" id="crashHistory">
            <div class="instructions-title">CRASH HISTORY</div>
            <div id="crashHistoryList" class="crash-history-list">
              <!-- History items will appear here -->
            </div>
          </div>
        </div>

        <!-- Main game area -->
        <div class="game-main">
          <div class="crash-game-area">
            <!-- Provably Fair Hash Display -->
            <div class="crash-hash-display" id="crashHashDisplay">
              <div style="font-size:9px;color:#a0a8b0;margin-bottom:4px;">PROVABLY FAIR HASH</div>
              <div style="font-family:monospace;font-size:10px;color:var(--gold);word-break:break-all;" id="crashHash">Waiting for next round...</div>
            </div>

            <!-- Rocket Animation Area -->
            <div class="crash-rocket-container" id="crashRocketContainer">
              <div class="crash-multiplier-display" id="crashMultiplierDisplay">
                <div class="crash-multiplier-value" id="crashMultiplierValue">1.00x</div>
                <div class="crash-status-text" id="crashStatusText">Waiting for bets...</div>
              </div>
              <div class="crash-rocket" id="crashRocket">🚀</div>
              <canvas class="crash-trail-canvas" id="crashTrailCanvas"></canvas>
            </div>

            <!-- Cashout Button -->
            <button class="crash-cashout-btn" id="crashCashoutBtn" disabled>CASH OUT</button>

            <!-- Game Status -->
            <div class="crash-game-status" id="crashGameStatus">
              Next round starts in <span id="crashCountdown">3</span>s
            </div>
          </div>
        </div>
      </div>

      <!-- Disclaimer for Crash Game -->
      <div class="game-disclaimer">
        ⚠️ <strong>Campaign Only:</strong> Fake tokens for Millionaire campaign • Not exchangeable • Play responsibly
      </div>
    </div>

    <!-- Mines Game content (hidden initially) -->
    <div class="game-container" id="minesContent" role="region" aria-label="Mines game">
      <div class="game-header">
        <div class="game-title">💣 MINES</div>
        <div style="display:flex;align-items:center;gap:20px;">
          <div class="stat-card" style="margin:0;padding:8px 16px;">
            <div class="stat-label" style="font-size:10px;">RANK</div>
            <div class="stat-value" style="font-size:16px;" id="minesRankHeader">#127</div>
          </div>
          <div class="stat-card" style="margin:0;padding:8px 16px;">
            <div class="stat-label" style="font-size:10px;">GP BALANCE</div>
            <div class="stat-value" style="font-size:16px;" id="minesGPBalance">0</div>
          </div>
          <button class="back-btn" id="backFromMinesBtn" aria-label="Back to dashboard">BACK</button>
        </div>
      </div>

      <!-- Breadcrumb -->
      <div class="breadcrumb">
        <span class="breadcrumb-item" onclick="showDashboard()">Dashboard</span>
        <span class="breadcrumb-separator">›</span>
        <span class="breadcrumb-item">Gambling</span>
        <span class="breadcrumb-separator">›</span>
        <span class="breadcrumb-item active">Mines</span>
      </div>

      <div class="mines-game-area">
        <!-- Betting Section -->
        <div class="mines-bet-section">
          <div class="mines-bet-row">
            <div class="mines-input-group">
              <label class="mines-label">BET AMOUNT</label>
              <input type="number" class="mines-input" id="minesBetAmount" placeholder="10" min="10" max="10000" value="100">
            </div>
            <div class="mines-input-group">
              <label class="mines-label">MINES</label>
              <select class="mines-input" id="minesCount">
                <option value="3">3 Mines</option>
                <option value="5" selected>5 Mines</option>
                <option value="10">10 Mines</option>
                <option value="15">15 Mines</option>
              </select>
            </div>
          </div>
          <button class="action-btn btn-invest" id="minesStartBtn" style="width:100%;margin-top:12px;">START GAME</button>
          <button class="action-btn btn-gamble" id="minesCashoutBtn" style="width:100%;margin-top:12px;display:none;">CASH OUT</button>
        </div>

        <!-- Stats Display -->
        <div class="mines-stats-display">
          <div class="mines-stat">
            <div class="mines-stat-label">YOUR GP</div>
            <div class="mines-stat-value" id="minesGPDisplay">0</div>
          </div>
          <div class="mines-stat">
            <div class="mines-stat-label">MULTIPLIER</div>
            <div class="mines-stat-value" id="minesMultiplier">0.00x</div>
          </div>
          <div class="mines-stat">
            <div class="mines-stat-label">PROFIT</div>
            <div class="mines-stat-value" id="minesProfit">0 GP</div>
          </div>
          <div class="mines-stat">
            <div class="mines-stat-label">REVEALED</div>
            <div class="mines-stat-value" id="minesRevealed">0 / 25</div>
          </div>
        </div>

        <!-- Mines Grid (5x5) -->
        <div class="mines-grid" id="minesGrid">
          <!-- Grid tiles will be generated by JavaScript -->
        </div>

        <!-- Game Info -->
        <div class="mines-info">
          Click tiles to reveal. Avoid the mines! Cash out anytime to secure your winnings.
        </div>
      </div>

      <!-- Disclaimer for Mines Game -->
      <div class="game-disclaimer">
        ⚠️ <strong>Campaign Only:</strong> Fake tokens for Millionaire campaign • Not exchangeable • Play responsibly
      </div>
    </div>

    <!-- Blackjack Game content (hidden initially) -->
    <div class="game-container" id="blackjackContent" role="region" aria-label="Blackjack game">
      <div class="game-header">
        <div class="game-title">♠️ BLACKJACK</div>
        <div style="display:flex;align-items:center;gap:20px;">
          <div class="stat-card" style="margin:0;padding:8px 16px;">
            <div class="stat-label" style="font-size:10px;">RANK</div>
            <div class="stat-value" style="font-size:16px;" id="blackjackRankHeader">#127</div>
          </div>
          <div class="stat-card" style="margin:0;padding:8px 16px;">
            <div class="stat-label" style="font-size:10px;">GP BALANCE</div>
            <div class="stat-value" style="font-size:16px;" id="blackjackGPBalance">0</div>
          </div>
          <button class="back-btn" id="backFromBlackjackBtn" aria-label="Back to dashboard">BACK</button>
        </div>
      </div>

      <!-- Breadcrumb -->
      <div class="breadcrumb">
        <span class="breadcrumb-item" onclick="showDashboard()">Dashboard</span>
        <span class="breadcrumb-separator">›</span>
        <span class="breadcrumb-item">Gambling</span>
        <span class="breadcrumb-separator">›</span>
        <span class="breadcrumb-item active">Blackjack</span>
      </div>

      <div class="blackjack-game-area">
        <!-- Betting Section -->
        <div class="blackjack-bet-section">
          <div class="blackjack-bet-row">
            <div class="blackjack-input-group">
              <label class="blackjack-label">BET AMOUNT</label>
              <input type="number" class="blackjack-input" id="blackjackBetAmount" placeholder="10" min="10" max="10000" value="100">
            </div>
            <button class="action-btn btn-invest" id="blackjackDealBtn" style="flex:1;">DEAL</button>
          </div>
        </div>

        <!-- Stats Display -->
        <div class="blackjack-stats-display">
          <div class="blackjack-stat">
            <div class="blackjack-stat-label">YOUR GP</div>
            <div class="blackjack-stat-value" id="blackjackGPDisplay">0</div>
          </div>
          <div class="blackjack-stat">
            <div class="blackjack-stat-label">YOUR HAND</div>
            <div class="blackjack-stat-value" id="blackjackPlayerValue">0</div>
          </div>
          <div class="blackjack-stat">
            <div class="blackjack-stat-label">DEALER HAND</div>
            <div class="blackjack-stat-value" id="blackjackDealerValue">0</div>
          </div>
          <div class="blackjack-stat">
            <div class="blackjack-stat-label">BET</div>
            <div class="blackjack-stat-value" id="blackjackCurrentBet">0 GP</div>
          </div>
        </div>

        <!-- Game Table -->
        <div class="blackjack-table">
          <!-- Dealer's Hand -->
          <div class="blackjack-hand-section">
            <div class="blackjack-hand-title">DEALER</div>
            <div class="blackjack-cards" id="blackjackDealerCards">
              <!-- Cards will be added here -->
            </div>
          </div>

          <!-- Player's Hand -->
          <div class="blackjack-hand-section player">
            <div class="blackjack-hand-title">YOU</div>
            <div class="blackjack-cards" id="blackjackPlayerCards">
              <!-- Cards will be added here -->
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="blackjack-actions" id="blackjackActions" style="display:none;">
          <button class="action-btn btn-invest" id="blackjackHitBtn">HIT</button>
          <button class="action-btn btn-gamble" id="blackjackStandBtn">STAND</button>
        </div>

        <!-- Game Info -->
        <div class="blackjack-info" id="blackjackGameInfo">
          Place your bet and click DEAL to start. Get closer to 21 than the dealer without going over!
        </div>
      </div>

      <!-- Disclaimer for Blackjack Game -->
      <div class="game-disclaimer">
        ⚠️ <strong>Campaign Only:</strong> Fake tokens for Millionaire campaign • Not exchangeable • Play responsibly
      </div>
    </div>
  </main>

  <!-- Custom Modal System -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal-container">
      <div class="modal-header">
        <div class="modal-title" id="modalTitle">Confirmation</div>
        <button class="modal-close" id="modalClose" aria-label="Close modal">×</button>
      </div>
      <div class="modal-body" id="modalBody">
        Are you sure?
      </div>
      <div class="modal-actions" id="modalActions">
        <button class="modal-btn modal-btn-secondary" id="modalCancelBtn">CANCEL</button>
        <button class="modal-btn modal-btn-primary" id="modalConfirmBtn">CONFIRM</button>
      </div>
    </div>
  </div>

  <!-- Toast Notification Container -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay" style="display:none;">
    <div class="loading-spinner">
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
    </div>
    <div class="loading-text" id="loadingText">Loading...</div>
  </div>

  <div class="footer">
    <span>© 2025 Duel PVP</span>
    <a href="https://x.com/YourProject" target="_blank" rel="noopener noreferrer" aria-label="Follow us on X">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
      </svg>
    </a>
  </div>

  <script>
    // ===== SUPABASE CLIENT =====
    const SUPABASE_URL = 'https://smgqccnggmyreacjyyil.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNtZ3FjY25nZ215cmVhY2p5eWlsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5ODIwNDgsImV4cCI6MjA3ODU1ODA0OH0.y1AeyXkKCdVvE3JUIlCyDl6p12TFrgMkEiUocUB4YMI';

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // ===== MODAL SYSTEM =====
    const Modal = {
      overlay: null,
      title: null,
      body: null,
      actions: null,
      confirmBtn: null,
      cancelBtn: null,
      closeBtn: null,
      resolveCallback: null,

      init() {
        this.overlay = document.getElementById('modalOverlay');
        this.title = document.getElementById('modalTitle');
        this.body = document.getElementById('modalBody');
        this.actions = document.getElementById('modalActions');
        this.confirmBtn = document.getElementById('modalConfirmBtn');
        this.cancelBtn = document.getElementById('modalCancelBtn');
        this.closeBtn = document.getElementById('modalClose');

        // Close modal handlers
        this.closeBtn.addEventListener('click', () => this.close(false));
        this.cancelBtn.addEventListener('click', () => this.close(false));
        this.confirmBtn.addEventListener('click', () => this.close(true));

        // Close on overlay click
        this.overlay.addEventListener('click', (e) => {
          if (e.target === this.overlay) this.close(false);
        });

        // Close on ESC key
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && this.overlay.classList.contains('show')) {
            this.close(false);
          }
        });
      },

      show(options) {
        return new Promise((resolve) => {
          this.resolveCallback = resolve;

          this.title.textContent = options.title || 'Confirmation';
          this.body.textContent = options.message || '';

          // Show/hide action buttons based on type
          if (options.type === 'alert') {
            this.cancelBtn.style.display = 'none';
            this.confirmBtn.textContent = 'OK';
          } else {
            this.cancelBtn.style.display = 'block';
            this.confirmBtn.textContent = options.confirmText || 'CONFIRM';
            this.cancelBtn.textContent = options.cancelText || 'CANCEL';
          }

          this.overlay.classList.add('show');
        });
      },

      close(confirmed) {
        this.overlay.classList.remove('show');
        if (this.resolveCallback) {
          this.resolveCallback(confirmed);
          this.resolveCallback = null;
        }
      },

      alert(message, title = 'Alert') {
        return this.show({ type: 'alert', message, title });
      },

      confirm(message, title = 'Confirmation') {
        return this.show({ type: 'confirm', message, title });
      }
    };

    // ===== TOAST NOTIFICATION SYSTEM =====
    const Toast = {
      container: null,

      init() {
        this.container = document.getElementById('toastContainer');
      },

      show(options) {
        const toast = document.createElement('div');
        toast.className = `toast toast-${options.type || 'info'}`;

        const icon = this.getIcon(options.type);
        const title = options.title || this.getDefaultTitle(options.type);

        toast.innerHTML = `
          <div class="toast-icon">${icon}</div>
          <div class="toast-content">
            <div class="toast-title">${title}</div>
            ${options.message ? `<div class="toast-message">${options.message}</div>` : ''}
          </div>
        `;

        this.container.appendChild(toast);

        // Auto dismiss after duration
        const duration = options.duration || 3000;
        setTimeout(() => {
          this.remove(toast);
        }, duration);

        return toast;
      },

      remove(toast) {
        toast.classList.add('removing');
        setTimeout(() => {
          if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
          }
        }, 300);
      },

      success(message, title) {
        return this.show({ type: 'success', message, title });
      },

      error(message, title) {
        return this.show({ type: 'error', message, title });
      },

      warning(message, title) {
        return this.show({ type: 'warning', message, title });
      },

      info(message, title) {
        return this.show({ type: 'info', message, title });
      },

      getIcon(type) {
        const icons = {
          success: '✓',
          error: '✕',
          warning: '⚠',
          info: 'ℹ'
        };
        return icons[type] || icons.info;
      },

      getDefaultTitle(type) {
        const titles = {
          success: 'SUCCESS',
          error: 'ERROR',
          warning: 'WARNING',
          info: 'INFO'
        };
        return titles[type] || 'INFO';
      }
    };

    // ===== LOADING OVERLAY =====
    const Loading = {
      overlay: null,
      text: null,

      init() {
        this.overlay = document.getElementById('loadingOverlay');
        this.text = document.getElementById('loadingText');
      },

      show(message = 'Loading...') {
        this.text.textContent = message;
        this.overlay.style.display = 'flex';
      },

      hide() {
        this.overlay.style.display = 'none';
      }
    };

    // Initialize systems on DOM ready
    document.addEventListener('DOMContentLoaded', () => {
      Modal.init();
      Toast.init();
      Loading.init();
    });

    // Particle System
    class ParticleSystem {
      constructor(canvas) {
        this.canvas = canvas;
        this.ctx = canvas.getContext('2d');
        this.particles = [];
        this.resize();
        window.addEventListener('resize', () => this.resize());
        this.animate();
      }

      resize() {
        this.canvas.width = window.innerWidth;
        this.canvas.height = window.innerHeight;
      }

      createLavaEmber() {
        // Embers rise from lava areas (bottom 40% of screen, concentrated in center-right where lava is)
        return {
          x: Math.random() * this.canvas.width * 0.7 + this.canvas.width * 0.15, // Center 70% of screen
          y: this.canvas.height - Math.random() * 50, // Start near bottom
          vx: (Math.random() - 0.5) * 0.3, // Slight horizontal drift
          vy: -(Math.random() * 0.8 + 0.3), // Rise upward (slower)
          size: Math.random() * 3 + 1, // 1-4px
          life: 1,
          decay: Math.random() * 0.003 + 0.001, // Fade out slowly
          color: Math.random() > 0.5 ? 'rgba(255,140,60,' : 'rgba(255,100,40,', // Orange/red
          twinkle: Math.random() * Math.PI * 2,
          twinkleSpeed: Math.random() * 0.05 + 0.02,
          type: 'ember'
        };
      }

      createTwinklingStar() {
        // Stars appear in top 30% of screen with size variations
        const sizeRoll = Math.random();
        let size, glowIntensity;

        if (sizeRoll > 0.95) {
          // 5% chance - Large bright star
          size = Math.random() * 1.5 + 2.5; // 2.5-4px
          glowIntensity = 1.2;
        } else if (sizeRoll > 0.7) {
          // 25% chance - Medium star
          size = Math.random() * 1 + 1.5; // 1.5-2.5px
          glowIntensity = 0.9;
        } else {
          // 70% chance - Small star
          size = Math.random() * 0.8 + 0.5; // 0.5-1.3px
          glowIntensity = 0.6;
        }

        return {
          x: Math.random() * this.canvas.width,
          y: Math.random() * this.canvas.height * 0.3, // Top 30%
          vx: 0,
          vy: 0,
          size: size,
          life: 1,
          decay: 0, // Stars don't fade out
          color: 'rgba(255,255,255,',
          twinkle: Math.random() * Math.PI * 2,
          twinkleSpeed: Math.random() * 0.03 + 0.01,
          glowIntensity: glowIntensity,
          type: 'star'
        };
      }

      createShootingStar() {
        // Shooting stars streak across the top half
        const startSide = Math.random() > 0.5 ? 'left' : 'right';
        return {
          x: startSide === 'left' ? 0 : this.canvas.width,
          y: Math.random() * this.canvas.height * 0.4, // Top 40%
          vx: (startSide === 'left' ? 1 : -1) * (Math.random() * 3 + 4), // Fast horizontal
          vy: Math.random() * 0.5 + 0.5, // Slight downward angle
          size: Math.random() * 1 + 1.5, // 1.5-2.5px
          life: 1,
          decay: 0.015, // Fade quickly
          color: 'rgba(255,255,220,',
          tailLength: Math.random() * 40 + 60, // 60-100px tail
          type: 'shooting'
        };
      }

      animate() {
        requestAnimationFrame(() => this.animate());

        // Clear canvas
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

        // Add new particles
        if (Math.random() < 0.15) { // 15% chance each frame for embers
          this.particles.push(this.createLavaEmber());
        }

        // Occasionally add shooting stars (rare)
        if (Math.random() < 0.002) { // 0.2% chance per frame (~1 every 8 seconds)
          this.particles.push(this.createShootingStar());
        }

        // Update and draw particles
        this.particles = this.particles.filter(p => {
          // Update position
          p.x += p.vx;
          p.y += p.vy;

          // Update life
          p.life -= p.decay;

          // Update twinkle (if applicable)
          if (p.twinkle !== undefined) {
            p.twinkle += p.twinkleSpeed;
          }

          // Calculate opacity and draw based on type
          let opacity;

          if (p.type === 'star') {
            opacity = (Math.sin(p.twinkle) * 0.3 + 0.7) * 0.6 * p.glowIntensity;
            this.ctx.shadowBlur = p.size * 8 * p.glowIntensity;
            this.ctx.shadowColor = `rgba(255,255,255,${0.8 * p.glowIntensity})`;
            this.ctx.fillStyle = p.color + opacity + ')';
            this.ctx.beginPath();
            this.ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
            this.ctx.fill();

          } else if (p.type === 'shooting') {
            opacity = p.life;
            // Draw shooting star trail
            const gradient = this.ctx.createLinearGradient(
              p.x, p.y,
              p.x - p.vx * p.tailLength / 5, p.y - p.vy * p.tailLength / 5
            );
            gradient.addColorStop(0, `rgba(255,255,220,${opacity * 0.8})`);
            gradient.addColorStop(0.5, `rgba(255,255,255,${opacity * 0.4})`);
            gradient.addColorStop(1, 'rgba(255,255,255,0)');

            this.ctx.shadowBlur = 15;
            this.ctx.shadowColor = `rgba(255,255,220,${opacity})`;
            this.ctx.strokeStyle = gradient;
            this.ctx.lineWidth = p.size * 2;
            this.ctx.lineCap = 'round';
            this.ctx.beginPath();
            this.ctx.moveTo(p.x, p.y);
            this.ctx.lineTo(p.x - p.vx * 10, p.y - p.vy * 10);
            this.ctx.stroke();

            // Draw bright head
            this.ctx.fillStyle = `rgba(255,255,255,${opacity})`;
            this.ctx.beginPath();
            this.ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
            this.ctx.fill();

          } else { // ember
            opacity = p.life * (Math.sin(p.twinkle) * 0.2 + 0.8);
            this.ctx.shadowBlur = p.size * 8;
            this.ctx.shadowColor = 'rgba(255,140,60,0.6)';
            this.ctx.fillStyle = p.color + opacity + ')';
            this.ctx.beginPath();
            this.ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
            this.ctx.fill();
          }

          // Keep particle if alive and on screen
          if (p.type === 'star') {
            return true; // Stars stay forever
          } else if (p.type === 'shooting') {
            return p.life > 0 && p.x > -100 && p.x < this.canvas.width + 100; // Shooting stars fade or leave screen
          } else {
            return p.life > 0 && p.y > -50; // Embers fade or go off screen
          }
        });

        // Maintain star count
        const starCount = this.particles.filter(p => p.type === 'star').length;
        if (starCount < 40) { // Keep ~40 stars with variations
          this.particles.push(this.createTwinklingStar());
        }
      }
    }

    // Initialize particle system
    const particlesCanvas = document.getElementById('particlesCanvas');
    const particleSystem = new ParticleSystem(particlesCanvas);

    // Single page app logic
    const pageContainer = document.getElementById('pageContainer');
    const panelContent = document.getElementById('panelContent');
    const dashboardContent = document.getElementById('dashboardContent');
    const campaignPageContent = document.getElementById('campaignPageContent');
    const gameContent = document.getElementById('gameContent');
    const ovenContent = document.getElementById('ovenContent');
    const farmContent = document.getElementById('farmContent');
    const minesContent = document.getElementById('minesContent');
    const blackjackContent = document.getElementById('blackjackContent');
    const leaderboardContent = document.getElementById('leaderboardContent');
    const questContent = document.getElementById('questContent');
    const inventoryContent = document.getElementById('inventoryContent');
    const shopContent = document.getElementById('shopContent');
    const crashContent = document.getElementById('crashContent');

    // Debug: Check if all elements exist
    console.log('Elements loaded:', {
      pageContainer: !!pageContainer,
      panelContent: !!panelContent,
      dashboardContent: !!dashboardContent,
      gameContent: !!gameContent,
      leaderboardContent: !!leaderboardContent,
      questContent: !!questContent,
      inventoryContent: !!inventoryContent,
      viewLeaderboardBtn: !!document.getElementById('viewLeaderboardBtn')
    });
    
    // Game variables
    let gameState = {
      attempts: [],
      bestTime: null,
      isPlaying: false,
      startTime: null,
      reactionTimer: null,
      chartAnimation: null
    };

    // Temporary registration data
    let tempRegistrationData = {
      email: '',
      warriorName: '',
      password: '',
      inviteCode: ''
    };

    // Helper function to swap content with fade animation
    function swapContent(newContent, data) {
      // Find currently visible element
      const allContainers = [panelContent, dashboardContent, campaignPageContent, gameContent, ovenContent, farmContent, minesContent, blackjackContent, leaderboardContent, questContent, inventoryContent, shopContent, crashContent];
      const currentVisible = allContainers.find(el => el.style.display !== 'none' && el.style.display !== '');

      // Add fade-out to current visible element
      if (currentVisible) {
        currentVisible.classList.add('fade-out');
        currentVisible.classList.remove('fade-in', 'fade-in-delayed');
      }

      // Wait for fade-out animation, then swap content
      setTimeout(() => {
        if (newContent === 'login') {
          panelContent.style.display = 'block';
          dashboardContent.style.display = 'none';
          gameContent.style.display = 'none';
          leaderboardContent.style.display = 'none';
          questContent.style.display = 'none';
          inventoryContent.style.display = 'none';
          panelContent.classList.remove('panel-transparent');
          pageContainer.classList.remove('bottom-aligned');

          panelContent.innerHTML = `
          <div class="panel-header">
            <div class="sys">Welcome back, champion<span class="blink">.</span></div>
            <div class="sub-text">Enter your credentials to access the arena</div>
          </div>

          <div class="input-group">
            <label class="input-label">Email Address</label>
            <input id="loginEmail" class="input-field" type="email" placeholder="name@example.com" autocomplete="email">
            <div class="error-msg" id="emailError"></div>
          </div>

          <div class="input-group">
            <label class="input-label">Password</label>
            <div class="bar">
              <input id="loginPass" class="input-field" type="password" placeholder="Enter your password" autocomplete="current-password">
              <button class="btn-submit" id="loginBtn">LOG IN</button>
            </div>
            <div class="error-msg" id="passError"></div>
          </div>

          <div class="helper">
            Don't have access? <a id="backLink">Get access code</a>
          </div>

          <div style="text-align:center;margin-top:20px;padding-top:20px;border-top:1px solid rgba(255,214,77,.15);">
            <div style="font-family:Inter,system-ui,Arial;font-size:11px;color:#a0a8b0;margin-bottom:12px;">OR</div>
            <button class="action-btn btn-secondary" id="walletLoginBtn" style="width:100%;">SIGN IN WITH WALLET</button>
          </div>
        `;

        // Re-attach event listeners
        document.getElementById('loginBtn').addEventListener('click', handleLogin);
        document.getElementById('walletLoginBtn').addEventListener('click', handleWalletLogin);
        const backLink = document.getElementById('backLink');
        backLink.addEventListener('click', () => swapContent('home'));
        backLink.addEventListener('keypress', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            swapContent('home');
          }
        });
        // Allow enter key to submit
        document.getElementById('loginPass').addEventListener('keypress', (e) => {
          if (e.key === 'Enter') handleLogin();
        });

      } else if (newContent === 'register') {
        panelContent.style.display = 'block';
        dashboardContent.style.display = 'none';
        gameContent.style.display = 'none';
        leaderboardContent.style.display = 'none';
        questContent.style.display = 'none';
        inventoryContent.style.display = 'none';
        pageContainer.classList.remove('center-aligned', 'bottom-aligned');
        panelContent.classList.remove('panel-transparent');

        panelContent.innerHTML = `
          <div class="panel-header">
            <div class="sys">Create your account<span class="blink">.</span></div>
            <div class="sub-text">Join the arena and prove your worth</div>
          </div>

          <div class="input-group">
            <label class="input-label">Email Address</label>
            <input id="registerEmail" class="input-field" type="email" placeholder="name@example.com" autocomplete="email">
            <div class="error-msg" id="emailError"></div>
          </div>

          <div class="input-group">
            <label class="input-label">Password</label>
            <input id="registerPass" class="input-field" type="password" placeholder="Enter your password" autocomplete="new-password">
            <div class="error-msg" id="passError"></div>
          </div>

          <div class="input-group">
            <label class="input-label">Confirm Password</label>
            <input id="registerPassConfirm" class="input-field" type="password" placeholder="Confirm your password" autocomplete="new-password">
            <div class="error-msg" id="passConfirmError"></div>
          </div>

          <div class="input-group">
            <label class="input-label">Access Code</label>
            <div class="bar">
              <input id="registerCode" class="input-field" type="text" placeholder="XXXX-XXXX-XXXX" autocomplete="off" value="${data || ''}">
              <button class="btn-submit" id="registerBtn">CREATE ACCOUNT</button>
            </div>
            <div class="error-msg" id="codeError"></div>
          </div>

          <div class="helper">
            Already have an account? <a id="loginLinkFromReg" role="button" tabindex="0">Sign in</a>
          </div>
        `;

        // Re-attach event listeners
        document.getElementById('registerBtn').addEventListener('click', handleRegister);
        const loginLinkFromReg = document.getElementById('loginLinkFromReg');
        loginLinkFromReg.addEventListener('click', () => swapContent('login'));
        loginLinkFromReg.addEventListener('keypress', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            swapContent('login');
          }
        });

        // Clear errors on input
        document.getElementById('registerEmail').addEventListener('input', () => clearError('emailError'));
        document.getElementById('registerPass').addEventListener('input', () => {
          clearError('passError');
          clearError('passConfirmError');
        });
        document.getElementById('registerPassConfirm').addEventListener('input', () => clearError('passConfirmError'));
        document.getElementById('registerCode').addEventListener('input', () => clearError('codeError'));

        // Allow enter key to submit
        document.getElementById('registerPassConfirm').addEventListener('keypress', (e) => {
          if (e.key === 'Enter') handleRegister();
        });

      } else if (newContent === 'nameWarrior') {
        panelContent.style.display = 'block';
        dashboardContent.style.display = 'none';
        gameContent.style.display = 'none';
        leaderboardContent.style.display = 'none';
        questContent.style.display = 'none';
        inventoryContent.style.display = 'none';
        pageContainer.classList.add('center-aligned');
        pageContainer.classList.remove('bottom-aligned');
        panelContent.classList.remove('panel-transparent');

        panelContent.innerHTML = `
          <div class="panel-header">
            <div class="warrior-title">NAME YOUR WARRIOR</div>
            <div class="sub-text">Choose a name that strikes fear into your enemies</div>
          </div>

          <div class="input-group">
            <input id="warriorName" class="warrior-input" type="text" placeholder="Your legend begins here..." maxlength="16" autocomplete="off">
            <div class="error-msg" id="warriorNameError"></div>
          </div>

          <div class="input-group">
            <button class="btn-submit" id="confirmNameBtn" style="width:100%;">ENTER THE ARENA</button>
          </div>
        `;

        panelContent.classList.remove('fade-in', 'warrior-naming');
        void panelContent.offsetWidth;
        panelContent.classList.add('warrior-naming');

        // Re-attach event listeners
        document.getElementById('confirmNameBtn').addEventListener('click', handleNameWarrior);
        document.getElementById('warriorName').addEventListener('input', () => clearError('warriorNameError'));
        document.getElementById('warriorName').addEventListener('keypress', (e) => {
          if (e.key === 'Enter') handleNameWarrior();
        });
        // Auto-focus the input
        setTimeout(() => {
          document.getElementById('warriorName').focus();
        }, 500);

      } else if (newContent === 'home') {
        panelContent.style.display = 'block';
        dashboardContent.style.display = 'none';
        gameContent.style.display = 'none';
        leaderboardContent.style.display = 'none';
        questContent.style.display = 'none';
        inventoryContent.style.display = 'none';
        pageContainer.classList.add('bottom-aligned');
        pageContainer.classList.remove('center-aligned');
        panelContent.classList.add('panel-transparent');

        panelContent.innerHTML = `
          <div class="panel-header">
            <div class="sys">Welcome to the arena<span class="blink">.</span></div>
            <div class="sub-text">Enter your exclusive access code to begin</div>
          </div>

          <div class="input-group">
            <label class="input-label">Access Code</label>
            <div class="bar">
              <input id="code" class="input-field" type="text" placeholder="XXXX-XXXX-XXXX" autocomplete="off">
              <button class="btn-submit" id="joinBtn">JOIN</button>
            </div>
            <div class="error-msg" id="codeError"></div>
          </div>

          <div class="helper">
            Already have an account? <a id="loginLink">Sign in</a>
          </div>
        `;

        // Re-attach event listeners
        document.getElementById('joinBtn').addEventListener('click', handleJoin);
        const loginLink = document.getElementById('loginLink');
        loginLink.addEventListener('click', () => swapContent('login'));
        loginLink.addEventListener('keypress', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            swapContent('login');
          }
        });
        // Allow enter key to submit
        document.getElementById('code').addEventListener('keypress', (e) => {
          if (e.key === 'Enter') handleJoin();
        });

      } else if (newContent === 'dashboard') {
        panelContent.style.display = 'none';
        dashboardContent.style.display = 'block';
        gameContent.style.display = 'none';
        leaderboardContent.style.display = 'none';
        questContent.style.display = 'none';
        inventoryContent.style.display = 'none';
        shopContent.style.display = 'none';
        pageContainer.classList.remove('center-aligned', 'bottom-aligned');
        updateDashboardStats();

      } else if (newContent === 'campaign') {
        panelContent.style.display = 'none';
        dashboardContent.style.display = 'none';
        campaignPageContent.style.display = 'block';
        gameContent.style.display = 'none';
        leaderboardContent.style.display = 'none';
        questContent.style.display = 'none';
        inventoryContent.style.display = 'none';
        shopContent.style.display = 'none';
        ovenContent.style.display = 'none';
        farmContent.style.display = 'none';
        crashContent.style.display = 'none';
        minesContent.style.display = 'none';
        blackjackContent.style.display = 'none';
        pageContainer.classList.remove('center-aligned', 'bottom-aligned');
        updateDashboardStats();

      } else if (newContent === 'game') {
        panelContent.style.display = 'none';
        dashboardContent.style.display = 'none';
        gameContent.style.display = 'block';
        leaderboardContent.style.display = 'none';
        questContent.style.display = 'none';
        inventoryContent.style.display = 'none';
        shopContent.style.display = 'none';
        crashContent.style.display = 'none';
        ovenContent.style.display = 'none';
        pageContainer.classList.remove('center-aligned', 'bottom-aligned');
        initChart();

      } else if (newContent === 'oven') {
        panelContent.style.display = 'none';
        dashboardContent.style.display = 'none';
        gameContent.style.display = 'none';
        leaderboardContent.style.display = 'none';
        questContent.style.display = 'none';
        inventoryContent.style.display = 'none';
        shopContent.style.display = 'none';
        crashContent.style.display = 'none';
        farmContent.style.display = 'none';
        ovenContent.style.display = 'block';
        pageContainer.classList.remove('center-aligned', 'bottom-aligned');
        initOven();

      } else if (newContent === 'farm') {
        panelContent.style.display = 'none';
        dashboardContent.style.display = 'none';
        gameContent.style.display = 'none';
        leaderboardContent.style.display = 'none';
        questContent.style.display = 'none';
        inventoryContent.style.display = 'none';
        shopContent.style.display = 'none';
        crashContent.style.display = 'none';
        ovenContent.style.display = 'none';
        minesContent.style.display = 'none';
        farmContent.style.display = 'block';
        pageContainer.classList.remove('center-aligned', 'bottom-aligned');
        initFarm();

      } else if (newContent === 'crash') {
        panelContent.style.display = 'none';
        dashboardContent.style.display = 'none';
        gameContent.style.display = 'none';
        leaderboardContent.style.display = 'none';
        questContent.style.display = 'none';
        inventoryContent.style.display = 'none';
        shopContent.style.display = 'none';
        crashContent.style.display = 'block';
        minesContent.style.display = 'none';
        ovenContent.style.display = 'none';
        farmContent.style.display = 'none';
        blackjackContent.style.display = 'none';
        pageContainer.classList.remove('center-aligned', 'bottom-aligned');
        initCrashGame();

      } else if (newContent === 'mines') {
        panelContent.style.display = 'none';
        dashboardContent.style.display = 'none';
        gameContent.style.display = 'none';
        leaderboardContent.style.display = 'none';
        questContent.style.display = 'none';
        inventoryContent.style.display = 'none';
        shopContent.style.display = 'none';
        crashContent.style.display = 'none';
        ovenContent.style.display = 'none';
        farmContent.style.display = 'none';
        minesContent.style.display = 'block';
        blackjackContent.style.display = 'none';
        pageContainer.classList.remove('center-aligned', 'bottom-aligned');
        initMinesGame();
        updateMinesGPDisplay();

      } else if (newContent === 'blackjack') {
        panelContent.style.display = 'none';
        dashboardContent.style.display = 'none';
        gameContent.style.display = 'none';
        leaderboardContent.style.display = 'none';
        questContent.style.display = 'none';
        inventoryContent.style.display = 'none';
        shopContent.style.display = 'none';
        crashContent.style.display = 'none';
        ovenContent.style.display = 'none';
        farmContent.style.display = 'none';
        minesContent.style.display = 'none';
        blackjackContent.style.display = 'block';
        pageContainer.classList.remove('center-aligned', 'bottom-aligned');
        initBlackjack();

      } else if (newContent === 'leaderboard') {
        console.log('Switching to leaderboard...');
        panelContent.style.display = 'none';
        dashboardContent.style.display = 'none';
        gameContent.style.display = 'none';
        leaderboardContent.style.display = 'block';
        questContent.style.display = 'none';
        inventoryContent.style.display = 'none';
        shopContent.style.display = 'none';
        ovenContent.style.display = 'none';
        farmContent.style.display = 'none';
        crashContent.style.display = 'none';
        minesContent.style.display = 'none';
        blackjackContent.style.display = 'none';
        pageContainer.classList.remove('center-aligned', 'bottom-aligned');
        console.log('Leaderboard display set to block');
        loadLeaderboard('all');
        console.log('loadLeaderboard called');

      } else if (newContent === 'quests') {
        panelContent.style.display = 'none';
        dashboardContent.style.display = 'none';
        gameContent.style.display = 'none';
        leaderboardContent.style.display = 'none';
        questContent.style.display = 'block';
        inventoryContent.style.display = 'none';
        shopContent.style.display = 'none';
        ovenContent.style.display = 'none';
        farmContent.style.display = 'none';
        crashContent.style.display = 'none';
        minesContent.style.display = 'none';
        blackjackContent.style.display = 'none';
        pageContainer.classList.remove('center-aligned', 'bottom-aligned');
        loadQuests('daily');

      } else if (newContent === 'inventory') {
        panelContent.style.display = 'none';
        dashboardContent.style.display = 'none';
        gameContent.style.display = 'none';
        leaderboardContent.style.display = 'none';
        questContent.style.display = 'none';
        inventoryContent.style.display = 'block';
        shopContent.style.display = 'none';
        ovenContent.style.display = 'none';
        farmContent.style.display = 'none';
        crashContent.style.display = 'none';
        minesContent.style.display = 'none';
        blackjackContent.style.display = 'none';
        pageContainer.classList.remove('center-aligned', 'bottom-aligned');
        loadInventory();

      } else if (newContent === 'shop') {
        panelContent.style.display = 'none';
        dashboardContent.style.display = 'none';
        gameContent.style.display = 'none';
        leaderboardContent.style.display = 'none';
        questContent.style.display = 'none';
        inventoryContent.style.display = 'none';
        shopContent.style.display = 'block';
        ovenContent.style.display = 'none';
        farmContent.style.display = 'none';
        crashContent.style.display = 'none';
        minesContent.style.display = 'none';
        blackjackContent.style.display = 'none';
        pageContainer.classList.remove('center-aligned', 'bottom-aligned');
        loadInventory(); // Load shop items
      }

        // Add fade-in animation to newly visible element
        const newVisible = allContainers.find(el => el.style.display === 'block');
        if (newVisible) {
          newVisible.classList.remove('fade-out', 'fade-in-delayed');
          void newVisible.offsetWidth; // Force reflow
          newVisible.classList.add('fade-in');
        }

        // Scroll to top when changing pages
        window.scrollTo(0, 0);
      }, currentVisible ? 200 : 0); // 200ms matches fade-out animation duration
    }
    
    // Validation functions
    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email);
    }

    function validateAccessCode(code) {
      // Format: XXXX-XXXX-XXXX (alphanumeric)
      const re = /^[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}$/i;
      return re.test(code);
    }

    function showError(elementId, message) {
      const errorEl = document.getElementById(elementId);
      if (errorEl) {
        errorEl.textContent = message;
        errorEl.classList.add('show');
      }
    }

    function clearError(elementId) {
      const errorEl = document.getElementById(elementId);
      if (errorEl) {
        errorEl.classList.remove('show');
      }
    }

    // Event handlers
    function handleJoin() {
      const codeInput = document.getElementById('code');
      const code = codeInput.value.trim();

      clearError('codeError');

      if (!code) {
        showError('codeError', 'Please enter an access code');
        return;
      }

      // Accept any code - no validation required
      swapContent('register', code);
    }

    function handleLogin() {
      // Skip all validation - instant login for testing
      clearError('emailError');
      clearError('passError');

      // Generate random user ID
      const testUserId = 'test-' + Math.random().toString(36).substring(7);
      const testEmail = 'test@demo.com';
      const testWarriorName = '1337';

      // Store test user info
      try {
        localStorage.setItem('duelpvp_user_id', testUserId);
        localStorage.setItem('duelpvp_email', testEmail);
        localStorage.setItem('duelpvp_display_name', testWarriorName);
        localStorage.setItem('duelpvp_warrior', testWarriorName);

        // Initialize GP - 1000 for testing (normally 10 for new accounts)
        if (!localStorage.getItem('duelpvp_gp')) {
          localStorage.setItem('duelpvp_gp', '1000');
        }

        // Set username in dashboard
        document.getElementById('userName').textContent = testWarriorName.toUpperCase();

        Toast.success('Logged in as ' + testWarriorName + ' • ' + localStorage.getItem('duelpvp_gp') + ' GP', 'TEST MODE');
      } catch (e) {
        console.error('Failed to save login:', e);
        showError('passError', 'Failed to save login. Check browser settings.');
        return;
      }

      swapContent('dashboard');
    }

    // Helper functions for inline error messages
    function showError(elementId, message) {
      const errorElement = document.getElementById(elementId);
      if (errorElement) {
        errorElement.textContent = message;
        errorElement.classList.add('show');
      }
    }

    function clearError(elementId) {
      const errorElement = document.getElementById(elementId);
      if (errorElement) {
        errorElement.textContent = '';
        errorElement.classList.remove('show');
      }
    }

    function clearAllErrors() {
      ['emailError', 'passError', 'passConfirmError', 'codeError', 'warriorNameError'].forEach(clearError);
    }

    async function handleRegister() {
      const email = document.getElementById('registerEmail').value.trim();
      const pass = document.getElementById('registerPass').value.trim();
      const passConfirm = document.getElementById('registerPassConfirm').value.trim();
      const code = document.getElementById('registerCode').value.trim().toUpperCase();

      // Clear all previous errors
      clearAllErrors();

      let hasError = false;

      if (!email) {
        showError('emailError', 'Email is required');
        hasError = true;
      } else if (!validateEmail(email)) {
        showError('emailError', 'Please enter a valid email address');
        hasError = true;
      }

      if (!pass) {
        showError('passError', 'Password is required');
        hasError = true;
      } else if (pass.length < 8) {
        showError('passError', 'Password must be at least 8 characters');
        hasError = true;
      }

      if (!passConfirm) {
        showError('passConfirmError', 'Please confirm your password');
        hasError = true;
      } else if (pass !== passConfirm) {
        showError('passConfirmError', 'Passwords do not match');
        hasError = true;
      }

      if (!code) {
        showError('codeError', 'Access code is required');
        hasError = true;
      }

      if (hasError) return;

      // Check if invite code exists and is unused
      Loading.show('Validating invite code...');

      const { data: codeData, error: codeError } = await supabase
        .from('codes')
        .select('*')
        .eq('code', code)
        .is('used_by', null)
        .single();

      Loading.hide();

      if (codeError || !codeData) {
        showError('codeError', 'Invalid or already used invite code');
        return;
      }

      // Check if email already registered
      const { data: existingUser } = await supabase
        .from('users')
        .select('id')
        .eq('email', email)
        .single();

      if (existingUser) {
        showError('emailError', 'Email already registered');
        return;
      }

      // Store data temporarily and show warrior naming screen
      tempRegistrationData.email = email;
      tempRegistrationData.password = pass;
      tempRegistrationData.inviteCode = code;
      swapContent('nameWarrior');
    }

    async function handleNameWarrior() {
      const warriorName = document.getElementById('warriorName').value.trim();

      // Clear previous errors
      clearError('warriorNameError');

      if (!warriorName) {
        showError('warriorNameError', 'Warrior name is required');
        return;
      }

      if (warriorName.length < 3) {
        showError('warriorNameError', 'Must be at least 3 characters');
        return;
      }

      if (warriorName.length > 16) {
        showError('warriorNameError', 'Must be 16 characters or less');
        return;
      }

      Loading.show('Creating your account...');

      try {
        // 1. Create user in database
        console.log('Step 1: Creating user in database...');
        const { data: newUser, error: userError } = await supabase
          .from('users')
          .insert({
            email: tempRegistrationData.email,
            display_name: warriorName,
            points: 0
          })
          .select()
          .single();

        if (userError) {
          Loading.hide();
          console.error('User creation failed:', userError);
          if (userError.code === '23505') { // Unique constraint violation
            showError('warriorNameError', 'Display name already taken');
          } else if (userError.code === '42P01') {
            Modal.alert('Database not set up. Please run minimal_setup.sql in Supabase first.', 'Setup Required');
          } else {
            Modal.alert('Registration failed: ' + userError.message, 'Error');
          }
          return;
        }

        console.log('Step 1 complete: User created', newUser.id);

        // 2. Mark invite code as used (atomic operation prevents race condition)
        console.log('Step 2: Marking code as used...');
        const { error: codeError } = await supabase
          .from('codes')
          .update({
            used_by: newUser.id,
            used_at: new Date().toISOString()
          })
          .eq('code', tempRegistrationData.inviteCode)
          .is('used_by', null); // Only update if still unused!

        if (codeError) {
          // Code was used by someone else in the meantime - rollback
          console.error('Code update failed:', codeError);
          await supabase.from('users').delete().eq('id', newUser.id);
          Loading.hide();
          showError('codeError', 'Code update failed: ' + codeError.message);
          swapContent('register', tempRegistrationData.inviteCode);
          return;
        }

        console.log('Step 2 complete: Code marked as used');

        // 3. Generate 3 invite codes for new user
        console.log('Step 3: Generating 3 invite codes...');
        const { error: rpcError } = await supabase.rpc('create_user_codes', { user_id: newUser.id });

        if (rpcError) {
          console.error('Code generation failed (non-critical):', rpcError);
          // Don't fail registration if code generation fails
          Toast.info('Registration successful, but invite code generation failed', 'PARTIAL SUCCESS');
        } else {
          console.log('Step 3 complete: 3 codes generated');
        }

        // 4. Store session in localStorage
        localStorage.setItem('duelpvp_user_id', newUser.id);
        localStorage.setItem('duelpvp_email', newUser.email);
        localStorage.setItem('duelpvp_display_name', warriorName);

        // Update UI
        document.getElementById('userName').textContent = warriorName.toUpperCase();

        Loading.hide();
        Toast.success(`Welcome to the arena, ${warriorName}!`, 'WARRIOR REGISTERED');

        swapContent('dashboard');
      } catch (e) {
        Loading.hide();
        console.error('Registration error:', e);
        Modal.alert('Error: ' + e.message + '. Check browser console (F12) for details.', 'Registration Failed');
      }
    }

    async function handleLogout() {
      const confirmed = await Modal.confirm('Are you sure you want to logout?', 'Confirm Logout');
      if (!confirmed) return;

      dashboardContent.style.display = 'none';
      panelContent.style.display = 'block';
      swapContent('home');
    }

    // Wallet connection functions
    async function handleConnectWallet() {
      try {
        // Check if MetaMask/wallet is installed
        if (typeof window.ethereum === 'undefined') {
          Modal.alert('No Web3 wallet detected! Please install MetaMask or another Ethereum wallet.', 'Wallet Not Found');
          return;
        }

        Loading.show('Connecting wallet...');

        // Request account access
        const accounts = await window.ethereum.request({
          method: 'eth_requestAccounts'
        });

        const walletAddress = accounts[0];

        // Request signature to verify ownership (doesn't touch assets)
        const message = `Verify wallet ownership for Duel PVP\nWallet: ${walletAddress}\nTimestamp: ${Date.now()}`;

        const signature = await window.ethereum.request({
          method: 'personal_sign',
          params: [message, walletAddress]
        });

        // Store wallet address linked to current email
        const email = localStorage.getItem('duelpvp_email');
        if (email) {
          localStorage.setItem(`duelpvp_wallet_${email}`, walletAddress);
          localStorage.setItem(`duelpvp_wallet_verified_${email}`, signature);

          // Also store reverse mapping (wallet -> email) for login
          localStorage.setItem(`duelpvp_email_${walletAddress.toLowerCase()}`, email);

          updateWalletDisplay(walletAddress);
          Loading.hide();
          Toast.success(`Wallet ${walletAddress.substring(0, 6)}...${walletAddress.substring(38)} linked to your account`, 'WALLET CONNECTED');
        } else {
          Loading.hide();
          Modal.alert('No email found. Please login first.', 'Login Required');
        }
      } catch (error) {
        Loading.hide();
        console.error('Wallet connection error:', error);
        if (error.code === 4001) {
          Toast.warning('You cancelled the wallet connection request', 'Connection Cancelled');
        } else {
          Modal.alert('Failed to connect wallet: ' + error.message, 'Connection Error');
        }
      }
    }

    function updateWalletDisplay(address = null) {
      const walletStatus = document.getElementById('walletStatus');
      const connectBtn = document.getElementById('connectWalletBtn');

      if (!address) {
        // Check if wallet is already connected
        const email = localStorage.getItem('duelpvp_email');
        if (email) {
          address = localStorage.getItem(`duelpvp_wallet_${email}`);
        }
      }

      if (address) {
        const shortAddress = `${address.substring(0, 6)}...${address.substring(address.length - 4)}`;
        walletStatus.textContent = `Connected: ${shortAddress}`;
        walletStatus.classList.add('connected');
        connectBtn.textContent = 'DISCONNECT WALLET';
        connectBtn.onclick = handleDisconnectWallet;
      } else {
        walletStatus.textContent = 'No wallet connected';
        walletStatus.classList.remove('connected');
        connectBtn.textContent = 'CONNECT WALLET';
        connectBtn.onclick = handleConnectWallet;
      }
    }

    function handleDisconnectWallet() {
      const email = localStorage.getItem('duelpvp_email');
      if (email) {
        const wallet = localStorage.getItem(`duelpvp_wallet_${email}`);
        if (wallet) {
          localStorage.removeItem(`duelpvp_wallet_${email}`);
          localStorage.removeItem(`duelpvp_wallet_verified_${email}`);
          localStorage.removeItem(`duelpvp_email_${wallet.toLowerCase()}`);
        }
        updateWalletDisplay();
        Toast.info('Wallet disconnected from your account', 'DISCONNECTED');
      }
    }

    async function handleWalletLogin() {
      try {
        if (typeof window.ethereum === 'undefined') {
          Modal.alert('No Web3 wallet detected! Please install MetaMask.', 'Wallet Not Found');
          return;
        }

        Loading.show('Connecting to wallet...');

        const accounts = await window.ethereum.request({
          method: 'eth_requestAccounts'
        });

        const walletAddress = accounts[0].toLowerCase();

        // Check if this wallet is linked to an account
        const email = localStorage.getItem(`duelpvp_email_${walletAddress}`);

        if (email) {
          // Verify ownership with signature
          const message = `Sign in to Duel PVP\nWallet: ${walletAddress}\nTimestamp: ${Date.now()}`;

          await window.ethereum.request({
            method: 'personal_sign',
            params: [message, accounts[0]]
          });

          // Login successful
          localStorage.setItem('duelpvp_email', email);
          const warriorName = localStorage.getItem('duelpvp_warrior');
          if (warriorName) {
            document.getElementById('userName').textContent = warriorName.toUpperCase();
          }
          Loading.hide();
          Toast.success('Signed in successfully!', 'WELCOME BACK');
          swapContent('dashboard');
        } else {
          Loading.hide();
          Modal.alert('This wallet is not linked to any account. Please login with email and connect your wallet first.', 'Wallet Not Linked');
        }
      } catch (error) {
        Loading.hide();
        console.error('Wallet login error:', error);
        Modal.alert('Failed to login with wallet: ' + error.message, 'Login Failed');
      }
    }

    // Dashboard stats update
    async function updateDashboardStats() {
      try {
        const userId = localStorage.getItem('duelpvp_user_id');

        if (!userId) return;

        // Get user's total games played
        const { data: userScores, error: scoresError } = await supabase
          .from('scores')
          .select('time_ms, created_at')
          .eq('user_id', userId)
          .order('created_at', { ascending: false });

        if (scoresError) {
          console.error('Failed to load user scores:', scoresError);
          return;
        }

        // Get user's rank
        const { data: rankData, error: rankError } = await supabase
          .rpc('get_user_best_time', {
            p_user_id: userId,
            time_filter: 'all'
          })
          .single();

        if (rankError) {
          console.error('Failed to get user rank:', rankError);
        }

        // Get user's GP from users table
        const { data: userData, error: userError } = await supabase
          .from('users')
          .select('points, win_streak, total_wins')
          .eq('id', userId)
          .single();

        if (userError) {
          console.error('Failed to load user data:', userError);
        }

        // Calculate stats
        const totalWins = userData?.total_wins || userScores?.length || 0;
        const streak = userData?.win_streak || 0;
        const userRank = rankData?.rank || 0;
        const totalGP = userData?.points || 0;

        // Update UI
        document.querySelector('.stat-card:nth-child(1) .stat-value').textContent = totalWins;
        document.querySelector('.stat-card:nth-child(2) .stat-value').textContent = streak;
        document.querySelector('.stat-card:nth-child(3) .stat-value').textContent = userRank > 0 ? `#${userRank}` : '--';

        // Update GP from localStorage (for test mode) or database
        const localGP = parseInt(localStorage.getItem('duelpvp_gp')) || 0;
        const displayGP = localGP || totalGP;
        document.getElementById('dashboardGPBalance').textContent = displayGP >= 1000000 ? `${(displayGP/1000000).toFixed(1)}M` : displayGP >= 1000 ? `${(displayGP/1000).toFixed(1)}K` : displayGP;

      } catch (e) {
        console.error('Failed to update dashboard stats:', e);
      }

      // Update wallet display
      updateWalletDisplay();

      // Load dashboard inventory
      loadDashboardInventory();
    }

    async function loadDashboardInventory() {
      const userId = localStorage.getItem('duelpvp_user_id');
      const email = localStorage.getItem('duelpvp_email');
      const dashboardItemsGrid = document.getElementById('dashboardItemsGrid');

      if (!dashboardItemsGrid) return;

      // Get inventory from localStorage (for now - can be migrated to Supabase later)
      const inventory = JSON.parse(localStorage.getItem(`duelpvp_inventory_${email}`) || '[]');

      // Get user's invite codes from Supabase
      let inviteCodes = [];
      if (userId) {
        const { data } = await supabase
          .from('codes')
          .select('*')
          .eq('created_by', userId)
          .order('created_at', { ascending: false })
          .limit(4);

        inviteCodes = data || [];
      }

      // Combine inventory items and codes
      const allItems = [];

      // Add invite codes first (show up to 4)
      inviteCodes.slice(0, 4).forEach(code => {
        allItems.push({
          type: 'invite_code',
          icon: '🎟️',
          name: code.used_by ? 'USED CODE' : 'INVITE CODE',
          desc: code.used_by
            ? `This code was used on ${new Date(code.used_at).toLocaleDateString()}`
            : 'Share this code with friends to invite them to the arena!',
          code: code.code,
          itemType: 'Invite Code',
          used: !!code.used_by
        });
      });

      // Add shop items from inventory
      inventory.forEach(item => {
        const shopItem = SHOP_ITEMS.find(si => si.id === item.id);
        if (shopItem) {
          allItems.push({
            type: 'shop_item',
            icon: shopItem.icon,
            name: shopItem.name,
            desc: shopItem.desc,
            itemType: shopItem.type,
            count: item.count || 1
          });
        }
      });

      // Fill remaining slots with empty slots (show 8 slots total)
      const slotsToShow = 8;
      while (allItems.length < slotsToShow) {
        allItems.push({ type: 'empty' });
      }

      // Render items
      dashboardItemsGrid.innerHTML = '';
      allItems.slice(0, slotsToShow).forEach(item => {
        const slot = document.createElement('div');
        slot.className = item.type === 'empty' ? 'dashboard-item-slot empty' : 'dashboard-item-slot';

        if (item.type === 'empty') {
          slot.innerHTML = `
            <div class="dashboard-item-icon">—</div>
          `;
        } else {
          slot.innerHTML = `
            <div class="dashboard-item-icon">${item.icon}</div>
            <div class="dashboard-item-name">${item.name}</div>
            ${item.count > 1 ? `<div class="dashboard-item-count">${item.count}</div>` : ''}
            <div class="dashboard-item-tooltip">
              <div class="tooltip-name">${item.name}</div>
              <div class="tooltip-desc">${item.desc}</div>
              <div class="tooltip-type">${item.itemType || 'Item'}</div>
              ${item.code ? `<div class="tooltip-desc" style="margin-top:4px;color:var(--gold);font-family:'Press Start 2P';font-size:9px;">${item.code}</div>` : ''}
            </div>
          `;
        }

        dashboardItemsGrid.appendChild(slot);
      });
    }

    // Leaderboard functions
    async function loadLeaderboard(filter) {
      console.log('loadLeaderboard called with filter:', filter);
      try {
        const email = localStorage.getItem('duelpvp_email') || 'anonymous';
        const userId = localStorage.getItem('duelpvp_user_id');

        Loading.show('Loading leaderboard...');

        // Call Supabase RPC function to get leaderboard
        const { data: leaderboard, error } = await supabase
          .rpc('get_leaderboard', {
            time_filter: filter,
            limit_count: 100
          });

        Loading.hide();

        if (error) {
          console.error('Leaderboard error:', error);
          throw error;
        }

        console.log('Loaded leaderboard:', leaderboard?.length || 0, 'entries');

        // Show user's best time
        if (userId) {
          const userEntry = leaderboard?.find(entry => entry.user_id === userId);
          if (userEntry) {
            document.getElementById('yourBestSection').style.display = 'block';
            document.getElementById('yourBestTime').textContent = `${userEntry.time_ms}ms`;
          } else {
            document.getElementById('yourBestSection').style.display = 'none';
          }
        } else {
          document.getElementById('yourBestSection').style.display = 'none';
        }

        // Render podium (top 3)
        renderPodium(leaderboard?.slice(0, 3) || []);

        // Render table
        renderLeaderboardTable(leaderboard || [], userId);

      } catch (e) {
        Loading.hide();
        console.error('Failed to load leaderboard:', e);
        document.getElementById('leaderboardTableBody').innerHTML = '<div class="no-data">Error loading leaderboard</div>';
      }
    }

    function renderPodium(topThree) {
      const podium = document.getElementById('podium');
      podium.innerHTML = '';

      if (topThree.length === 0) {
        podium.innerHTML = '<div class="no-data" style="grid-column: 1/-1;">No scores yet. Be the first!</div>';
        return;
      }

      topThree.forEach((entry, index) => {
        const rank = index + 1;
        const playerName = entry.display_name || entry.email?.split('@')[0] || 'Unknown';
        const date = new Date(entry.created_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });

        const podiumItem = document.createElement('div');
        podiumItem.className = `podium-item rank-${rank}`;
        podiumItem.innerHTML = `
          <div class="podium-rank">${rank}</div>
          <div class="podium-player">${playerName.toUpperCase()}</div>
          <div class="podium-time">${entry.time_ms}ms</div>
          <div class="podium-date">${date}</div>
        `;
        podium.appendChild(podiumItem);
      });

      // Add empty slots if less than 3
      for (let i = topThree.length; i < 3; i++) {
        const podiumItem = document.createElement('div');
        podiumItem.className = `podium-item rank-${i + 1}`;
        podiumItem.innerHTML = `
          <div class="podium-rank">${i + 1}</div>
          <div class="podium-player">---</div>
          <div class="podium-time">--ms</div>
          <div class="podium-date">No entry</div>
        `;
        podium.appendChild(podiumItem);
      }
    }

    function renderLeaderboardTable(leaderboard, currentUserId) {
      const tbody = document.getElementById('leaderboardTableBody');
      tbody.innerHTML = '';

      if (leaderboard.length === 0) {
        tbody.innerHTML = '<div class="no-data">No scores recorded yet</div>';
        return;
      }

      leaderboard.forEach((entry) => {
        const rank = entry.rank || '?';
        const playerName = entry.display_name || entry.email?.split('@')[0] || 'Unknown';
        const date = new Date(entry.created_at).toLocaleDateString('en-US', {
          month: 'short',
          day: 'numeric',
          year: 'numeric'
        });
        const isCurrentUser = entry.user_id === currentUserId;

        const row = document.createElement('div');
        row.className = isCurrentUser ? 'table-row user-row' : 'table-row';
        row.innerHTML = `
          <div class="rank-badge">#${rank}</div>
          <div class="player-name">${playerName.toUpperCase()}${isCurrentUser ? ' (YOU)' : ''}</div>
          <div class="reaction-time">${entry.time_ms}ms</div>
          <div class="entry-date">${date}</div>
        `;
        tbody.appendChild(row);
      });
    }

    function handleFilterChange(filter) {
      // Update active button
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
        btn.setAttribute('aria-pressed', 'false');
      });
      event.target.classList.add('active');
      event.target.setAttribute('aria-pressed', 'true');

      // Reload leaderboard
      loadLeaderboard(filter);
    }
    
    // Game functions
    function initChart() {
      const canvas = document.getElementById('chartCanvas');
      const ctx = canvas.getContext('2d');
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;
      drawChart(ctx, false);
    }
    
    function drawChart(ctx, chartData = null) {
      const canvas = ctx.canvas;
      const w = canvas.width;
      const h = canvas.height;

      // Clear canvas
      ctx.clearRect(0, 0, w, h);

      // Draw grid
      ctx.strokeStyle = 'rgba(255,214,77,0.1)';
      ctx.lineWidth = 1;
      ctx.setLineDash([2, 4]);

      // Horizontal lines
      for (let i = 0; i < 5; i++) {
        ctx.beginPath();
        ctx.moveTo(0, (h / 5) * i);
        ctx.lineTo(w, (h / 5) * i);
        ctx.stroke();
      }

      // Vertical lines
      for (let i = 0; i < 10; i++) {
        ctx.beginPath();
        ctx.moveTo((w / 10) * i, 0);
        ctx.lineTo((w / 10) * i, h);
        ctx.stroke();
      }

      ctx.setLineDash([]);

      // If no chartData provided, draw empty/static chart
      if (!chartData) {
        const points = [];
        let currentPrice = 40000;
        const numPoints = 50;

        for (let i = 0; i < numPoints; i++) {
          const change = (Math.random() - 0.48) * 300;
          currentPrice += change;
          points.push({
            x: (w / numPoints) * i,
            y: h - (currentPrice - 38000) / 50
          });
        }

        ctx.strokeStyle = '#4CAF50';
        ctx.lineWidth = 3;
        ctx.beginPath();
        points.forEach((point, i) => {
          if (i === 0) ctx.moveTo(point.x, point.y);
          else ctx.lineTo(point.x, point.y);
        });
        ctx.stroke();
        return;
      }

      // Draw animated chart
      const isRed = chartData.hasCrashed;
      const points = chartData.points;

      // Draw line
      ctx.strokeStyle = isRed ? '#F44336' : '#4CAF50';
      ctx.lineWidth = 3;
      ctx.beginPath();
      points.forEach((point, i) => {
        if (i === 0) ctx.moveTo(point.x, point.y);
        else ctx.lineTo(point.x, point.y);
      });
      ctx.stroke();

      // Draw fill
      ctx.fillStyle = isRed ? 'rgba(244,67,54,0.1)' : 'rgba(76,175,80,0.1)';
      ctx.beginPath();
      ctx.moveTo(points[0].x, points[0].y);
      points.forEach(point => ctx.lineTo(point.x, point.y));
      ctx.lineTo(points[points.length - 1].x, h);
      ctx.lineTo(points[0].x, h);
      ctx.closePath();
      ctx.fill();
    }
    
    function startGame() {
      const chartContainer = document.getElementById('chartContainer');
      const sellButton = document.getElementById('sellButton');
      const gameStatus = document.getElementById('gameStatus');
      const canvas = document.getElementById('chartCanvas');
      const ctx = canvas.getContext('2d');
      const w = canvas.width;
      const h = canvas.height;

      // Reset state
      chartContainer.className = 'chart-container green';
      sellButton.disabled = false; // Enable immediately
      gameStatus.textContent = 'Watch for the dump...';
      gameStatus.className = 'game-status status-ready';
      drawChart(ctx, null);

      // Game parameters - HIGHLY RANDOMIZED FOR VARIETY
      // Random duration with weighted distribution (favors longer but allows early crashes)
      const durationRoll = Math.random();
      let totalDuration;
      if (durationRoll < 0.15) {
        // 15% chance: Early crash (1-2.5 seconds)
        totalDuration = 1000 + Math.random() * 1500;
      } else if (durationRoll < 0.85) {
        // 70% chance: Normal/Long (2.5-6 seconds) - more exciting
        totalDuration = 2500 + Math.random() * 3500;
      } else {
        // 15% chance: Very long (6-9 seconds) - maximum suspense
        totalDuration = 6000 + Math.random() * 3000;
      }

      // Peak time is more variable: sometimes early (20%), sometimes very late (90%)
      const peakTime = totalDuration * (0.2 + Math.random() * 0.7); // Peak at 20%-90% of duration
      const startPrice = 38000 + Math.random() * 4000; // Random start 38k-42k
      const peakPrice = startPrice + 6000 + Math.random() * 8000; // Rise 6000-14000
      const crashPrice = startPrice - (2000 + Math.random() * 3000); // Random crash depth
      const riseShape = 0.5 + Math.random() * 0.8; // Random rise curve (0.5-1.3)
      const crashShape = 1.5 + Math.random() * 1.5; // Random crash steepness (1.5-3.0)

      gameState.isPlaying = true;
      gameState.hasCrashed = false;
      gameState.peakReached = false;
      gameState.startTime = performance.now();
      gameState.peakTime = gameState.startTime + peakTime;
      gameState.endTime = gameState.startTime + totalDuration;

      const numPoints = 80;

      function animateChart() {
        if (!gameState.isPlaying && !gameState.hasCrashed) return;

        const now = performance.now();
        const elapsed = now - gameState.startTime;
        const progress = Math.min(elapsed / totalDuration, 1);

        // Calculate current price based on phase
        let currentPrice;
        const pointsToShow = Math.floor(progress * numPoints);

        if (elapsed < peakTime) {
          // Rising phase - random curve shape
          const riseProgress = elapsed / peakTime;
          currentPrice = startPrice + (peakPrice - startPrice) * Math.pow(riseProgress, riseShape);
        } else {
          // Crashing phase - random steepness
          if (!gameState.peakReached) {
            gameState.peakReached = true;
            chartContainer.className = 'chart-container red';
            gameStatus.textContent = 'CRASH!';
            gameStatus.className = 'game-status status-go';
          }
          gameState.hasCrashed = true;
          const crashProgress = (elapsed - peakTime) / (totalDuration - peakTime);
          currentPrice = peakPrice - (peakPrice - crashPrice) * Math.pow(crashProgress, crashShape);
        }

        // Generate smooth points
        const points = [];
        for (let i = 0; i <= pointsToShow; i++) {
          const t = i / numPoints;
          const pointElapsed = t * totalDuration;
          let price;

          if (pointElapsed < peakTime) {
            const riseProgress = pointElapsed / peakTime;
            price = startPrice + (peakPrice - startPrice) * Math.pow(riseProgress, riseShape);
          } else {
            const crashProgress = (pointElapsed - peakTime) / (totalDuration - peakTime);
            price = peakPrice - (peakPrice - crashPrice) * Math.pow(crashProgress, crashShape);
          }

          points.push({
            x: (w / numPoints) * i,
            y: h - ((price - 34000) / 110)
          });
        }

        // Draw chart
        drawChart(ctx, {
          points: points,
          hasCrashed: gameState.hasCrashed
        });

        // Continue animation or end
        if (progress < 1) {
          gameState.chartAnimation = requestAnimationFrame(animateChart);
        } else {
          // Auto-sell if didn't click
          if (gameState.isPlaying) {
            handleSell();
          }
        }
      }

      animateChart();
    }
    
    async function handleSell() {
      if (!gameState.isPlaying) return;

      const now = performance.now();
      const sellButton = document.getElementById('sellButton');
      const gameStatus = document.getElementById('gameStatus');

      // Check if clicked before peak - TOO EARLY
      if (now < gameState.peakTime) {
        gameState.isPlaying = false;
        gameState.attempts.push(-1); // -1 indicates early click

        sellButton.disabled = true;
        gameStatus.textContent = 'TOO EARLY! Wait for the dump!';
        gameStatus.className = 'game-status status-go';

        // Cancel animation
        if (gameState.chartAnimation) {
          cancelAnimationFrame(gameState.chartAnimation);
        }

        // Update best time display
        updateBestTimeDisplay();
        updateResultsGrid();
        return;
      }

      // Clicked after peak - calculate reaction time
      const reactionTime = now - gameState.peakTime;
      gameState.attempts.push(reactionTime);
      gameState.isPlaying = false;

      // Update best time
      if (gameState.bestTime === null || reactionTime < gameState.bestTime) {
        gameState.bestTime = reactionTime;
      }

      // Award GP for fast reactions
      if (reactionTime < 1000) {
        await updateUserGP(300);
        Toast.success('Fast hands! +300 GP', 'PROFIT');
        gameStatus.textContent = `${reactionTime.toFixed(0)}ms - +300 GP!`;
        gameStatus.className = 'game-status';
        gameStatus.style.color = '#4CAF50';
      } else {
        gameStatus.textContent = `${reactionTime.toFixed(0)}ms - Too slow!`;
        gameStatus.className = 'game-status';
        gameStatus.style.color = '#a0a8b0';
      }

      // Update UI
      sellButton.disabled = true;

      // Cancel animation
      if (gameState.chartAnimation) {
        cancelAnimationFrame(gameState.chartAnimation);
      }

      // Update displays
      updateBestTimeDisplay();
      updateResultsGrid();
    }

    function updateBestTimeDisplay() {
      const bestTimeEl = document.getElementById('attemptsLeft');
      if (gameState.bestTime) {
        bestTimeEl.textContent = `${gameState.bestTime.toFixed(0)} ms`;
        bestTimeEl.style.color = gameState.bestTime < 1000 ? '#4CAF50' : '#a0a8b0';
      } else {
        bestTimeEl.textContent = '-- ms';
        bestTimeEl.style.color = '#a0a8b0';
      }
    }

    function updateResultsGrid() {
      const grid = document.getElementById('resultsGrid');
      grid.innerHTML = '';

      // Show last 5 attempts
      const recentAttempts = gameState.attempts.slice(-5);
      const validAttempts = recentAttempts.filter(t => t >= 0);
      const bestTime = validAttempts.length > 0 ? Math.min(...validAttempts) : null;

      recentAttempts.forEach((time, index) => {
        const actualIndex = gameState.attempts.length - recentAttempts.length + index;
        const card = document.createElement('div');
        const isBest = time >= 0 && time === bestTime;
        card.className = isBest ? 'result-card best' : 'result-card';

        if (time === -1) {
          // Too early
          card.innerHTML = `
            <div class="result-attempt">TRY ${actualIndex + 1}</div>
            <div class="result-time" style="color:#F44336">TOO EARLY</div>
          `;
        } else {
          const gpEarned = time < 1000 ? '+300 GP' : '0 GP';
          const color = time < 1000 ? '#4CAF50' : '#a0a8b0';
          card.innerHTML = `
            <div class="result-attempt">TRY ${actualIndex + 1}</div>
            <div class="result-time">${time.toFixed(0)}ms</div>
            <div class="result-time" style="color:${color};font-size:11px;">${gpEarned}</div>
          `;
        }
        grid.appendChild(card);
      });
    }

    async function saveScoreToSupabase(userId, timeMs) {
      try {
        // Save score to database
        const { error: scoreError } = await supabase
          .from('scores')
          .insert({
            user_id: userId,
            time_ms: Math.round(timeMs),
            game_type: 'reaction'
          });

        if (scoreError) {
          console.error('Failed to save score:', scoreError);
          Toast.error('Failed to save score', 'ERROR');
          return;
        }

        // Update quest progress
        await updateQuestProgress('daily_play_3');
        await updateQuestProgress('weekly_play_20');

        // Check for fast time quests (close to peak)
        if (timeMs < 300) {
          await updateQuestProgress('daily_fast_time');
        }
        if (timeMs < 200) {
          await updateQuestProgress('weekly_sub_250');
        }

        // Auto-complete login quest on first game
        await updateQuestProgress('daily_login');

        Toast.success('Score saved!', 'SUCCESS');

      } catch (e) {
        console.error('Error saving score:', e);
      }
    }

    function endGame() {
      const validAttempts = gameState.attempts.filter(t => t >= 0);
      const bestTime = validAttempts.length > 0 ? Math.min(...validAttempts) : null;

      if (bestTime !== null) {
        document.getElementById('gameStatus').textContent = `Game Over! Best: +${bestTime.toFixed(0)}ms`;
      } else {
        document.getElementById('gameStatus').textContent = `Game Over! All attempts disqualified`;
      }

      // Save score to Supabase
      if (bestTime !== null) {
        const userId = localStorage.getItem('duelpvp_user_id');

        if (userId) {
          saveScoreToSupabase(userId, bestTime);
        }
      }
    }
    
    function resetGame() {
      gameState = {
        attempts: [],
        bestTime: null,
        isPlaying: false,
        startTime: null,
        reactionTimer: null,
        chartAnimation: null
      };

      // Clear any running timers
      if (gameState.reactionTimer) clearTimeout(gameState.reactionTimer);
      if (gameState.chartAnimation) cancelAnimationFrame(gameState.chartAnimation);

      // Reset UI
      document.getElementById('chartContainer').className = 'chart-container';
      document.getElementById('sellButton').disabled = true;
      document.getElementById('gameStatus').textContent = 'Click START TRADE to begin';
      document.getElementById('gameStatus').style.color = '#a0a8b0';
      updateBestTimeDisplay();
      document.getElementById('resultsGrid').innerHTML = '';
      
      const canvas = document.getElementById('chartCanvas');
      const ctx = canvas.getContext('2d');
      drawChart(ctx, false);
    }

    // Crash Game Logic
    let crashGameState = {
      phase: 'waiting', // waiting, betting, flying, crashed
      currentMultiplier: 1.00,
      crashPoint: 0,
      seed: '',
      hash: '',
      betAmount: 0,
      autoCashout: 0,
      hashedIn: false,
      startTime: 0,
      countdown: 3, // Reduced from 5 to 3 seconds between rounds
      history: []
    };

    async function initCrashGame() {
      // Load history from localStorage
      const savedHistory = localStorage.getItem('crash_history');
      if (savedHistory) {
        crashGameState.history = JSON.parse(savedHistory);
        updateCrashHistory();
      }

      // Update GP display
      updateCrashGPDisplay();

      // Setup canvas
      const canvas = document.getElementById('crashTrailCanvas');
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;

      // Event listeners
      document.getElementById('crashPlaceBetBtn').addEventListener('click', placeCrashBet);
      document.getElementById('crashCashoutBtn').addEventListener('click', crashCashout);

      // Start game loop
      startCrashRound();
    }

    function updateCrashGPDisplay() {
      const gp = parseInt(localStorage.getItem('duelpvp_gp')) || 0;
      document.getElementById('crashGPDisplay').textContent = gp;
      document.getElementById('crashCurrentBet').textContent = crashGameState.betAmount;

      if (crashGameState.betAmount > 0 && crashGameState.phase === 'flying') {
        const potential = Math.floor(crashGameState.betAmount * crashGameState.currentMultiplier);
        document.getElementById('crashPotentialWin').textContent = potential;
      } else {
        document.getElementById('crashPotentialWin').textContent = '0';
      }
    }

    function generateCrashPoint() {
      // Generate provably fair crash point
      const seed = Math.random().toString(36).substring(2) + Date.now().toString(36);
      const hash = SHA256(seed);

      // Convert hash to crash point (simplified version)
      const hexValue = hash.substring(0, 8);
      const intValue = parseInt(hexValue, 16);

      // Formula: 10% PLAYER EDGE (110% RTP) - players win over time!
      const result = (1.10 * Math.pow(2, 32)) / (Math.pow(2, 32) - intValue);
      const crashPoint = Math.max(1.00, Math.min(100, result));

      return { seed, hash, crashPoint };
    }

    // Simple SHA-256 implementation
    function SHA256(str) {
      return Array.from(str).reduce((hash, char) => {
        return ((hash << 5) - hash) + char.charCodeAt(0) | 0;
      }, 0).toString(16).padStart(8, '0').repeat(8);
    }

    async function startCrashRound() {
      // Reset state
      crashGameState.phase = 'waiting';
      crashGameState.currentMultiplier = 1.00;
      crashGameState.hashedIn = false;
      crashGameState.betAmount = 0; // Reset bet for new round
      crashGameState.countdown = 3; // Reduced from 5 to 3 seconds

      // Generate crash point for next round
      const { seed, hash, crashPoint } = generateCrashPoint();
      crashGameState.seed = seed;
      crashGameState.hash = hash;
      crashGameState.crashPoint = crashPoint;

      console.log('[Crash Game] New round started. Crash point:', crashPoint);

      // Display hash
      document.getElementById('crashHash').textContent = hash.substring(0, 32) + '...';
      document.getElementById('crashStatusText').textContent = 'Waiting for bets...';
      document.getElementById('crashMultiplierValue').textContent = '1.00x';

      // Enable bet button
      document.getElementById('crashPlaceBetBtn').disabled = false;
      document.getElementById('crashPlaceBetBtn').textContent = 'PLACE BET';

      // Update GP display
      updateCrashGPDisplay();

      // Countdown phase
      const countdownInterval = setInterval(() => {
        crashGameState.countdown--;
        const countdownEl = document.getElementById('crashCountdown');
        if (countdownEl) {
          countdownEl.textContent = crashGameState.countdown;
        }
        document.getElementById('crashGameStatus').innerHTML = `Next round starts in <span id="crashCountdown">${crashGameState.countdown}</span>s`;

        if (crashGameState.countdown <= 0) {
          clearInterval(countdownInterval);
          startFlying();
        }
      }, 1000);
    }

    function startFlying() {
      crashGameState.phase = 'flying';
      crashGameState.startTime = Date.now();

      document.getElementById('crashStatusText').textContent = 'Flying!';
      document.getElementById('crashGameStatus').textContent = 'Cash out before it crashes!';
      document.getElementById('crashPlaceBetBtn').disabled = true;

      const rocket = document.getElementById('crashRocket');
      const multiplierEl = document.getElementById('crashMultiplierValue');

      rocket.classList.add('flying');
      multiplierEl.classList.add('flying');

      // Enable cashout if player has bet
      if (crashGameState.betAmount > 0) {
        document.getElementById('crashCashoutBtn').disabled = false;
      }

      flyingLoop();
    }

    function flyingLoop() {
      if (crashGameState.phase !== 'flying') return;

      const elapsed = (Date.now() - crashGameState.startTime) / 1000;
      crashGameState.currentMultiplier = 1 + (elapsed * 0.3); // Increases 0.3x per second

      // Update display
      document.getElementById('crashMultiplierValue').textContent = crashGameState.currentMultiplier.toFixed(2) + 'x';
      updateCrashGPDisplay();

      // Move rocket up
      const rocket = document.getElementById('crashRocket');
      const progress = Math.min(0.9, elapsed / 10); // 10 seconds to reach top
      const bottom = 20 + (progress * 300); // Move from bottom:20px to bottom:320px
      rocket.style.bottom = bottom + 'px';

      // Draw trail
      drawCrashTrail();

      // Check for crash
      if (crashGameState.currentMultiplier >= crashGameState.crashPoint) {
        crash();
        return;
      }

      // Check auto-cashout
      if (crashGameState.autoCashout > 0 && crashGameState.currentMultiplier >= crashGameState.autoCashout && crashGameState.betAmount > 0) {
        crashCashout();
        return;
      }

      requestAnimationFrame(flyingLoop);
    }

    function drawCrashTrail() {
      const canvas = document.getElementById('crashTrailCanvas');
      const ctx = canvas.getContext('2d');

      const rocket = document.getElementById('crashRocket');
      const rocketRect = rocket.getBoundingClientRect();
      const containerRect = canvas.getBoundingClientRect();

      const x = rocketRect.left - containerRect.left + (rocketRect.width / 2);
      const y = rocketRect.top - containerRect.top + (rocketRect.height / 2);

      // Add glow trail
      ctx.fillStyle = `rgba(255, 214, 77, ${0.1 + Math.random() * 0.1})`;
      ctx.beginPath();
      ctx.arc(x, y + 20, 5 + Math.random() * 3, 0, Math.PI * 2);
      ctx.fill();

      // Fade existing trail
      ctx.fillStyle = 'rgba(16, 20, 24, 0.05)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    function crash() {
      crashGameState.phase = 'crashed';

      const rocket = document.getElementById('crashRocket');
      const container = document.getElementById('crashRocketContainer');
      const multiplierEl = document.getElementById('crashMultiplierValue');

      rocket.classList.remove('flying');
      multiplierEl.classList.remove('flying');
      container.classList.add('crashed');

      document.getElementById('crashStatusText').textContent = 'CRASHED!';
      document.getElementById('crashStatusText').style.color = '#F44336';
      document.getElementById('crashMultiplierValue').textContent = crashGameState.crashPoint.toFixed(2) + 'x';
      document.getElementById('crashGameStatus').textContent = `Crashed at ${crashGameState.crashPoint.toFixed(2)}x`;
      document.getElementById('crashCashoutBtn').disabled = true;

      // If player had bet and didn't cash out, they lose
      if (crashGameState.betAmount > 0) {
        Toast.error(`Lost ${crashGameState.betAmount} GP at ${crashGameState.crashPoint.toFixed(2)}x`, 'CRASHED');
        crashGameState.betAmount = 0;
        updateCrashGPDisplay();
        updateDashboardStats();
      }

      // Add to history
      addToCrashHistory(crashGameState.crashPoint);

      console.log('[Crash Game] Crashed at', crashGameState.crashPoint.toFixed(2) + 'x', '- restarting in 2 seconds...');

      // Reset rocket position and start new round
      setTimeout(() => {
        console.log('[Crash Game] Starting new round...');
        rocket.style.bottom = '20px';
        container.classList.remove('crashed');
        document.getElementById('crashStatusText').style.color = '#a0a8b0';

        // Clear canvas
        const canvas = document.getElementById('crashTrailCanvas');
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Start new round
        startCrashRound();
      }, 2000); // Reduced from 3000ms to 2000ms
    }

    function placeCrashBet() {
      if (crashGameState.phase !== 'waiting') {
        Toast.error('Wait for next round', 'TOO LATE');
        return;
      }

      const betInput = document.getElementById('crashBetAmount');
      const betAmount = parseInt(betInput.value);
      const autoCashoutInput = document.getElementById('crashAutoCashout');
      const autoCashout = parseFloat(autoCashoutInput.value) || 0;

      const gp = parseInt(localStorage.getItem('duelpvp_gp')) || 0;

      if (isNaN(betAmount) || betAmount < 10) {
        Toast.error('Minimum bet is 10 GP', 'INVALID BET');
        return;
      }

      if (betAmount > 10000) {
        Toast.error('Maximum bet is 10,000 GP', 'INVALID BET');
        return;
      }

      if (betAmount > gp) {
        Toast.error('Insufficient GP', 'INSUFFICIENT FUNDS');
        return;
      }

      // Deduct bet from balance
      localStorage.setItem('duelpvp_gp', (gp - betAmount).toString());
      crashGameState.betAmount = betAmount;
      crashGameState.autoCashout = autoCashout;
      crashGameState.hashedIn = true;

      updateCrashGPDisplay();
      updateDashboardStats();

      Toast.success(`Bet placed: ${betAmount} GP`, 'BET PLACED');
      document.getElementById('crashPlaceBetBtn').disabled = true;
      document.getElementById('crashPlaceBetBtn').textContent = 'BET PLACED';
    }

    function crashCashout() {
      if (crashGameState.phase !== 'flying' || crashGameState.betAmount <= 0) {
        return;
      }

      const winAmount = Math.floor(crashGameState.betAmount * crashGameState.currentMultiplier);
      const profit = winAmount - crashGameState.betAmount;

      // Add winnings to balance
      const gp = parseInt(localStorage.getItem('duelpvp_gp')) || 0;
      localStorage.setItem('duelpvp_gp', (gp + winAmount).toString());

      Toast.success(`Cashed out at ${crashGameState.currentMultiplier.toFixed(2)}x! Won ${winAmount} GP (+${profit})`, 'CASHED OUT');

      crashGameState.betAmount = 0;
      updateCrashGPDisplay();
      updateDashboardStats();

      document.getElementById('crashCashoutBtn').disabled = true;
    }

    function addToCrashHistory(crashPoint) {
      crashGameState.history.unshift(crashPoint);
      if (crashGameState.history.length > 20) {
        crashGameState.history = crashGameState.history.slice(0, 20);
      }
      localStorage.setItem('crash_history', JSON.stringify(crashGameState.history));
      updateCrashHistory();
    }

    function updateCrashHistory() {
      const historyList = document.getElementById('crashHistoryList');
      historyList.innerHTML = '';

      crashGameState.history.forEach(point => {
        const item = document.createElement('div');
        item.className = 'crash-history-item';

        if (point < 2) {
          item.classList.add('crashed-low');
        } else if (point < 5) {
          item.classList.add('crashed-med');
        } else {
          item.classList.add('crashed-high');
        }

        item.textContent = point.toFixed(2) + 'x';
        historyList.appendChild(item);
      });
    }

    // Quest System Data and Functions
    const QUESTS = {
      daily: [
        {id: 'daily_play_3', name: 'Speed Demon', desc: 'Play 3 reaction games', target: 3, reward: 500, icon: '⚡'},
        {id: 'daily_fast_time', name: 'Lightning Reflexes', desc: 'Get a time under 300ms', target: 1, reward: 750, icon: '⏱️'},
        {id: 'daily_streak_3', name: 'On Fire', desc: 'Win 3 games in a row', target: 3, reward: 600, icon: '🔥'},
        {id: 'daily_login', name: 'Daily Warrior', desc: 'Login to the arena', target: 1, reward: 250, icon: '🗡️'},
        {id: 'twitter_follow', name: 'Follow on Twitter', desc: 'Follow @YourProject on Twitter/X', target: 1, reward: 500, icon: '🐦', type: 'twitter', hasTimer: true},
        {id: 'twitter_like', name: 'Like Launch Tweet', desc: 'Like our official launch announcement', target: 1, reward: 300, icon: '❤️', type: 'twitter', tweetUrl: 'https://twitter.com/YourProject/status/123456789', hasTimer: true},
        {id: 'twitter_retweet', name: 'Retweet Launch', desc: 'Retweet our launch announcement', target: 1, reward: 300, icon: '🔄', type: 'twitter', tweetUrl: 'https://twitter.com/YourProject/status/123456789', hasTimer: true},
        {id: 'twitter_quote', name: 'Quote Tweet', desc: 'Quote tweet with your thoughts', target: 1, reward: 500, icon: '💬', type: 'twitter', hasTimer: true},
        {id: 'discord_join', name: 'Join Discord', desc: 'Join our Discord community', target: 1, reward: 400, icon: '💬', type: 'discord', hasTimer: true}
      ],
      weekly: [
        {id: 'weekly_play_20', name: 'Arena Regular', desc: 'Play 20 reaction games', target: 20, reward: 2500, icon: '🎮'},
        {id: 'weekly_top_10', name: 'Elite Fighter', desc: 'Reach top 10 on leaderboard', target: 1, reward: 5000, icon: '🏆'},
        {id: 'weekly_sub_250', name: 'Reflex Master', desc: 'Get 5 times under 250ms', target: 5, reward: 3000, icon: '⚡'},
        {id: 'weekly_shop', name: 'Merchant', desc: 'Buy 3 items from shop', target: 3, reward: 1500, icon: '🛒'}
      ],
      special: []
    };

    // Server time fetching to prevent local clock manipulation
    async function getServerTime() {
      try {
        const response = await fetch('https://worldtimeapi.org/api/timezone/Etc/UTC');
        const data = await response.json();
        return new Date(data.datetime);
      } catch (error) {
        console.error('Failed to fetch server time, using local time as fallback:', error);
        return new Date();
      }
    }

    function formatTimeRemaining(ms) {
      const hours = Math.floor(ms / (1000 * 60 * 60));
      const minutes = Math.floor((ms % (1000 * 60 * 60)) / (1000 * 60));
      return `${hours}h ${minutes}m`;
    }

    async function loadQuests(type) {
      const questGrid = document.getElementById('questGrid');
      const comingSoonOverlay = document.getElementById('comingSoonOverlay');
      const userId = localStorage.getItem('duelpvp_user_id');

      if (!userId) {
        questGrid.innerHTML = '<div class="no-data">Please log in to view quests</div>';
        return;
      }

      // Check if test mode user
      const isTestMode = userId.startsWith('test-');

      // Show coming soon overlay for weekly and special quests
      if (type === 'weekly' || type === 'special') {
        questGrid.classList.add('locked');
        comingSoonOverlay.style.display = 'flex';

        // Show blurred placeholder quests
        questGrid.innerHTML = '';
        const placeholderQuests = type === 'weekly' ? QUESTS.weekly : [
          {name: 'Mystery Quest 1', desc: 'Complete special challenges for massive rewards', reward: '???', icon: '🌟'},
          {name: 'Mystery Quest 2', desc: 'Limited time event quest', reward: '???', icon: '✨'},
          {name: 'Mystery Quest 3', desc: 'Exclusive seasonal challenge', reward: '???', icon: '🎁'},
          {name: 'Mystery Quest 4', desc: 'Epic endgame content', reward: '???', icon: '💫'}
        ];

        placeholderQuests.forEach(quest => {
          const card = document.createElement('div');
          card.className = 'quest-card';
          card.innerHTML = `
            <div class="quest-name"><span class="quest-icon">${quest.icon}</span> ${quest.name}</div>
            <div class="quest-desc">${quest.desc}</div>
            <div class="quest-progress">
              <div class="progress-bar">
                <div class="progress-fill" style="width:0%"></div>
              </div>
              <div class="progress-text">0 / ${quest.target || 1}</div>
            </div>
            <div class="quest-reward">💰 ${quest.reward} GP</div>
          `;
          questGrid.appendChild(card);
        });
        return;
      } else {
        questGrid.classList.remove('locked');
        comingSoonOverlay.style.display = 'none';
      }

      // For daily quests or completed - show actual quests
      if (isTestMode) {
        // Test mode - show daily quests without database
        questGrid.innerHTML = '';
        const quests = type === 'completed' ? [] : QUESTS.daily;

        if (quests.length === 0) {
          questGrid.innerHTML = '<div class="no-data">No quests available</div>';
          return;
        }

        quests.forEach(quest => {
          const card = document.createElement('div');
          card.className = 'quest-card';
          const isSocialQuest = quest.type === 'twitter' || quest.type === 'discord';

          if (isSocialQuest) {
            card.innerHTML = `
              <div class="quest-name"><span class="quest-icon">${quest.icon}</span> ${quest.name}</div>
              <div class="quest-desc">${quest.desc}${quest.tweetUrl ? ` <a href="${quest.tweetUrl}" target="_blank" style="color:var(--gold);text-decoration:underline;">View Tweet</a>` : ''}</div>
              <div class="quest-progress">
                <button class="action-btn btn-secondary" style="width:100%;margin-top:8px;" disabled>
                  VERIFY
                </button>
              </div>
              <div class="quest-reward">💰 ${quest.reward} GP</div>
            `;
          } else {
            card.innerHTML = `
              <div class="quest-name"><span class="quest-icon">${quest.icon}</span> ${quest.name}</div>
              <div class="quest-desc">${quest.desc}</div>
              <div class="quest-progress">
                <div class="progress-bar">
                  <div class="progress-fill" style="width:0%"></div>
                </div>
                <div class="progress-text">0 / ${quest.target}</div>
              </div>
              <div class="quest-reward">💰 ${quest.reward} GP</div>
            `;
          }
          questGrid.appendChild(card);
        });
        return;
      }

      Loading.show('Loading quests...');

      // Fetch quest progress from Supabase
      const { data: questData, error: questError } = await supabase
        .from('quests')
        .select('*')
        .eq('user_id', userId)
        .eq('reset_date', new Date().toISOString().split('T')[0]); // Today's date

      Loading.hide();

      if (questError) {
        console.error('Failed to load quests:', questError);
        questGrid.innerHTML = '<div class="no-data">Error loading quests. Please try again later.</div>';
        return;
      }

      // Convert array to object for easier lookup
      const questProgress = {};
      questData?.forEach(q => {
        questProgress[q.quest_id] = q.progress;
        if (q.claimed_at) {
          questProgress[`${q.quest_id}_claimed`] = true;
        }
        if (q.start_time) {
          questProgress[`${q.quest_id}_start_time`] = new Date(q.start_time).getTime();
        }
      });

      // Get server time to prevent clock manipulation
      const serverTime = await getServerTime();

      questGrid.innerHTML = '';
      const quests = type === 'completed'
        ? [...QUESTS.daily, ...QUESTS.weekly, ...QUESTS.special].filter(q => (questProgress[q.id] || 0) >= q.target)
        : QUESTS[type] || QUESTS.daily;

      quests.forEach(quest => {
        const progress = questProgress[quest.id] || 0;
        const completed = progress >= quest.target;
        const claimed = questProgress[`${quest.id}_claimed`] || false;
        const isSocialQuest = quest.type === 'twitter' || quest.type === 'discord';
        const hasTimer = quest.hasTimer && !completed;

        // Calculate time remaining for 24-hour timer quests
        let timeRemainingText = '';
        if (hasTimer) {
          const questStartTime = questProgress[`${quest.id}_start_time`];
          if (questStartTime) {
            const elapsed = serverTime.getTime() - questStartTime;
            const remaining = (24 * 60 * 60 * 1000) - elapsed;
            if (remaining > 0) {
              timeRemainingText = `<div style="font-size:10px;color:#4CAF50;margin-top:4px;">⏱️ ${formatTimeRemaining(remaining)} left</div>`;
            } else {
              // Timer expired, quest failed
              delete questProgress[quest.id];
              delete questProgress[`${quest.id}_start_time`];
              localStorage.setItem(`duelpvp_quests_${email}`, JSON.stringify(questProgress));
            }
          }
        }

        const card = document.createElement('div');
        card.className = `quest-card ${completed ? 'completed' : ''} ${completed && !claimed ? 'claimable' : ''}`;

        if (isSocialQuest) {
          // Social quest with verify button
          card.innerHTML = `
            <div class="quest-name"><span class="quest-icon">${quest.icon}</span> ${quest.name}</div>
            <div class="quest-desc">${quest.desc}${quest.tweetUrl ? ` <a href="${quest.tweetUrl}" target="_blank" style="color:var(--gold);text-decoration:underline;">View Tweet</a>` : ''}</div>
            <div class="quest-progress">
              <button class="action-btn btn-secondary" style="width:100%;margin-top:8px;" onclick="verifySocialQuest('${quest.id}', '${quest.type}')">
                ${completed ? '✓ VERIFIED' : 'VERIFY'}
              </button>
              ${timeRemainingText}
            </div>
            <div class="quest-reward">
              💰 ${quest.reward} GP ${completed && !claimed ? '• <span style="color:var(--gold)">CLAIM!</span>' : completed ? '✓ CLAIMED' : ''}
            </div>
          `;
        } else {
          // Regular quest with progress bar
          card.innerHTML = `
            <div class="quest-name"><span class="quest-icon">${quest.icon}</span> ${quest.name}</div>
            <div class="quest-desc">${quest.desc}</div>
            <div class="quest-progress">
              <div class="progress-bar">
                <div class="progress-fill" style="width:${Math.min(100, (progress/quest.target)*100)}%"></div>
              </div>
              <div class="progress-text">${progress} / ${quest.target}</div>
            </div>
            <div class="quest-reward">
              💰 ${quest.reward} GP ${completed && !claimed ? '• <span style="color:var(--gold)">CLAIM!</span>' : completed ? '✓ CLAIMED' : ''}
            </div>
          `;
        }

        if (completed && !claimed) {
          card.style.cursor = 'pointer';
          card.addEventListener('click', () => claimQuestReward(quest.id, quest.reward));
        }

        questGrid.appendChild(card);
      });

      if (quests.length === 0) {
        questGrid.innerHTML = '<div class="no-data">No quests available</div>';
      }
    }

    // Social quest verification (manual for now, Galxe integration ready)
    async function verifySocialQuest(questId, questType) {
      const email = localStorage.getItem('duelpvp_email') || 'anonymous';
      let questProgress = JSON.parse(localStorage.getItem(`duelpvp_quests_${email}`) || '{}');

      // Check if already completed
      if (questProgress[questId] >= 1) {
        Modal.alert('Quest already verified!', 'Already Completed');
        return;
      }

      // Get server time for timer
      Loading.show('Checking server time...');
      const serverTime = await getServerTime();
      Loading.hide();

      // MANUAL VERIFICATION (Free, no API costs)
      // TODO: Replace with Galxe API when ready
      if (questType === 'twitter') {
        const handle = prompt('Enter your Twitter handle (@username) to verify:');
        if (!handle) return;

        // Show confirmation
        const confirmed = await Modal.confirm(`Please complete the quest first, then click CONFIRM.

Your handle: ${handle}

You have 24 hours to complete this quest.
We'll verify manually and you can claim your reward!`, 'Start Quest Timer?');

        if (confirmed) {
          // Store pending verification and start 24-hour timer
          questProgress[`${questId}_pending`] = handle;
          questProgress[`${questId}_timestamp`] = serverTime.getTime();
          questProgress[`${questId}_start_time`] = serverTime.getTime();
          localStorage.setItem(`duelpvp_quests_${email}`, JSON.stringify(questProgress));

          Toast.info('You have 24 hours to complete this quest', 'QUEST STARTED');
          loadQuests('daily');

          // GALXE INTEGRATION POINT:
          // Uncomment below when Galxe is set up
          /*
          try {
            const wallet = localStorage.getItem(`duelpvp_wallet_${email}`);
            const verified = await checkGalxeCredential(wallet, questId);
            if (verified) {
              questProgress[questId] = 1;
              localStorage.setItem(`duelpvp_quests_${email}`, JSON.stringify(questProgress));
              Toast.success('Quest verified! Claim your reward.', 'QUEST COMPLETE');
              loadQuests('daily');
            }
          } catch (error) {
            Toast.error('Verification failed. Please try again.', 'ERROR');
          }
          */
        }
      } else if (questType === 'discord') {
        const discordTag = prompt('Enter your Discord username:');
        if (!discordTag) return;

        // Store pending and start 24-hour timer
        questProgress[`${questId}_pending`] = discordTag;
        questProgress[`${questId}_timestamp`] = serverTime.getTime();
        questProgress[`${questId}_start_time`] = serverTime.getTime();
        localStorage.setItem(`duelpvp_quests_${email}`, JSON.stringify(questProgress));

        Toast.info('Join our Discord and complete within 24 hours', 'QUEST STARTED');
        loadQuests('daily');
      }
    }

    // Helper function for Galxe API (ready for when you set it up)
    async function checkGalxeCredential(walletAddress, questId) {
      // TODO: Replace with your actual Galxe campaign ID
      const GALXE_CAMPAIGN_ID = 'YOUR_CAMPAIGN_ID';

      try {
        const response = await fetch('https://graphigo.prd.galaxy.eco/query', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            query: `{
              campaign(id: "${GALXE_CAMPAIGN_ID}") {
                participants(address: "${walletAddress}") {
                  eligible
                }
              }
            }`
          })
        });

        const data = await response.json();
        return data?.data?.campaign?.participants?.eligible || false;
      } catch (error) {
        console.error('Galxe verification error:', error);
        return false;
      }
    }

    async function claimQuestReward(questId, reward) {
      const userId = localStorage.getItem('duelpvp_user_id');

      if (!userId) return;

      Loading.show('Claiming reward...');

      try {
        // Use Supabase RPC function to claim quest reward
        const { data: success, error } = await supabase
          .rpc('claim_quest_reward', {
            p_user_id: userId,
            p_quest_id: questId,
            p_reward_points: reward
          });

        Loading.hide();

        if (error || !success) {
          console.error('Failed to claim quest reward:', error);
          Toast.error('Failed to claim reward', 'ERROR');
          return;
        }

        // Reload quests
        const activeTab = document.querySelector('.quest-tab.active').getAttribute('data-quest-tab');
        loadQuests(activeTab);

        // Show notification
        Toast.success(`+${reward} GP earned!`, 'QUEST COMPLETED');

      } catch (e) {
        Loading.hide();
        console.error('Error claiming quest reward:', e);
        Toast.error('An error occurred', 'ERROR');
      }
    }

    async function updateQuestProgress(questId, amount = 1) {
      const userId = localStorage.getItem('duelpvp_user_id');

      if (!userId) return;

      try {
        // Use Supabase RPC function to update quest progress
        const { error } = await supabase
          .rpc('update_quest_progress', {
            p_user_id: userId,
            p_quest_id: questId,
            p_increment: amount
          });

        if (error) {
          console.error('Failed to update quest progress:', error);
        }
      } catch (e) {
        console.error('Error updating quest progress:', e);
      }
    }

    // Inventory and Shop System
    const SHOP_ITEMS = [
      {id: 'sword_bronze', name: 'Bronze Sword', desc: 'A sturdy starter weapon', price: 1000, icon: '🗡️', type: 'weapon'},
      {id: 'sword_iron', name: 'Iron Sword', desc: 'Sharper than bronze', price: 2500, icon: '⚔️', type: 'weapon'},
      {id: 'sword_steel', name: 'Steel Sword', desc: 'Forged with precision', price: 5000, icon: '🗡️', type: 'weapon'},
      {id: 'armor_leather', name: 'Leather Armor', desc: 'Basic protection', price: 1500, icon: '🛡️', type: 'armor'},
      {id: 'armor_chain', name: 'Chain Mail', desc: 'Medium protection', price: 3500, icon: '🛡️', type: 'armor'},
      {id: 'armor_plate', name: 'Plate Armor', desc: 'Heavy protection', price: 7500, icon: '🛡️', type: 'armor'},
      {id: 'potion_health', name: 'Health Potion', desc: 'Restores vitality', price: 500, icon: '🧪', type: 'consumable'},
      {id: 'potion_speed', name: 'Speed Potion', desc: 'Boosts reflexes', price: 750, icon: '⚗️', type: 'consumable'},
      {id: 'cape_red', name: 'Red Cape', desc: 'Show off your style', price: 2000, icon: '🎽', type: 'cosmetic'},
      {id: 'cape_blue', name: 'Blue Cape', desc: 'Cool and collected', price: 2000, icon: '🎽', type: 'cosmetic'},
      {id: 'pet_dog', name: 'War Hound', desc: 'A loyal companion', price: 10000, icon: '🐕', type: 'pet'},
      {id: 'pet_dragon', name: 'Baby Dragon', desc: 'Rare and powerful', price: 50000, icon: '🐉', type: 'pet'}
    ];

    async function loadInventory() {
      const userId = localStorage.getItem('duelpvp_user_id');
      const email = localStorage.getItem('duelpvp_email') || 'anonymous';

      // Get user data from Supabase
      const { data: userData } = await supabase
        .from('users')
        .select('points')
        .eq('id', userId)
        .single();

      const gp = userData?.points || 0;

      // Get inventory from localStorage (for now)
      const inventory = JSON.parse(localStorage.getItem(`duelpvp_inventory_${email}`) || '[]');

      // Get invite codes from Supabase
      const { data: inviteCodes } = await supabase
        .from('codes')
        .select('*')
        .eq('created_by', userId)
        .order('used_at', { ascending: true, nullsFirst: false });

      // Update GP display
      document.getElementById('gpDisplay').textContent = `GP: ${gp.toLocaleString()}`;

      // Render inventory
      const inventoryGrid = document.getElementById('inventoryGrid');
      inventoryGrid.innerHTML = '';

      // Combine invite codes + regular inventory
      const allItems = [];

      // Add invite codes first
      if (inviteCodes) {
        inviteCodes.forEach(code => {
          allItems.push({
            type: 'invite_code',
            code: code.code,
            used: code.used_by !== null,
            used_at: code.used_at
          });
        });
      }

      // Add regular inventory items
      inventory.forEach(item => {
        allItems.push({
          type: 'shop_item',
          ...item
        });
      });

      // Show first 28 slots (like RuneScape)
      for (let i = 0; i < 28; i++) {
        const item = allItems[i];
        const slot = document.createElement('div');
        slot.className = item ? 'inventory-slot' : 'inventory-slot empty';

        if (item && item.type === 'invite_code') {
          // Invite code item
          slot.className = item.used ? 'inventory-slot used-code' : 'inventory-slot';
          slot.innerHTML = `
            <div class="item-icon">${item.used ? '📜' : '🎟️'}</div>
            <div class="item-name">${item.code}</div>
          `;
          // Tooltip
          slot.title = item.used
            ? `Invite Code (USED)\nCode: ${item.code}\nUsed on: ${new Date(item.used_at).toLocaleDateString()}`
            : `Invite Code (UNUSED)\nShare this code with friends!\nOne-time use only`;
        } else if (item && item.type === 'shop_item') {
          // Regular shop item
          const shopItem = SHOP_ITEMS.find(si => si.id === item.id);
          slot.innerHTML = `
            <div class="item-icon">${shopItem.icon}</div>
            <div class="item-name">${shopItem.name}</div>
            ${item.count > 1 ? `<div class="item-count">${item.count}</div>` : ''}
          `;
          slot.title = shopItem.desc;
        } else {
          // Empty slot
          slot.innerHTML = '<div style="opacity:0.3">━</div>';
        }

        inventoryGrid.appendChild(slot);
      }

      // Render shop
      const shopGrid = document.getElementById('shopGrid');
      shopGrid.innerHTML = '';

      SHOP_ITEMS.forEach(item => {
        const shopCard = document.createElement('div');
        shopCard.className = 'shop-item';
        shopCard.innerHTML = `
          <div class="item-icon">${item.icon}</div>
          <div class="shop-item-name">${item.name}</div>
          <div class="shop-item-desc">${item.desc}</div>
          <div class="shop-item-price">💰 ${item.price.toLocaleString()} GP</div>
          <button class="buy-btn" ${gp < item.price ? 'disabled' : ''}>BUY</button>
        `;

        const buyBtn = shopCard.querySelector('.buy-btn');
        buyBtn.addEventListener('click', () => buyItem(item));

        shopGrid.appendChild(shopCard);
      });
    }

    function buyItem(item) {
      const email = localStorage.getItem('duelpvp_email') || 'anonymous';
      let gp = parseInt(localStorage.getItem(`duelpvp_gp_${email}`) || '0');
      let inventory = JSON.parse(localStorage.getItem(`duelpvp_inventory_${email}`) || '[]');

      if (gp < item.price) {
        Modal.alert('Not enough GP! Complete quests or play games to earn more.', 'Insufficient Funds');
        return;
      }

      // Check if inventory is full
      if (inventory.length >= 28 && !inventory.find(i => i.id === item.id && item.type === 'consumable')) {
        Modal.alert('Your inventory is full! Maximum 28 items can be held.', 'Inventory Full');
        return;
      }

      // Deduct GP
      gp -= item.price;
      localStorage.setItem(`duelpvp_gp_${email}`, gp.toString());

      // Add to inventory
      if (item.type === 'consumable') {
        const existing = inventory.find(i => i.id === item.id);
        if (existing) {
          existing.count++;
        } else {
          inventory.push({id: item.id, count: 1});
        }
      } else {
        inventory.push({id: item.id, count: 1});
      }

      localStorage.setItem(`duelpvp_inventory_${email}`, JSON.stringify(inventory));

      // Update quest progress
      updateQuestProgress('weekly_shop');

      // Reload
      loadInventory();
      Toast.success(`${item.icon} ${item.name} added to inventory!`, 'ITEM PURCHASED');
    }

    // ===============================================
    // OVEN INVESTMENT SYSTEM
    // ===============================================

    // Helper functions for GP
    function getUserGP() {
      return parseInt(localStorage.getItem('duelpvp_gp')) || 0;
    }

    async function updateUserGP(amount) {
      const currentGP = getUserGP();
      const newGP = currentGP + amount;
      localStorage.setItem('duelpvp_gp', newGP.toString());

      // Update dashboard display if visible with animation
      const dashboardGPEl = document.getElementById('dashboardGPBalance');
      if (dashboardGPEl) {
        const displayGP = newGP;
        const formattedGP = displayGP >= 1000000 ? `${(displayGP/1000000).toFixed(1)}M` : displayGP >= 1000 ? `${(displayGP/1000).toFixed(1)}K` : displayGP;

        // Apply animation
        dashboardGPEl.classList.remove('gp-change', 'gp-increase', 'gp-decrease');
        void dashboardGPEl.offsetWidth; // Trigger reflow
        dashboardGPEl.classList.add('gp-change');

        if (amount > 0) {
          dashboardGPEl.classList.add('gp-increase');
        } else if (amount < 0) {
          dashboardGPEl.classList.add('gp-decrease');
        }

        dashboardGPEl.textContent = formattedGP;

        // Remove animation classes after animation completes
        setTimeout(() => {
          dashboardGPEl.classList.remove('gp-change', 'gp-increase', 'gp-decrease');
        }, 300);
      }

      // Update campaign progress
      const campaignCurrentGP = document.getElementById('campaignCurrentGP');
      const campaignProgressFill = document.getElementById('campaignProgressFill');
      if (campaignCurrentGP && campaignProgressFill) {
        campaignCurrentGP.textContent = newGP.toLocaleString();
        const progress = Math.min((newGP / 1000000) * 100, 100);
        campaignProgressFill.style.width = progress + '%';
      }

      return newGP;
    }

    let ovenState = {
      invested: 0,
      lastCompoundTime: null,
      timerInterval: null
    };

    function loadOvenState() {
      try {
        const saved = localStorage.getItem('duelpvp_oven');
        if (saved) {
          const data = JSON.parse(saved);
          ovenState.invested = data.invested || 0;
          ovenState.lastCompoundTime = data.lastCompoundTime ? new Date(data.lastCompoundTime) : null;

          // Calculate missed compounds
          if (ovenState.lastCompoundTime && ovenState.invested > 0) {
            const now = new Date();
            const hoursPassed = (now - new Date(ovenState.lastCompoundTime)) / (1000 * 60 * 60);
            const fullHours = Math.floor(hoursPassed);

            if (fullHours > 0) {
              // Apply missed compounds (10% per hour)
              for (let i = 0; i < fullHours; i++) {
                ovenState.invested *= 1.10;
              }
              ovenState.lastCompoundTime = new Date(ovenState.lastCompoundTime.getTime() + fullHours * 60 * 60 * 1000);
              saveOvenState();
            }
          }
        }
      } catch (e) {
        console.error('Error loading oven state:', e);
      }
    }

    function saveOvenState() {
      try {
        localStorage.setItem('duelpvp_oven', JSON.stringify({
          invested: ovenState.invested,
          lastCompoundTime: ovenState.lastCompoundTime
        }));
      } catch (e) {
        console.error('Error saving oven state:', e);
      }
    }

    function initOven() {
      loadOvenState();
      updateOvenDisplay();
      startOvenTimer();
    }

    function updateOvenDisplay() {
      try {
        const userGP = getUserGP();
        const balanceEl = document.getElementById('ovenUserBalance');
        const investedEl = document.getElementById('ovenInvested');
        const valueEl = document.getElementById('ovenCurrentValue');

        if (balanceEl) balanceEl.textContent = Math.floor(userGP) + ' GP';
        if (investedEl) investedEl.textContent = Math.floor(ovenState.invested) + ' GP';
        if (valueEl) valueEl.textContent = Math.floor(ovenState.invested) + ' GP';
      } catch (e) {
        console.error('Error updating oven display:', e);
      }
    }

    function startOvenTimer() {
      // Clear existing timer
      if (ovenState.timerInterval) {
        clearInterval(ovenState.timerInterval);
      }

      const timerEl = document.getElementById('ovenTimer');
      if (!timerEl) {
        console.error('Timer element not found');
        return;
      }

      if (ovenState.invested <= 0) {
        timerEl.textContent = 'No active investment';
        return;
      }

      // Set initial compound time if not set
      if (!ovenState.lastCompoundTime) {
        ovenState.lastCompoundTime = new Date();
        saveOvenState();
      }

      // Update timer every second
      ovenState.timerInterval = setInterval(() => {
        const now = new Date();
        const nextCompound = new Date(ovenState.lastCompoundTime.getTime() + 60 * 60 * 1000);
        const timeLeft = nextCompound - now;

        if (timeLeft <= 0) {
          // Time to compound!
          applyCompound();
        } else {
          const hours = Math.floor(timeLeft / (1000 * 60 * 60));
          const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
          const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

          const timer = document.getElementById('ovenTimer');
          if (timer) {
            timer.textContent = `Next compound in: ${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
          }
        }
      }, 1000);
    }

    function applyCompound() {
      if (ovenState.invested <= 0) return;

      // Apply 10% compound
      const oldValue = ovenState.invested;
      ovenState.invested *= 1.10;
      const profit = ovenState.invested - oldValue;
      ovenState.lastCompoundTime = new Date();

      saveOvenState();
      updateOvenDisplay();

      // Show notification
      const timer = document.getElementById('ovenTimer');
      if (timer) {
        timer.textContent = `🔥 COMPOUNDED! +${Math.floor(profit)} GP`;
      }

      Toast.success(`Oven compounded! +${Math.floor(profit)} GP`, 'COMPOUND');

      setTimeout(() => {
        startOvenTimer();
      }, 2000);
    }

    async function depositToOven() {
      const amount = parseInt(document.getElementById('ovenDepositAmount').value);

      if (isNaN(amount) || amount <= 0) {
        Toast.error('Please enter a valid amount', 'INVALID');
        return;
      }

      const userGP = getUserGP();
      if (amount > userGP) {
        Toast.error('Insufficient balance', 'INSUFFICIENT FUNDS');
        return;
      }

      // Deduct from user balance
      await updateUserGP(-amount);

      // Add to invested
      ovenState.invested += amount;

      // Set compound time if first deposit
      if (!ovenState.lastCompoundTime) {
        ovenState.lastCompoundTime = new Date();
      }

      saveOvenState();
      updateOvenDisplay();
      startOvenTimer();

      document.getElementById('ovenDepositAmount').value = '';
      Toast.success(`Deposited ${amount} GP to the Oven!`, 'DEPOSIT');
    }

    async function withdrawFromOven() {
      if (ovenState.invested <= 0) {
        Toast.error('No investment to withdraw', 'NO INVESTMENT');
        return;
      }

      const amount = Math.floor(ovenState.invested);

      // Confirm withdrawal
      const confirmed = await Modal.confirm(
        `Withdraw ${amount.toLocaleString()} GP from the Oven?`,
        'Confirm Withdrawal'
      );
      if (!confirmed) return;

      // Add to user balance
      await updateUserGP(amount);

      // Reset oven
      ovenState.invested = 0;
      ovenState.lastCompoundTime = null;

      // Clear timer
      if (ovenState.timerInterval) clearInterval(ovenState.timerInterval);

      saveOvenState();
      updateOvenDisplay();

      const timer = document.getElementById('ovenTimer');
      if (timer) timer.textContent = 'No active investment';

      Toast.success(`Withdrawn ${amount} GP from the Oven!`, 'WITHDRAW');
    }

    // ===============================================
    // AIRDROP FARM SYSTEM
    // ===============================================

    let farmState = {
      totalEarned: 0,
      todayEarned: 0,
      totalClicks: 0,
      lastClickTime: null,
      lastResetDate: null,
      cooldownActive: false,
      cooldownInterval: null
    };

    function loadFarmState() {
      const saved = localStorage.getItem('duelpvp_farm');
      if (saved) {
        try {
          const data = JSON.parse(saved);
          farmState = { ...farmState, ...data };

          // Reset daily stats if new day
          const today = new Date().toDateString();
          if (farmState.lastResetDate !== today) {
            farmState.todayEarned = 0;
            farmState.lastResetDate = today;
            saveFarmState();
          }
        } catch (e) {
          console.error('Failed to load farm state:', e);
        }
      } else {
        // Initialize with today's date
        farmState.lastResetDate = new Date().toDateString();
        saveFarmState();
      }
    }

    function saveFarmState() {
      localStorage.setItem('duelpvp_farm', JSON.stringify(farmState));
    }

    function updateFarmDisplay() {
      const totalEl = document.getElementById('farmTotalEarned');
      const todayEl = document.getElementById('farmTodayEarned');
      const clicksEl = document.getElementById('farmTotalClicks');

      if (totalEl) totalEl.textContent = Math.floor(farmState.totalEarned).toLocaleString() + ' GP';
      if (todayEl) todayEl.textContent = Math.floor(farmState.todayEarned).toLocaleString() + ' GP';
      if (clicksEl) clicksEl.textContent = farmState.totalClicks.toLocaleString();
    }

    function initFarm() {
      loadFarmState();
      updateFarmDisplay();

      // Check if cooldown should still be active
      if (farmState.lastClickTime) {
        const timeSince = Date.now() - farmState.lastClickTime;
        if (timeSince < 5000) {
          startFarmCooldown(5000 - timeSince);
        }
      }
    }

    function getRandomReward() {
      const rand = Math.random() * 100;

      // 80% chance: 0 GP
      if (rand < 80) {
        return { amount: 0, tier: 'miss' };
      }
      // 15% chance: 20 GP
      else if (rand < 95) {
        return { amount: 20, tier: 'common' };
      }
      // 4% chance: 150 GP
      else if (rand < 99) {
        return { amount: 150, tier: 'rare' };
      }
      // 1% chance: 1500 GP
      else {
        return { amount: 1500, tier: 'jackpot' };
      }
    }

    function clickFarm() {
      if (farmState.cooldownActive) return;

      const reward = getRandomReward();
      const resultEl = document.getElementById('farmResult');
      const btn = document.getElementById('farmClickBtn');

      // Update stats
      farmState.totalClicks++;
      if (reward.amount > 0) {
        farmState.totalEarned += reward.amount;
        farmState.todayEarned += reward.amount;
        updateUserGP(reward.amount);
      }
      farmState.lastClickTime = Date.now();
      saveFarmState();
      updateFarmDisplay();

      // Show result with animation
      resultEl.className = 'farm-result';
      if (reward.tier === 'miss') {
        resultEl.textContent = '✕ 0 GP';
        resultEl.classList.add('flash-red');
      } else if (reward.tier === 'common') {
        resultEl.textContent = '✓ +' + reward.amount + ' GP';
        resultEl.classList.add('flash-green');
      } else if (reward.tier === 'rare') {
        resultEl.textContent = '✓ +' + reward.amount + ' GP';
        resultEl.classList.add('flash-green');
      } else {
        resultEl.textContent = '🎉 ✓ +' + reward.amount + ' GP 🎉';
        resultEl.classList.add('flash-gold');
      }

      // Clear result after animation
      setTimeout(() => {
        resultEl.className = 'farm-result';
        resultEl.textContent = '';
      }, 3000);

      // Start cooldown
      startFarmCooldown(5000);
    }

    function startFarmCooldown(duration) {
      farmState.cooldownActive = true;
      const btn = document.getElementById('farmClickBtn');
      const cooldownEl = document.getElementById('farmCooldown');
      const timerEl = document.getElementById('farmCooldownTimer');
      const fillEl = document.getElementById('farmCooldownFill');

      if (btn) btn.disabled = true;
      if (cooldownEl) cooldownEl.style.display = 'block';

      let remaining = duration;
      const startTime = Date.now();

      if (farmState.cooldownInterval) clearInterval(farmState.cooldownInterval);

      farmState.cooldownInterval = setInterval(() => {
        const elapsed = Date.now() - startTime;
        remaining = Math.max(0, duration - elapsed);
        const seconds = Math.ceil(remaining / 1000);
        const progress = ((duration - remaining) / duration) * 100;

        if (timerEl) timerEl.textContent = seconds;
        if (fillEl) fillEl.style.width = progress + '%';

        if (remaining <= 0) {
          clearInterval(farmState.cooldownInterval);
          farmState.cooldownActive = false;
          if (btn) btn.disabled = false;
          if (cooldownEl) cooldownEl.style.display = 'none';
          if (fillEl) fillEl.style.width = '0%';
        }
      }, 100);
    }

    // ===============================================
    // MINES GAME SYSTEM
    // ===============================================

    let minesGameState = {
      isPlaying: false,
      betAmount: 0,
      minesCount: 5,
      revealedCount: 0,
      grid: [],
      minePositions: [],
      multiplier: 0
    };

    function initMinesGame() {
      const grid = document.getElementById('minesGrid');
      grid.innerHTML = '';

      // Create 5x5 grid
      for (let i = 0; i < 25; i++) {
        const tile = document.createElement('div');
        tile.className = 'mines-tile';
        tile.dataset.index = i;
        tile.addEventListener('click', () => handleMinesTileClick(i));
        grid.appendChild(tile);
      }
    }

    function updateMinesGPDisplay() {
      const gp = getUserGP();
      document.getElementById('minesGPDisplay').textContent = gp;
    }

    async function startMinesGame() {
      const betAmount = parseInt(document.getElementById('minesBetAmount').value);
      const minesCount = parseInt(document.getElementById('minesCount').value);
      const userGP = getUserGP();

      // Validation
      if (isNaN(betAmount) || betAmount < 10) {
        Toast.error('Minimum bet is 10 GP', 'INVALID BET');
        return;
      }

      if (betAmount > 10000) {
        Toast.error('Maximum bet is 10,000 GP', 'INVALID BET');
        return;
      }

      if (betAmount > userGP) {
        Toast.error('Insufficient GP', 'INSUFFICIENT FUNDS');
        return;
      }

      // Deduct bet
      updateUserGP(-betAmount);
      updateMinesGPDisplay();

      // Initialize game
      minesGameState = {
        isPlaying: true,
        betAmount: betAmount,
        minesCount: minesCount,
        revealedCount: 0,
        grid: new Array(25).fill(false),
        minePositions: generateMinePositions(minesCount),
        multiplier: 1.0
      };

      // Update UI
      document.getElementById('minesStartBtn').style.display = 'none';
      document.getElementById('minesCashoutBtn').style.display = 'block';
      document.getElementById('minesBetAmount').disabled = true;
      document.getElementById('minesCount').disabled = true;

      // Reset grid
      initMinesGame();
      updateMinesStats();

      Toast.success(`Game started with ${minesCount} mines!`, 'MINES');
    }

    function generateMinePositions(count) {
      const positions = [];
      while (positions.length < count) {
        const pos = Math.floor(Math.random() * 25);
        if (!positions.includes(pos)) {
          positions.push(pos);
        }
      }
      return positions;
    }

    function handleMinesTileClick(index) {
      if (!minesGameState.isPlaying) return;
      if (minesGameState.grid[index]) return; // Already revealed

      const tile = document.querySelector(`.mines-tile[data-index="${index}"]`);

      // Check if mine
      if (minesGameState.minePositions.includes(index)) {
        // Hit a mine!
        tile.classList.add('mine');
        tile.textContent = '💣';

        // Reveal all mines
        minesGameState.minePositions.forEach(pos => {
          const mineTile = document.querySelector(`.mines-tile[data-index="${pos}"]`);
          if (pos !== index) {
            mineTile.classList.add('mine');
            mineTile.textContent = '💣';
          }
        });

        // Disable all tiles
        document.querySelectorAll('.mines-tile').forEach(t => t.classList.add('disabled'));

        // Game over
        endMinesGame(false);
        Toast.error(`Hit a mine! Lost ${minesGameState.betAmount} GP`, 'GAME OVER');
      } else {
        // Safe tile!
        tile.classList.add('revealed');
        tile.textContent = '💎';
        minesGameState.grid[index] = true;
        minesGameState.revealedCount++;

        // Calculate multiplier
        const safeTiles = 25 - minesGameState.minesCount;
        const revealed = minesGameState.revealedCount;
        minesGameState.multiplier = calculateMinesMultiplier(revealed, safeTiles, minesGameState.minesCount);

        updateMinesStats();

        // Check if won (all safe tiles revealed)
        if (minesGameState.revealedCount >= safeTiles) {
          endMinesGame(true);
          const profit = Math.floor(minesGameState.betAmount * minesGameState.multiplier);
          Toast.success(`Perfect game! Won ${profit} GP!`, 'VICTORY');
        }
      }
    }

    function calculateMinesMultiplier(revealed, totalSafe, minesCount) {
      // Simple multiplier calculation
      // More revealed = higher multiplier
      // More mines = higher multiplier growth
      const baseMultiplier = 1.0;
      const growthRate = 1 + (minesCount / 25);
      return baseMultiplier + (revealed * 0.2 * growthRate);
    }

    function cashoutMines() {
      if (!minesGameState.isPlaying) return;

      const profit = Math.floor(minesGameState.betAmount * minesGameState.multiplier);
      updateUserGP(profit);
      updateMinesGPDisplay();

      // Reveal all tiles
      for (let i = 0; i < 25; i++) {
        const tile = document.querySelector(`.mines-tile[data-index="${i}"]`);
        if (minesGameState.minePositions.includes(i)) {
          tile.classList.add('mine');
          tile.textContent = '💣';
        } else if (!minesGameState.grid[i]) {
          tile.classList.add('revealed');
          tile.textContent = '💎';
        }
        tile.classList.add('disabled');
      }

      endMinesGame(true);
      Toast.success(`Cashed out ${profit} GP at ${minesGameState.multiplier.toFixed(2)}x!`, 'CASHOUT');
    }

    function endMinesGame(won) {
      minesGameState.isPlaying = false;

      // Update UI
      document.getElementById('minesStartBtn').style.display = 'block';
      document.getElementById('minesCashoutBtn').style.display = 'none';
      document.getElementById('minesBetAmount').disabled = false;
      document.getElementById('minesCount').disabled = false;

      // Reset after delay
      setTimeout(() => {
        initMinesGame();
        minesGameState.multiplier = 0;
        minesGameState.revealedCount = 0;
        updateMinesStats();
      }, 3000);
    }

    function updateMinesStats() {
      document.getElementById('minesMultiplier').textContent = minesGameState.multiplier.toFixed(2) + 'x';
      const profit = Math.floor(minesGameState.betAmount * minesGameState.multiplier);
      document.getElementById('minesProfit').textContent = profit + ' GP';
      document.getElementById('minesRevealed').textContent = `${minesGameState.revealedCount} / ${25 - minesGameState.minesCount}`;
    }

    // ===============================================
    // BLACKJACK GAME SYSTEM
    // ===============================================

    let blackjackGameState = {
      isPlaying: false,
      betAmount: 0,
      playerCards: [],
      dealerCards: [],
      deck: [],
      dealerHiddenCard: null
    };

    const suits = ['♠', '♥', '♣', '♦'];
    const values = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];

    function createDeck() {
      const deck = [];
      for (let suit of suits) {
        for (let value of values) {
          deck.push({ suit, value });
        }
      }
      return shuffle(deck);
    }

    function shuffle(deck) {
      for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
      }
      return deck;
    }

    function getCardValue(card) {
      if (card.value === 'A') return 11;
      if (['J', 'Q', 'K'].includes(card.value)) return 10;
      return parseInt(card.value);
    }

    function calculateHandValue(cards) {
      let value = 0;
      let aces = 0;

      for (let card of cards) {
        const cardVal = getCardValue(card);
        value += cardVal;
        if (card.value === 'A') aces++;
      }

      // Adjust for aces
      while (value > 21 && aces > 0) {
        value -= 10;
        aces--;
      }

      return value;
    }

    function createCardElement(card, hidden = false) {
      const cardDiv = document.createElement('div');
      cardDiv.className = 'blackjack-card';

      if (hidden) {
        cardDiv.classList.add('hidden');
        cardDiv.textContent = '?';
        return cardDiv;
      }

      const isRed = card.suit === '♥' || card.suit === '♦';
      cardDiv.classList.add(isRed ? 'red' : 'black');

      cardDiv.innerHTML = `
        <div>${card.suit}</div>
        <div class="blackjack-card-value">${card.value}</div>
      `;

      return cardDiv;
    }

    function updateBlackjackGPDisplay() {
      const gp = getUserGP();
      document.getElementById('blackjackGPDisplay').textContent = gp;
      if (blackjackGameState && blackjackGameState.betAmount) {
        document.getElementById('blackjackCurrentBet').textContent = blackjackGameState.betAmount + ' GP';
      }
    }

    function initBlackjack() {
      const gp = getUserGP();
      document.getElementById('blackjackGPDisplay').textContent = gp;
    }

    async function dealBlackjack() {
      const betAmount = parseInt(document.getElementById('blackjackBetAmount').value);
      const userGP = getUserGP();

      // Validation
      if (isNaN(betAmount) || betAmount < 10) {
        Toast.error('Minimum bet is 10 GP', 'INVALID BET');
        return;
      }

      if (betAmount > 10000) {
        Toast.error('Maximum bet is 10,000 GP', 'INVALID BET');
        return;
      }

      if (betAmount > userGP) {
        Toast.error('Insufficient GP', 'INSUFFICIENT FUNDS');
        return;
      }

      // Deduct bet
      updateUserGP(-betAmount);

      // Initialize game
      blackjackGameState = {
        isPlaying: true,
        betAmount: betAmount,
        playerCards: [],
        dealerCards: [],
        deck: createDeck(),
        dealerHiddenCard: null
      };

      // Deal initial cards
      blackjackGameState.playerCards.push(blackjackGameState.deck.pop());
      blackjackGameState.dealerCards.push(blackjackGameState.deck.pop());
      blackjackGameState.playerCards.push(blackjackGameState.deck.pop());
      blackjackGameState.dealerHiddenCard = blackjackGameState.deck.pop();

      // Update UI
      updateBlackjackDisplay();
      updateBlackjackGPDisplay();
      document.getElementById('blackjackActions').style.display = 'flex';
      document.getElementById('blackjackDealBtn').disabled = true;
      document.getElementById('blackjackBetAmount').disabled = true;

      // Check for instant blackjack
      const playerValue = calculateHandValue(blackjackGameState.playerCards);
      if (playerValue === 21) {
        setTimeout(() => blackjackStand(), 500);
      }
    }

    function blackjackHit() {
      if (!blackjackGameState.isPlaying) return;

      // Deal card to player
      blackjackGameState.playerCards.push(blackjackGameState.deck.pop());
      updateBlackjackDisplay();

      const playerValue = calculateHandValue(blackjackGameState.playerCards);

      // Check for bust
      if (playerValue > 21) {
        endBlackjack('bust');
      }
    }

    function blackjackStand() {
      if (!blackjackGameState.isPlaying) return;

      // Reveal dealer's hidden card
      blackjackGameState.dealerCards.push(blackjackGameState.dealerHiddenCard);
      blackjackGameState.dealerHiddenCard = null;
      updateBlackjackDisplay();

      // Dealer must hit until 17 or higher
      const dealerPlay = () => {
        const dealerValue = calculateHandValue(blackjackGameState.dealerCards);

        if (dealerValue < 17) {
          setTimeout(() => {
            blackjackGameState.dealerCards.push(blackjackGameState.deck.pop());
            updateBlackjackDisplay();
            dealerPlay();
          }, 800);
        } else {
          // Determine winner
          setTimeout(() => {
            determineBlackjackWinner();
          }, 500);
        }
      };

      dealerPlay();
    }

    function determineBlackjackWinner() {
      const playerValue = calculateHandValue(blackjackGameState.playerCards);
      const dealerValue = calculateHandValue(blackjackGameState.dealerCards);

      if (dealerValue > 21) {
        endBlackjack('dealerBust');
      } else if (playerValue > dealerValue) {
        endBlackjack('win');
      } else if (playerValue < dealerValue) {
        endBlackjack('lose');
      } else {
        endBlackjack('push');
      }
    }

    function endBlackjack(result) {
      blackjackGameState.isPlaying = false;

      let message = '';
      let winAmount = 0;

      switch(result) {
        case 'bust':
          message = `Bust! Lost ${blackjackGameState.betAmount} GP`;
          Toast.error(message, 'BUST');
          break;
        case 'dealerBust':
          winAmount = blackjackGameState.betAmount * 2;
          message = `Dealer bust! Won ${winAmount} GP`;
          updateUserGP(winAmount);
          updateBlackjackGPDisplay();
          Toast.success(message, 'WIN');
          break;
        case 'win':
          winAmount = blackjackGameState.betAmount * 2;
          message = `You win! Won ${winAmount} GP`;
          updateUserGP(winAmount);
          updateBlackjackGPDisplay();
          Toast.success(message, 'WIN');
          break;
        case 'lose':
          message = `Dealer wins! Lost ${blackjackGameState.betAmount} GP`;
          Toast.error(message, 'LOSE');
          break;
        case 'push':
          winAmount = blackjackGameState.betAmount;
          message = `Push! Bet returned`;
          updateUserGP(winAmount);
          updateBlackjackGPDisplay();
          Toast.info(message, 'PUSH');
          break;
      }

      // Update info display
      document.getElementById('blackjackGameInfo').textContent = message;

      // Reset UI
      document.getElementById('blackjackActions').style.display = 'none';

      setTimeout(() => {
        resetBlackjack();
      }, 3000);
    }

    function resetBlackjack() {
      document.getElementById('blackjackPlayerCards').innerHTML = '';
      document.getElementById('blackjackDealerCards').innerHTML = '';
      document.getElementById('blackjackPlayerValue').textContent = '0';
      document.getElementById('blackjackDealerValue').textContent = '0';
      document.getElementById('blackjackCurrentBet').textContent = '0 GP';
      document.getElementById('blackjackGameInfo').textContent = 'Place your bet and click DEAL to start. Get closer to 21 than the dealer without going over!';
      document.getElementById('blackjackDealBtn').disabled = false;
      document.getElementById('blackjackBetAmount').disabled = false;
    }

    function updateBlackjackDisplay() {
      // Update player cards
      const playerCardsDiv = document.getElementById('blackjackPlayerCards');
      playerCardsDiv.innerHTML = '';
      blackjackGameState.playerCards.forEach(card => {
        playerCardsDiv.appendChild(createCardElement(card));
      });

      // Update dealer cards
      const dealerCardsDiv = document.getElementById('blackjackDealerCards');
      dealerCardsDiv.innerHTML = '';
      blackjackGameState.dealerCards.forEach(card => {
        dealerCardsDiv.appendChild(createCardElement(card));
      });

      // Add hidden card if exists
      if (blackjackGameState.dealerHiddenCard) {
        dealerCardsDiv.appendChild(createCardElement(null, true));
      }

      // Update values
      const playerValue = calculateHandValue(blackjackGameState.playerCards);
      document.getElementById('blackjackPlayerValue').textContent = playerValue;

      const dealerValue = blackjackGameState.dealerHiddenCard
        ? calculateHandValue(blackjackGameState.dealerCards)
        : calculateHandValue(blackjackGameState.dealerCards);
      document.getElementById('blackjackDealerValue').textContent = dealerValue;

      document.getElementById('blackjackCurrentBet').textContent = blackjackGameState.betAmount + ' GP';
    }

    // Initial event listeners
    document.getElementById('joinBtn').addEventListener('click', handleJoin);
    document.getElementById('loginLink').addEventListener('click', () => swapContent('login'));
    document.getElementById('logoutBtn').addEventListener('click', handleLogout);
    document.getElementById('connectWalletBtn').addEventListener('click', handleConnectWallet);
    document.getElementById('playReactionBtn').addEventListener('click', () => {
      console.log('Play Reaction clicked');
      swapContent('game');
    });
    document.getElementById('playCrashBtn').addEventListener('click', () => {
      console.log('Play Crash clicked');
      swapContent('crash');
    });
    document.getElementById('playMinesBtn').addEventListener('click', () => {
      console.log('Play Mines clicked');
      swapContent('mines');
    });
    document.getElementById('playBlackjackBtn').addEventListener('click', () => {
      console.log('Play Blackjack clicked');
      swapContent('blackjack');
    });
    document.getElementById('openOvenBtn').addEventListener('click', () => {
      console.log('Open Oven clicked');
      swapContent('oven');
    });
    document.getElementById('backFromOvenBtn').addEventListener('click', () => swapContent('dashboard'));
    document.getElementById('ovenDepositBtn').addEventListener('click', depositToOven);
    document.getElementById('ovenWithdrawBtn').addEventListener('click', withdrawFromOven);
    document.getElementById('openFarmBtn').addEventListener('click', () => {
      console.log('Open Farm clicked');
      swapContent('farm');
    });
    document.getElementById('backFromFarmBtn').addEventListener('click', () => swapContent('dashboard'));
    document.getElementById('farmClickBtn').addEventListener('click', clickFarm);
    document.getElementById('viewLeaderboardBtn').addEventListener('click', () => {
      console.log('View Leaderboard clicked');
      swapContent('leaderboard');
    });
    document.getElementById('backToDashBtn').addEventListener('click', () => swapContent('dashboard'));
    document.getElementById('backFromCrashBtn').addEventListener('click', () => swapContent('dashboard'));
    document.getElementById('backFromMinesBtn').addEventListener('click', () => swapContent('dashboard'));
    document.getElementById('minesStartBtn').addEventListener('click', startMinesGame);
    document.getElementById('minesCashoutBtn').addEventListener('click', cashoutMines);
    document.getElementById('backFromBlackjackBtn').addEventListener('click', () => swapContent('dashboard'));
    document.getElementById('blackjackDealBtn').addEventListener('click', dealBlackjack);
    document.getElementById('blackjackHitBtn').addEventListener('click', blackjackHit);
    document.getElementById('blackjackStandBtn').addEventListener('click', blackjackStand);
    document.getElementById('backFromLeaderboardBtn').addEventListener('click', () => swapContent('dashboard'));
    document.getElementById('backFromQuestsBtn').addEventListener('click', () => swapContent('dashboard'));
    document.getElementById('backFromInventoryBtn').addEventListener('click', () => swapContent('dashboard'));
    document.getElementById('backFromShopBtn').addEventListener('click', () => swapContent('dashboard'));
    document.getElementById('viewQuestsBtn').addEventListener('click', () => swapContent('quests'));
    document.getElementById('viewInventoryBtn').addEventListener('click', () => swapContent('inventory'));
    document.getElementById('viewShopBtn').addEventListener('click', () => swapContent('shop'));
    document.getElementById('startGameBtn').addEventListener('click', startGame);
    document.getElementById('sellButton').addEventListener('click', handleSell);
    document.getElementById('resetGameBtn').addEventListener('click', resetGame);

    // Campaign banner click handler
    document.getElementById('campaignBanner').addEventListener('click', () => {
      console.log('Campaign banner clicked');
      swapContent('campaign');
    });

    // Campaign page button event listeners
    document.getElementById('backFromCampaignBtn').addEventListener('click', () => swapContent('dashboard'));
    document.getElementById('openOvenBtnCampaign').addEventListener('click', () => {
      console.log('Open Oven from Campaign clicked');
      swapContent('oven');
    });
    document.getElementById('openFarmBtnCampaign').addEventListener('click', () => {
      console.log('Open Farm from Campaign clicked');
      swapContent('farm');
    });
    document.getElementById('playReactionBtnCampaign').addEventListener('click', () => {
      console.log('Play Reaction from Campaign clicked');
      swapContent('game');
    });
    document.getElementById('playCrashBtnCampaign').addEventListener('click', () => {
      console.log('Play Crash from Campaign clicked');
      swapContent('crash');
    });
    document.getElementById('playMinesBtnCampaign').addEventListener('click', () => {
      console.log('Play Mines from Campaign clicked');
      swapContent('mines');
    });
    document.getElementById('playBlackjackBtnCampaign').addEventListener('click', () => {
      console.log('Play Blackjack from Campaign clicked');
      swapContent('blackjack');
    });

    // Leaderboard filter buttons
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        const filter = this.getAttribute('data-filter');
        handleFilterChange(filter);
      });
    });

    // Quest tab switching
    document.querySelectorAll('.quest-tab').forEach(tab => {
      tab.addEventListener('click', function() {
        document.querySelectorAll('.quest-tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        const questType = this.getAttribute('data-quest-tab');
        loadQuests(questType);
      });
    });

    // Add keyboard navigation support
    document.addEventListener('keydown', (e) => {
      // ESC key to go back
      if (e.key === 'Escape') {
        if (gameContent.style.display === 'block') {
          swapContent('dashboard');
        } else if (leaderboardContent.style.display === 'block') {
          swapContent('dashboard');
        } else if (questContent.style.display === 'block') {
          swapContent('dashboard');
        } else if (inventoryContent.style.display === 'block') {
          swapContent('dashboard');
        } else if (shopContent.style.display === 'block') {
          swapContent('dashboard');
        }
      }
    });

    // Helper function for breadcrumb navigation
    function showDashboard() {
      swapContent('dashboard');
    }

    // Make DUEL PVP logo clickable when logged in
    const brandTitle = document.querySelector('.brand .title');
    if (brandTitle) {
      brandTitle.addEventListener('click', () => {
        const savedEmail = localStorage.getItem('duelpvp_email');
        if (savedEmail) {
          swapContent('dashboard');
        }
      });
    }

    // Check if user is already logged in
    try {
      const savedEmail = localStorage.getItem('duelpvp_email');
      if (savedEmail) {
        document.getElementById('userName').textContent = savedEmail.split('@')[0].toUpperCase();
        if (brandTitle) brandTitle.style.cursor = 'pointer';
      }
    } catch (e) {}
  </script>
</body>
</html>
